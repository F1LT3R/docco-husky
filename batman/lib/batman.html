 <!DOCTYPE html>  <html> <head>   <title>batman.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="../docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">             <a class="source" href="../README.html">               <span class="file_name">README</span>             </a>                                           <a class="source " href="../lib/batman.jquery.html">                 <span class="base_path">lib / </span><span class="file_name">batman.jquery.js</span>               </a>                                           <a class="source selected" href="../lib/batman.html">                 <span class="base_path">lib / </span><span class="file_name">batman.js</span>               </a>                                           <a class="source " href="../lib/batman.node.html">                 <span class="base_path">lib / </span><span class="file_name">batman.node.js</span>               </a>                                           <a class="source " href="../lib/batman.solo.html">                 <span class="base_path">lib / </span><span class="file_name">batman.solo.js</span>               </a>                                           <a class="source " href="../lib/coffee-script.html">                 <span class="base_path">lib / </span><span class="file_name">coffee-script.js</span>               </a>                                           <a class="source " href="../lib/dist/batman.jquery.html">                 <span class="base_path">lib / dist / </span><span class="file_name">batman.jquery.js</span>               </a>                                           <a class="source " href="../lib/dist/batman.jquery.min.html">                 <span class="base_path">lib / dist / </span><span class="file_name">batman.jquery.min.js</span>               </a>                                           <a class="source " href="../lib/dist/batman.html">                 <span class="base_path">lib / dist / </span><span class="file_name">batman.js</span>               </a>                                           <a class="source " href="../lib/dist/batman.min.html">                 <span class="base_path">lib / dist / </span><span class="file_name">batman.min.js</span>               </a>                                           <a class="source " href="../lib/es5-shim.html">                 <span class="base_path">lib / </span><span class="file_name">es5-shim.js</span>               </a>                                           <a class="source " href="../lib/extras/batman.i18n.html">                 <span class="base_path">lib / extras / </span><span class="file_name">batman.i18n.js</span>               </a>                                           <a class="source " href="../lib/extras/batman.rails.html">                 <span class="base_path">lib / extras / </span><span class="file_name">batman.rails.js</span>               </a>                                           <a class="source " href="../src/batman.html">                 <span class="base_path">src / </span><span class="file_name">batman.coffee</span>               </a>                                           <a class="source " href="../src/batman.jquery.html">                 <span class="base_path">src / </span><span class="file_name">batman.jquery.coffee</span>               </a>                                           <a class="source " href="../src/batman.node.html">                 <span class="base_path">src / </span><span class="file_name">batman.node.coffee</span>               </a>                                           <a class="source " href="../src/batman.solo.html">                 <span class="base_path">src / </span><span class="file_name">batman.solo.coffee</span>               </a>                                           <a class="source " href="../src/extras/batman.i18n.html">                 <span class="base_path">src / extras / </span><span class="file_name">batman.i18n.coffee</span>               </a>                                           <a class="source " href="../src/extras/batman.rails.html">                 <span class="base_path">src / extras / </span><span class="file_name">batman.rails.coffee</span>               </a>                                           <a class="source " href="../src/tools/batman.html">                 <span class="base_path">src / tools / </span><span class="file_name">batman.coffee</span>               </a>                                           <a class="source " href="../src/tools/build/remove_development_transform.html">                 <span class="base_path">src / tools / build / </span><span class="file_name">remove_development_transform.coffee</span>               </a>                                           <a class="source " href="../src/tools/generator.html">                 <span class="base_path">src / tools / </span><span class="file_name">generator.coffee</span>               </a>                                           <a class="source " href="../src/tools/server.html">                 <span class="base_path">src / tools / </span><span class="file_name">server.coffee</span>               </a>                                           <a class="source " href="../src/tools/utils.html">                 <span class="base_path">src / tools / </span><span class="file_name">utils.coffee</span>               </a>                                           <a class="source " href="../tools/build/remove_development_transform.html">                 <span class="base_path">tools / build / </span><span class="file_name">remove_development_transform.js</span>               </a>                                           <a class="source " href="../tools/cli.html">                 <span class="base_path">tools / </span><span class="file_name">cli.js</span>               </a>                                           <a class="source " href="../tools/framework.html">                 <span class="base_path">tools / </span><span class="file_name">framework.js</span>               </a>                                           <a class="source " href="../tools/generator.html">                 <span class="base_path">tools / </span><span class="file_name">generator.js</span>               </a>                                           <a class="source " href="../tools/server.html">                 <span class="base_path">tools / </span><span class="file_name">server.js</span>               </a>                                           <a class="source " href="../tools/server_utils.html">                 <span class="base_path">tools / </span><span class="file_name">server_utils.js</span>               </a>                                           <a class="source " href="../tools/templates/app/$app$.html">                 <span class="base_path">tools / templates / app / </span><span class="file_name">$app$.coffee</span>               </a>                                           <a class="source " href="../tools/templates/app/controllers/app_controller.html">                 <span class="base_path">tools / templates / app / controllers / </span><span class="file_name">app_controller.coffee</span>               </a>                                           <a class="source " href="../tools/templates/controller/controllers/$name$_controller.html">                 <span class="base_path">tools / templates / controller / controllers / </span><span class="file_name">$name$_controller.coffee</span>               </a>                                           <a class="source " href="../tools/templates/model/models/$name$.html">                 <span class="base_path">tools / templates / model / models / </span><span class="file_name">$name$.coffee</span>               </a>                                           <a class="source " href="../tools/utils.html">                 <span class="base_path">tools / </span><span class="file_name">utils.js</span>               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               batman.js             </h1>             <div class="filepath">lib/</div>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">$addEventListener</span><span class="p">,</span> <span class="nx">$appendChild</span><span class="p">,</span> <span class="nx">$block</span><span class="p">,</span> <span class="nx">$clearImmediate</span><span class="p">,</span> <span class="nx">$extendsEnumerable</span><span class="p">,</span> <span class="nx">$findName</span><span class="p">,</span> <span class="nx">$forgetParseExit</span><span class="p">,</span> <span class="nx">$functionName</span><span class="p">,</span> <span class="nx">$get</span><span class="p">,</span> <span class="nx">$hasAddEventListener</span><span class="p">,</span> <span class="nx">$insertBefore</span><span class="p">,</span> <span class="nx">$isChildOf</span><span class="p">,</span> <span class="nx">$mixin</span><span class="p">,</span> <span class="nx">$onParseExit</span><span class="p">,</span> <span class="nx">$passError</span><span class="p">,</span> <span class="nx">$preventDefault</span><span class="p">,</span> <span class="nx">$redirect</span><span class="p">,</span> <span class="nx">$removeEventListener</span><span class="p">,</span> <span class="nx">$removeNode</span><span class="p">,</span> <span class="nx">$setImmediate</span><span class="p">,</span> <span class="nx">$setInnerHTML</span><span class="p">,</span> <span class="nx">$trackBinding</span><span class="p">,</span> <span class="nx">$typeOf</span><span class="p">,</span> <span class="nx">$unbindNode</span><span class="p">,</span> <span class="nx">$unbindTree</span><span class="p">,</span> <span class="nx">$unmixin</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">,</span> <span class="nx">BatmanObject</span><span class="p">,</span> <span class="nx">Validators</span><span class="p">,</span> <span class="nx">buntUndefined</span><span class="p">,</span> <span class="nx">camelize_rx</span><span class="p">,</span> <span class="nx">capitalize_rx</span><span class="p">,</span> <span class="nx">container</span><span class="p">,</span> <span class="nx">developer</span><span class="p">,</span> <span class="nx">div</span><span class="p">,</span> <span class="nx">filters</span><span class="p">,</span> <span class="nx">helpers</span><span class="p">,</span> <span class="nx">isEmptyDataObject</span><span class="p">,</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">mixins</span><span class="p">,</span> <span class="nx">t</span><span class="p">,</span> <span class="nx">underscore_rx1</span><span class="p">,</span> <span class="nx">underscore_rx2</span><span class="p">,</span> <span class="nx">_Batman</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_implementImmediates</span><span class="p">,</span> <span class="nx">_len</span><span class="p">,</span> <span class="nx">_objectToString</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">,</span> <span class="nx">_stateMachine_setState</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">__slice</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">,</span> <span class="nx">__hasProp</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">,</span> <span class="nx">__indexOf</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">indexOf</span> <span class="o">||</span> <span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">===</span> <span class="nx">item</span><span class="p">)</span> <span class="k">return</span> <span class="nx">i</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">},</span> <span class="nx">__extends</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">child</span><span class="p">,</span> <span class="nx">parent</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">parent</span><span class="p">)</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="nx">__hasProp</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="nx">key</span><span class="p">))</span> <span class="nx">child</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">parent</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span> <span class="p">}</span>
    <span class="kd">function</span> <span class="nx">ctor</span><span class="p">()</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">=</span> <span class="nx">child</span><span class="p">;</span> <span class="p">}</span>
    <span class="nx">ctor</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
    <span class="nx">child</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ctor</span><span class="p">;</span>
    <span class="nx">child</span><span class="p">.</span><span class="nx">__super__</span> <span class="o">=</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">child</span><span class="p">;</span>
  <span class="p">},</span> <span class="nx">__bind</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">me</span><span class="p">){</span> <span class="k">return</span> <span class="kd">function</span><span class="p">(){</span> <span class="k">return</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">me</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span> <span class="p">};</span> <span class="p">};</span>
  <span class="nx">Batman</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">mixins</span><span class="p">;</span>
    <span class="nx">mixins</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="p">[];</span>
    <span class="k">return</span> <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">func</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">ctor</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">ctor</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="nx">func</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">child</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ctor</span><span class="p">,</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">func</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">child</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
      <span class="k">return</span> <span class="k">typeof</span> <span class="nx">result</span> <span class="o">===</span> <span class="s2">&quot;object&quot;</span> <span class="o">?</span> <span class="nx">result</span> <span class="o">:</span> <span class="nx">child</span><span class="p">;</span>
    <span class="p">})(</span><span class="nx">Batman</span><span class="p">.</span><span class="nb">Object</span><span class="p">,</span> <span class="nx">mixins</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{});</span>
  <span class="p">};</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">pathPrefix</span><span class="o">:</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span>
    <span class="nx">usePushState</span><span class="o">:</span> <span class="kc">false</span>
  <span class="p">};</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">typeOf</span> <span class="o">=</span> <span class="nx">$typeOf</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">object</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">object</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s2">&quot;Undefined&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">_objectToString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">object</span><span class="p">).</span><span class="nx">slice</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">};</span>
  <span class="nx">_objectToString</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span><span class="p">;</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">mixin</span> <span class="o">=</span> <span class="nx">$mixin</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">hasSet</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">mixin</span><span class="p">,</span> <span class="nx">mixins</span><span class="p">,</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">;</span>
    <span class="nx">to</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">mixins</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">&lt;=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">:</span> <span class="p">[];</span>
    <span class="nx">hasSet</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">to</span><span class="p">.</span><span class="nx">set</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">mixins</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">mixin</span> <span class="o">=</span> <span class="nx">mixins</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">$typeOf</span><span class="p">(</span><span class="nx">mixin</span><span class="p">)</span> <span class="o">!==</span> <span class="s1">&#39;Object&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">continue</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">key</span> <span class="k">in</span> <span class="nx">mixin</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">__hasProp</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">mixin</span><span class="p">,</span> <span class="nx">key</span><span class="p">))</span> <span class="k">continue</span><span class="p">;</span>
        <span class="nx">value</span> <span class="o">=</span> <span class="nx">mixin</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">key</span> <span class="o">===</span> <span class="s1">&#39;initialize&#39;</span> <span class="o">||</span> <span class="nx">key</span> <span class="o">===</span> <span class="s1">&#39;uninitialize&#39;</span> <span class="o">||</span> <span class="nx">key</span> <span class="o">===</span> <span class="s1">&#39;prototype&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">hasSet</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">to</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">to</span><span class="p">.</span><span class="nx">nodeName</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">Batman</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">to</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">to</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">mixin</span><span class="p">.</span><span class="nx">initialize</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">mixin</span><span class="p">.</span><span class="nx">initialize</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">to</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">to</span><span class="p">;</span>
  <span class="p">};</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">unmixin</span> <span class="o">=</span> <span class="nx">$unmixin</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">from</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">mixin</span><span class="p">,</span> <span class="nx">mixins</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">;</span>
    <span class="nx">from</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">mixins</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">&lt;=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">:</span> <span class="p">[];</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">mixins</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">mixin</span> <span class="o">=</span> <span class="nx">mixins</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">key</span> <span class="k">in</span> <span class="nx">mixin</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">key</span> <span class="o">===</span> <span class="s1">&#39;initialize&#39;</span> <span class="o">||</span> <span class="nx">key</span> <span class="o">===</span> <span class="s1">&#39;uninitialize&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">delete</span> <span class="nx">from</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">mixin</span><span class="p">.</span><span class="nx">uninitialize</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">mixin</span><span class="p">.</span><span class="nx">uninitialize</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">from</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">from</span><span class="p">;</span>
  <span class="p">};</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">_block</span> <span class="o">=</span> <span class="nx">$block</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">lengthOrFunction</span><span class="p">,</span> <span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">argsLength</span><span class="p">,</span> <span class="nx">callbackEater</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">fn</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">argsLength</span> <span class="o">=</span> <span class="nx">lengthOrFunction</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">fn</span> <span class="o">=</span> <span class="nx">lengthOrFunction</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">callbackEater</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">,</span> <span class="nx">f</span><span class="p">;</span>
      <span class="nx">args</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="p">[];</span>
      <span class="nx">ctx</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">args</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
      <span class="p">};</span>
      <span class="k">if</span> <span class="p">((</span><span class="k">typeof</span> <span class="nx">args</span><span class="p">[</span><span class="nx">args</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">argsLength</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;=</span> <span class="nx">argsLength</span><span class="p">)))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">f</span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">pop</span><span class="p">());</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">f</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">};</span>
  <span class="p">};</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">_findName</span> <span class="o">=</span> <span class="nx">$findName</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">f</span><span class="p">.</span><span class="nx">displayName</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">key</span> <span class="k">in</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">value</span> <span class="o">=</span> <span class="nx">context</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">===</span> <span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">f</span><span class="p">.</span><span class="nx">displayName</span> <span class="o">=</span> <span class="nx">key</span><span class="p">;</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">f</span><span class="p">.</span><span class="nx">displayName</span><span class="p">;</span>
  <span class="p">};</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">_functionName</span> <span class="o">=</span> <span class="nx">$functionName</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">_ref</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">f</span><span class="p">.</span><span class="nx">__name__</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">f</span><span class="p">.</span><span class="nx">__name__</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">f</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">f</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="p">(</span><span class="nx">_ref</span> <span class="o">=</span> <span class="nx">f</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">match</span><span class="p">(</span><span class="sr">/\W*function\s+([\w\$]+)\(/</span><span class="p">))</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">_ref</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">};</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">_preventDefault</span> <span class="o">=</span> <span class="nx">$preventDefault</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">e</span><span class="p">.</span><span class="nx">returnValue</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">_isChildOf</span> <span class="o">=</span> <span class="nx">$isChildOf</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">parentNode</span><span class="p">,</span> <span class="nx">childNode</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">node</span><span class="p">;</span>
    <span class="nx">node</span> <span class="o">=</span> <span class="nx">childNode</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">node</span> <span class="o">===</span> <span class="nx">parentNode</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">node</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">};</span>
  <span class="nx">$setImmediate</span> <span class="o">=</span> <span class="nx">$clearImmediate</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="nx">_implementImmediates</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">canUsePostMessage</span><span class="p">,</span> <span class="nx">count</span><span class="p">,</span> <span class="nx">functions</span><span class="p">,</span> <span class="nx">getHandle</span><span class="p">,</span> <span class="nx">handler</span><span class="p">,</span> <span class="nx">prefix</span><span class="p">,</span> <span class="nx">tasks</span><span class="p">;</span>
    <span class="nx">canUsePostMessage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">async</span><span class="p">,</span> <span class="nx">oldMessage</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">container</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">async</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">oldMessage</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">onmessage</span><span class="p">;</span>
      <span class="nx">container</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">async</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">};</span>
      <span class="nx">container</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">);</span>
      <span class="nx">container</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="nx">oldMessage</span><span class="p">;</span>
      <span class="k">return</span> <span class="nx">async</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">tasks</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">SimpleHash</span><span class="p">;</span>
    <span class="nx">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">getHandle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s2">&quot;go&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="o">++</span><span class="nx">count</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">container</span><span class="p">.</span><span class="nx">setImmediate</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">$setImmediate</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">setImmediate</span><span class="p">;</span>
      <span class="nx">$clearImmediate</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">clearImmediate</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">container</span><span class="p">.</span><span class="nx">msSetImmediate</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">$setImmediate</span> <span class="o">=</span> <span class="nx">msSetImmediate</span><span class="p">;</span>
      <span class="nx">$clearImmediate</span> <span class="o">=</span> <span class="nx">msClearImmediate</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">canUsePostMessage</span><span class="p">())</span> <span class="p">{</span>
      <span class="nx">prefix</span> <span class="o">=</span> <span class="s1">&#39;com.batman.&#39;</span><span class="p">;</span>
      <span class="nx">functions</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">SimpleHash</span><span class="p">;</span>
      <span class="nx">handler</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">handle</span><span class="p">,</span> <span class="nx">_base</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!~</span><span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">search</span><span class="p">(</span><span class="nx">prefix</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">handle</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="nx">prefix</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">typeof</span> <span class="p">(</span><span class="nx">_base</span> <span class="o">=</span> <span class="nx">tasks</span><span class="p">.</span><span class="nx">unset</span><span class="p">(</span><span class="nx">handle</span><span class="p">))</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span> <span class="o">?</span> <span class="nx">_base</span><span class="p">()</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">};</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">container</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">container</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="nx">handler</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">container</span><span class="p">.</span><span class="nx">attachEvent</span><span class="p">(</span><span class="s1">&#39;onmessage&#39;</span><span class="p">,</span> <span class="nx">handler</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">$setImmediate</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">handle</span><span class="p">;</span>
        <span class="nx">tasks</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">handle</span> <span class="o">=</span> <span class="nx">getHandle</span><span class="p">(),</span> <span class="nx">f</span><span class="p">);</span>
        <span class="nx">container</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="nx">prefix</span> <span class="o">+</span> <span class="nx">handle</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">handle</span><span class="p">;</span>
      <span class="p">};</span>
      <span class="nx">$clearImmediate</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">handle</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">tasks</span><span class="p">.</span><span class="nx">unset</span><span class="p">(</span><span class="nx">handle</span><span class="p">);</span>
      <span class="p">};</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nb">document</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">__indexOf</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;script&quot;</span><span class="p">),</span> <span class="s2">&quot;onreadystatechange&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">$setImmediate</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">handle</span><span class="p">,</span> <span class="nx">script</span><span class="p">;</span>
        <span class="nx">handle</span> <span class="o">=</span> <span class="nx">getHandle</span><span class="p">();</span>
        <span class="nx">script</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;script&quot;</span><span class="p">);</span>
        <span class="nx">script</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">_base</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="p">(</span><span class="nx">_base</span> <span class="o">=</span> <span class="nx">tasks</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">handle</span><span class="p">))</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">_base</span><span class="p">();</span>
          <span class="p">}</span>
          <span class="nx">script</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
          <span class="nx">script</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">script</span><span class="p">);</span>
          <span class="k">return</span> <span class="nx">script</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="p">};</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">script</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">handle</span><span class="p">;</span>
      <span class="p">};</span>
      <span class="nx">$clearImmediate</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">handle</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">tasks</span><span class="p">.</span><span class="nx">unset</span><span class="p">(</span><span class="nx">handle</span><span class="p">);</span>
      <span class="p">};</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">$setImmediate</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
      <span class="p">};</span>
      <span class="nx">$clearImmediate</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">handle</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">handle</span><span class="p">);</span>
      <span class="p">};</span>
    <span class="p">}</span>
    <span class="nx">Batman</span><span class="p">.</span><span class="nx">setImmediate</span> <span class="o">=</span> <span class="nx">$setImmediate</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">clearImmediate</span> <span class="o">=</span> <span class="nx">$clearImmediate</span><span class="p">;</span>
  <span class="p">};</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">setImmediate</span> <span class="o">=</span> <span class="nx">$setImmediate</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">_implementImmediates</span><span class="p">();</span>
    <span class="k">return</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">setImmediate</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
  <span class="p">};</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">clearImmediate</span> <span class="o">=</span> <span class="nx">$clearImmediate</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">_implementImmediates</span><span class="p">();</span>
    <span class="k">return</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">clearImmediate</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
  <span class="p">};</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">translate</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">values</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">values</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">values</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">helpers</span><span class="p">.</span><span class="nx">interpolate</span><span class="p">(</span><span class="nx">$get</span><span class="p">(</span><span class="nx">Batman</span><span class="p">.</span><span class="nx">translate</span><span class="p">.</span><span class="nx">messages</span><span class="p">,</span> <span class="nx">x</span><span class="p">),</span> <span class="nx">values</span><span class="p">);</span>
  <span class="p">};</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">translate</span><span class="p">.</span><span class="nx">messages</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="nx">t</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">translate</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">Batman</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
  <span class="p">};</span>
  <span class="nx">developer</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">suppressed</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">DevelopmentError</span><span class="o">:</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">DevelopmentError</span><span class="p">;</span>
      <span class="nx">DevelopmentError</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">message</span> <span class="o">=</span> <span class="nx">message</span><span class="p">;</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">&quot;DevelopmentError&quot;</span><span class="p">;</span>
      <span class="p">};</span>
      <span class="nx">DevelopmentError</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="nb">Error</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
      <span class="k">return</span> <span class="nx">DevelopmentError</span><span class="p">;</span>
    <span class="p">})(),</span>
    <span class="nx">_ie_console</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">arg</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">,</span> <span class="nx">_results</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">console</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">console</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">[</span><span class="nx">f</span><span class="p">](</span><span class="s2">&quot;...&quot;</span> <span class="o">+</span> <span class="nx">f</span> <span class="o">+</span> <span class="s2">&quot; of &quot;</span> <span class="o">+</span> <span class="nx">args</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="s2">&quot; items...&quot;</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="nx">_results</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">arg</span> <span class="o">=</span> <span class="nx">args</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
        <span class="nx">_results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">console</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">console</span> <span class="o">!==</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">console</span><span class="p">[</span><span class="nx">f</span><span class="p">](</span><span class="nx">arg</span><span class="p">)</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">_results</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">suppress</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">developer</span><span class="p">.</span><span class="nx">suppressed</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">f</span><span class="p">();</span>
        <span class="k">return</span> <span class="nx">developer</span><span class="p">.</span><span class="nx">suppressed</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">unsuppress</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">developer</span><span class="p">.</span><span class="nx">suppressed</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">log</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">developer</span><span class="p">.</span><span class="nx">suppressed</span> <span class="o">||</span> <span class="o">!</span><span class="p">((</span><span class="k">typeof</span> <span class="nx">console</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">console</span> <span class="o">!==</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">.</span><span class="nx">apply</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">console</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">developer</span><span class="p">.</span><span class="nx">_ie_console</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">warn</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">developer</span><span class="p">.</span><span class="nx">suppressed</span> <span class="o">||</span> <span class="o">!</span><span class="p">((</span><span class="k">typeof</span> <span class="nx">console</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">console</span> <span class="o">!==</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">.</span><span class="nx">apply</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">console</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">developer</span><span class="p">.</span><span class="nx">_ie_console</span><span class="p">(</span><span class="s2">&quot;warn&quot;</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">error</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nx">developer</span><span class="p">.</span><span class="nx">DevelopmentError</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">assert</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">developer</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="s2">&quot;do&quot;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">f</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="nx">addFilters</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">$mixin</span><span class="p">(</span><span class="nx">Batman</span><span class="p">.</span><span class="nx">Filters</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">log</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">console</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">console</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
            <span class="p">}</span>
          <span class="p">}</span>
          <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
        <span class="p">},</span>
        <span class="nx">logStack</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">console</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">console</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">developer</span><span class="p">.</span><span class="nx">currentFilterStack</span><span class="p">);</span>
            <span class="p">}</span>
          <span class="p">}</span>
          <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">developer</span> <span class="o">=</span> <span class="nx">developer</span><span class="p">;</span>
  <span class="nx">developer</span><span class="p">.</span><span class="nx">assert</span><span class="p">((</span><span class="kd">function</span><span class="p">()</span> <span class="p">{}).</span><span class="nx">bind</span><span class="p">,</span> <span class="s2">&quot;Error! Batman needs Function.bind to work! Please shim it using something like es5-shim or augmentjs!&quot;</span><span class="p">);</span>
  <span class="nx">camelize_rx</span> <span class="o">=</span> <span class="sr">/(?:^|_|\-)(.)/g</span><span class="p">;</span>
  <span class="nx">capitalize_rx</span> <span class="o">=</span> <span class="sr">/(^|\s)([a-z])/g</span><span class="p">;</span>
  <span class="nx">underscore_rx1</span> <span class="o">=</span> <span class="sr">/([A-Z]+)([A-Z][a-z])/g</span><span class="p">;</span>
  <span class="nx">underscore_rx2</span> <span class="o">=</span> <span class="sr">/([a-z\d])([A-Z])/g</span><span class="p">;</span>
  <span class="nx">helpers</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">helpers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">camelize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">string</span><span class="p">,</span> <span class="nx">firstLetterLower</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">string</span> <span class="o">=</span> <span class="nx">string</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">camelize_rx</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">str</span><span class="p">,</span> <span class="nx">p1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">p1</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">();</span>
      <span class="p">});</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">firstLetterLower</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">string</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">+</span> <span class="nx">string</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">string</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">underscore</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">string</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">underscore_rx1</span><span class="p">,</span> <span class="s1">&#39;$1_$2&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="nx">underscore_rx2</span><span class="p">,</span> <span class="s1">&#39;$1_$2&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="nx">singularize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">len</span><span class="p">;</span>
      <span class="nx">len</span> <span class="o">=</span> <span class="nx">string</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">string</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">len</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;ies&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">string</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">len</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;y&#39;</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">string</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">len</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;s&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">string</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">len</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">string</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">pluralize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">count</span><span class="p">,</span> <span class="nx">string</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">lastLetter</span><span class="p">,</span> <span class="nx">len</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">count</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">string</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">string</span> <span class="o">=</span> <span class="nx">count</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">len</span> <span class="o">=</span> <span class="nx">string</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
      <span class="nx">lastLetter</span> <span class="o">=</span> <span class="nx">string</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">len</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">lastLetter</span> <span class="o">===</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">string</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">len</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;ies&quot;</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">lastLetter</span> <span class="o">===</span> <span class="s1">&#39;s&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">string</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="nx">string</span> <span class="o">+</span> <span class="s2">&quot;s&quot;</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">capitalize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">string</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">capitalize_rx</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">m</span><span class="p">,</span> <span class="nx">p1</span><span class="p">,</span> <span class="nx">p2</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">p1</span> <span class="o">+</span> <span class="nx">p2</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">();</span>
      <span class="p">});</span>
    <span class="p">},</span>
    <span class="nx">trim</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">string</span><span class="p">.</span><span class="nx">trim</span><span class="p">();</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">interpolate</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">stringOrObject</span><span class="p">,</span> <span class="nx">keys</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">string</span><span class="p">,</span> <span class="nx">value</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">stringOrObject</span> <span class="o">===</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">string</span> <span class="o">=</span> <span class="nx">stringOrObject</span><span class="p">[</span><span class="nx">keys</span><span class="p">.</span><span class="nx">count</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">string</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">string</span> <span class="o">=</span> <span class="nx">stringOrObject</span><span class="p">[</span><span class="s1">&#39;other&#39;</span><span class="p">];</span>
        <span class="p">}</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">string</span> <span class="o">=</span> <span class="nx">stringOrObject</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">key</span> <span class="k">in</span> <span class="nx">keys</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">value</span> <span class="o">=</span> <span class="nx">keys</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
        <span class="nx">string</span> <span class="o">=</span> <span class="nx">string</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;%\\{&quot;</span> <span class="o">+</span> <span class="nx">key</span> <span class="o">+</span> <span class="s2">&quot;\\}&quot;</span><span class="p">,</span> <span class="s2">&quot;g&quot;</span><span class="p">),</span> <span class="nx">value</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">string</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">Event</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">Event</span><span class="p">.</span><span class="nx">forBaseAndKey</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">base</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">base</span><span class="p">.</span><span class="nx">isEventEmitter</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">base</span><span class="p">.</span><span class="nx">event</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Event</span><span class="p">(</span><span class="nx">base</span><span class="p">,</span> <span class="nx">key</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="kd">function</span> <span class="nx">Event</span><span class="p">(</span><span class="nx">base</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">base</span> <span class="o">=</span> <span class="nx">base</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">key</span> <span class="o">=</span> <span class="nx">key</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">handlers</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">SimpleSet</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_preventCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">Event</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">isEvent</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nx">Event</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">isEqual</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">other</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">===</span> <span class="nx">other</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">base</span> <span class="o">===</span> <span class="nx">other</span><span class="p">.</span><span class="nx">base</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">key</span> <span class="o">===</span> <span class="nx">other</span><span class="p">.</span><span class="nx">key</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">Event</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hashKey</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">key</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">hashKey</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">key</span><span class="p">;</span>
      <span class="p">};</span>
      <span class="k">return</span> <span class="nx">key</span> <span class="o">=</span> <span class="s2">&quot;&lt;Batman.Event base: &quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">Batman</span><span class="p">.</span><span class="nx">Hash</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hashKeyFor</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">base</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;, key: \&quot;&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">Batman</span><span class="p">.</span><span class="nx">Hash</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hashKeyFor</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">key</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;\&quot;&gt;&quot;</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">Event</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addHandler</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">handler</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">handlers</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">handler</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">oneShot</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">autofireHandler</span><span class="p">(</span><span class="nx">handler</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">Event</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">removeHandler</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">handler</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">handlers</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">handler</span><span class="p">);</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">Event</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">eachHandler</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">iterator</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">handlers</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">iterator</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">((</span><span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">base</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">isEventEmitter</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">key</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">key</span><span class="p">;</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">base</span><span class="p">.</span><span class="nx">_batman</span><span class="p">.</span><span class="nx">ancestors</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">ancestor</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">handlers</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">ancestor</span><span class="p">.</span><span class="nx">isEventEmitter</span> <span class="o">&amp;&amp;</span> <span class="nx">ancestor</span><span class="p">.</span><span class="nx">hasEvent</span><span class="p">(</span><span class="nx">key</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">handlers</span> <span class="o">=</span> <span class="nx">ancestor</span><span class="p">.</span><span class="nx">event</span><span class="p">(</span><span class="nx">key</span><span class="p">).</span><span class="nx">handlers</span><span class="p">;</span>
            <span class="k">return</span> <span class="nx">handlers</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">iterator</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">});</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">Event</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">handlerContext</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">base</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">Event</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">prevent</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="o">++</span><span class="k">this</span><span class="p">.</span><span class="nx">_preventCount</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">Event</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">allow</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_preventCount</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">--</span><span class="k">this</span><span class="p">.</span><span class="nx">_preventCount</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_preventCount</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">Event</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">isPrevented</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_preventCount</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">Event</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">autofireHandler</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">handler</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_oneShotFired</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_oneShotArgs</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">handler</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">handlerContext</span><span class="p">(),</span> <span class="k">this</span><span class="p">.</span><span class="nx">_oneShotArgs</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">Event</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">resetOneShot</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_oneShotFired</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_oneShotArgs</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">Event</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">fire</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">context</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isPrevented</span><span class="p">()</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">_oneShotFired</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">context</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">handlerContext</span><span class="p">();</span>
      <span class="nx">args</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">oneShot</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_oneShotFired</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_oneShotArgs</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">eachHandler</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">handler</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">handler</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">};</span>
    <span class="nx">Event</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">allowAndFire</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">allow</span><span class="p">();</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">fire</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">Event</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">EventEmitter</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">isEventEmitter</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">hasEvent</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">_ref</span><span class="p">,</span> <span class="nx">_ref2</span><span class="p">;</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_batman</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="k">typeof</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">get</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span> <span class="o">?</span> <span class="p">(</span><span class="nx">_ref2</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;events&#39;</span><span class="p">))</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">_ref2</span><span class="p">.</span><span class="nx">hasKey</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">event</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">eventClass</span><span class="p">,</span> <span class="nx">events</span><span class="p">,</span> <span class="nx">existingEvent</span><span class="p">,</span> <span class="nx">existingEvents</span><span class="p">,</span> <span class="nx">newEvent</span><span class="p">,</span> <span class="nx">_base</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">;</span>
      <span class="nx">Batman</span><span class="p">.</span><span class="nx">initializeObject</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="nx">eventClass</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eventClass</span> <span class="o">||</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Event</span><span class="p">;</span>
      <span class="nx">events</span> <span class="o">=</span> <span class="p">(</span><span class="nx">_base</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_batman</span><span class="p">).</span><span class="nx">events</span> <span class="o">||</span> <span class="p">(</span><span class="nx">_base</span><span class="p">.</span><span class="nx">events</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">SimpleHash</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">events</span><span class="p">.</span><span class="nx">hasKey</span><span class="p">(</span><span class="nx">key</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">existingEvent</span> <span class="o">=</span> <span class="nx">events</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">existingEvents</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_batman</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;events&#39;</span><span class="p">);</span>
        <span class="nx">newEvent</span> <span class="o">=</span> <span class="nx">events</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="k">new</span> <span class="nx">eventClass</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">key</span><span class="p">));</span>
        <span class="nx">newEvent</span><span class="p">.</span><span class="nx">oneShot</span> <span class="o">=</span> <span class="nx">existingEvents</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="p">(</span><span class="nx">_ref</span> <span class="o">=</span> <span class="nx">existingEvents</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">key</span><span class="p">))</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">oneShot</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">newEvent</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">on</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">handler</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">event</span><span class="p">(</span><span class="nx">key</span><span class="p">).</span><span class="nx">addHandler</span><span class="p">(</span><span class="nx">handler</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">registerAsMutableSource</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Property</span><span class="p">.</span><span class="nx">registerSource</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">mutation</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">wrappedFunction</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">result</span><span class="p">;</span>
        <span class="nx">result</span> <span class="o">=</span> <span class="nx">wrappedFunction</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">event</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">).</span><span class="nx">fire</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
      <span class="p">};</span>
    <span class="p">},</span>
    <span class="nx">prevent</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">event</span><span class="p">(</span><span class="nx">key</span><span class="p">).</span><span class="nx">prevent</span><span class="p">();</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">allow</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">event</span><span class="p">(</span><span class="nx">key</span><span class="p">).</span><span class="nx">allow</span><span class="p">();</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">isPrevented</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">event</span><span class="p">(</span><span class="nx">key</span><span class="p">).</span><span class="nx">isPrevented</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="nx">fire</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">;</span>
      <span class="nx">key</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">args</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">&lt;=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">:</span> <span class="p">[];</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">event</span><span class="p">(</span><span class="nx">key</span><span class="p">)).</span><span class="nx">fire</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">_ref</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">allowAndFire</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">;</span>
      <span class="nx">key</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">args</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">&lt;=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">:</span> <span class="p">[];</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">event</span><span class="p">(</span><span class="nx">key</span><span class="p">)).</span><span class="nx">allowAndFire</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">_ref</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">PropertyEvent</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">PropertyEvent</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Event</span><span class="p">);</span>
    <span class="kd">function</span> <span class="nx">PropertyEvent</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">PropertyEvent</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">PropertyEvent</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">eachHandler</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">iterator</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">base</span><span class="p">.</span><span class="nx">eachObserver</span><span class="p">(</span><span class="nx">iterator</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">PropertyEvent</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">handlerContext</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">base</span><span class="p">.</span><span class="nx">base</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">PropertyEvent</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">Property</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">$mixin</span><span class="p">(</span><span class="nx">Property</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">EventEmitter</span><span class="p">);</span>
    <span class="nx">Property</span><span class="p">.</span><span class="nx">_sourceTrackerStack</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="nx">Property</span><span class="p">.</span><span class="nx">sourceTracker</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">stack</span><span class="p">;</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">stack</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_sourceTrackerStack</span><span class="p">)[</span><span class="nx">stack</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
    <span class="p">};</span>
    <span class="nx">Property</span><span class="p">.</span><span class="nx">defaultAccessor</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
      <span class="p">},</span>
      <span class="nx">set</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">unset</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">x</span><span class="p">;</span>
        <span class="nx">x</span> <span class="o">=</span> <span class="k">this</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
        <span class="k">delete</span> <span class="k">this</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
        <span class="k">return</span> <span class="nx">x</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">cachable</span><span class="o">:</span> <span class="kc">false</span>
    <span class="p">};</span>
    <span class="nx">Property</span><span class="p">.</span><span class="nx">forBaseAndKey</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">base</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">base</span><span class="p">.</span><span class="nx">isObservable</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">base</span><span class="p">.</span><span class="nx">property</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Keypath</span><span class="p">(</span><span class="nx">base</span><span class="p">,</span> <span class="nx">key</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">Property</span><span class="p">.</span><span class="nx">registerSource</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">_ref</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">obj</span><span class="p">.</span><span class="nx">isEventEmitter</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sourceTracker</span><span class="p">())</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="kd">function</span> <span class="nx">Property</span><span class="p">(</span><span class="nx">base</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">base</span> <span class="o">=</span> <span class="nx">base</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">key</span> <span class="o">=</span> <span class="nx">key</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">Property</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_isolationCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">Property</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">cached</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">Property</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="nx">Property</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">sources</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="nx">Property</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">isProperty</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nx">Property</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">isDead</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">Property</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">eventClass</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">PropertyEvent</span><span class="p">;</span>
    <span class="nx">Property</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">isEqual</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">other</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">===</span> <span class="nx">other</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">base</span> <span class="o">===</span> <span class="nx">other</span><span class="p">.</span><span class="nx">base</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">key</span> <span class="o">===</span> <span class="nx">other</span><span class="p">.</span><span class="nx">key</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">Property</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hashKey</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">key</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">hashKey</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">key</span><span class="p">;</span>
      <span class="p">};</span>
      <span class="k">return</span> <span class="nx">key</span> <span class="o">=</span> <span class="s2">&quot;&lt;Batman.Property base: &quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">Batman</span><span class="p">.</span><span class="nx">Hash</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hashKeyFor</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">base</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;, key: \&quot;&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">Batman</span><span class="p">.</span><span class="nx">Hash</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hashKeyFor</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">key</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;\&quot;&gt;&quot;</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">Property</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">changeEvent</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">event</span><span class="p">;</span>
      <span class="nx">event</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">event</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">changeEvent</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">event</span><span class="p">;</span>
      <span class="p">};</span>
      <span class="k">return</span> <span class="nx">event</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">Property</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">accessor</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">accessor</span><span class="p">,</span> <span class="nx">keyAccessors</span><span class="p">,</span> <span class="nx">val</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">,</span> <span class="nx">_ref2</span><span class="p">;</span>
      <span class="nx">keyAccessors</span> <span class="o">=</span> <span class="p">(</span><span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">base</span><span class="p">.</span><span class="nx">_batman</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;keyAccessors&#39;</span><span class="p">)</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span>
      <span class="nx">accessor</span> <span class="o">=</span> <span class="nx">keyAccessors</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">val</span> <span class="o">=</span> <span class="nx">keyAccessors</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">key</span><span class="p">))</span> <span class="o">?</span> <span class="nx">val</span> <span class="o">:</span> <span class="p">((</span><span class="nx">_ref2</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">base</span><span class="p">.</span><span class="nx">_batman</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">_ref2</span><span class="p">.</span><span class="nx">getFirst</span><span class="p">(</span><span class="s1">&#39;defaultAccessor&#39;</span><span class="p">)</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Property</span><span class="p">.</span><span class="nx">defaultAccessor</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">accessor</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">accessor</span><span class="p">;</span>
      <span class="p">};</span>
      <span class="k">return</span> <span class="nx">accessor</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">Property</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">eachObserver</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">iterator</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">key</span><span class="p">;</span>
      <span class="nx">key</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">key</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">changeEvent</span><span class="p">().</span><span class="nx">handlers</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">iterator</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">base</span><span class="p">.</span><span class="nx">isObservable</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">base</span><span class="p">.</span><span class="nx">_batman</span><span class="p">.</span><span class="nx">ancestors</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">ancestor</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">handlers</span><span class="p">,</span> <span class="nx">property</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">ancestor</span><span class="p">.</span><span class="nx">isObservable</span> <span class="o">&amp;&amp;</span> <span class="nx">ancestor</span><span class="p">.</span><span class="nx">hasProperty</span><span class="p">(</span><span class="nx">key</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">property</span> <span class="o">=</span> <span class="nx">ancestor</span><span class="p">.</span><span class="nx">property</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
            <span class="nx">handlers</span> <span class="o">=</span> <span class="nx">property</span><span class="p">.</span><span class="nx">changeEvent</span><span class="p">().</span><span class="nx">handlers</span><span class="p">;</span>
            <span class="k">return</span> <span class="nx">handlers</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">iterator</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">});</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">Property</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">observers</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">results</span><span class="p">;</span>
      <span class="nx">results</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">eachObserver</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">observer</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">observer</span><span class="p">);</span>
      <span class="p">});</span>
      <span class="k">return</span> <span class="nx">results</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">Property</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hasObservers</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">observers</span><span class="p">().</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">Property</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">pushSourceTracker</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Property</span><span class="p">.</span><span class="nx">_sourceTrackerStack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">SimpleSet</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">Property</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">pushDummySourceTracker</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Property</span><span class="p">.</span><span class="nx">_sourceTrackerStack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">Property</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">popSourceTracker</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Property</span><span class="p">.</span><span class="nx">_sourceTrackerStack</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
    <span class="p">};</span>
    <span class="nx">Property</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">updateSourcesFromTracker</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">handler</span><span class="p">,</span> <span class="nx">newSources</span><span class="p">;</span>
      <span class="nx">newSources</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">popSourceTracker</span><span class="p">();</span>
      <span class="nx">handler</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sourceChangeHandler</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_eachSourceChangeEvent</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">e</span><span class="p">.</span><span class="nx">removeHandler</span><span class="p">(</span><span class="nx">handler</span><span class="p">);</span>
      <span class="p">});</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">sources</span> <span class="o">=</span> <span class="nx">newSources</span><span class="p">;</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_eachSourceChangeEvent</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">e</span><span class="p">.</span><span class="nx">addHandler</span><span class="p">(</span><span class="nx">handler</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">};</span>
    <span class="nx">Property</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_eachSourceChangeEvent</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">iterator</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sources</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">sources</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">source</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">iterator</span><span class="p">(</span><span class="nx">source</span><span class="p">.</span><span class="nx">event</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">));</span>
      <span class="p">});</span>
    <span class="p">};</span>
    <span class="nx">Property</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getValue</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">registerAsMutableSource</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">isCached</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">pushSourceTracker</span><span class="p">();</span>
        <span class="k">try</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">valueFromAccessor</span><span class="p">();</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">cached</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">updateSourcesFromTracker</span><span class="p">();</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">value</span> <span class="o">!==</span> <span class="k">void</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">isFinal</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">lockValue</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">Property</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">isCachable</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">cachable</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isFinal</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">cachable</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">accessor</span><span class="p">().</span><span class="nx">cachable</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">cachable</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">!!</span><span class="nx">cachable</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">Property</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">isCached</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">isCachable</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">cached</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">Property</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">isFinal</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="o">!!</span><span class="k">this</span><span class="p">.</span><span class="nx">accessor</span><span class="p">().</span><span class="kr">final</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">Property</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">refresh</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">previousValue</span><span class="p">,</span> <span class="nx">value</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">cached</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="nx">previousValue</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
      <span class="nx">value</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getValue</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">!==</span> <span class="nx">previousValue</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">isIsolated</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">previousValue</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">Property</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">sourceChangeHandler</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">handler</span><span class="p">;</span>
      <span class="nx">handler</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_handleSourceChange</span><span class="p">();</span>
      <span class="p">},</span> <span class="k">this</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">sourceChangeHandler</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">handler</span><span class="p">;</span>
      <span class="p">};</span>
      <span class="k">return</span> <span class="nx">handler</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">Property</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_handleSourceChange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isIsolated</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_needsRefresh</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">hasObservers</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">cached</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">refresh</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">Property</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">valueFromAccessor</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">_ref</span><span class="p">;</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">accessor</span><span class="p">().</span><span class="nx">get</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">base</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">key</span><span class="p">)</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">Property</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setValue</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">set</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">set</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">accessor</span><span class="p">().</span><span class="nx">set</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_changeValue</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">set</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">base</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">key</span><span class="p">,</span> <span class="nx">val</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">};</span>
    <span class="nx">Property</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">unsetValue</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">unset</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">unset</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">accessor</span><span class="p">().</span><span class="nx">unset</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_changeValue</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">unset</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">base</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">key</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">};</span>
    <span class="nx">Property</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_changeValue</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">block</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">result</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">cached</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">pushDummySourceTracker</span><span class="p">();</span>
      <span class="k">try</span> <span class="p">{</span>
        <span class="nx">result</span> <span class="o">=</span> <span class="nx">block</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">refresh</span><span class="p">();</span>
      <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">popSourceTracker</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isCached</span><span class="p">()</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">hasObservers</span><span class="p">()))</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">die</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">Property</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">forget</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">handler</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">handler</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">changeEvent</span><span class="p">().</span><span class="nx">removeHandler</span><span class="p">(</span><span class="nx">handler</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">changeEvent</span><span class="p">().</span><span class="nx">handlers</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">Property</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">observeAndFire</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">handler</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">observe</span><span class="p">(</span><span class="nx">handler</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">handler</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">base</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">Property</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">observe</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">handler</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">changeEvent</span><span class="p">().</span><span class="nx">addHandler</span><span class="p">(</span><span class="nx">handler</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sources</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">getValue</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">Property</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_removeHandlers</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">handler</span><span class="p">;</span>
      <span class="nx">handler</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sourceChangeHandler</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_eachSourceChangeEvent</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">e</span><span class="p">.</span><span class="nx">removeHandler</span><span class="p">(</span><span class="nx">handler</span><span class="p">);</span>
      <span class="p">});</span>
      <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">sources</span><span class="p">;</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">changeEvent</span><span class="p">().</span><span class="nx">handlers</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span>
    <span class="p">};</span>
    <span class="nx">Property</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">lockValue</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_removeHandlers</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">getValue</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
      <span class="p">};</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">setValue</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">unsetValue</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">refresh</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">observe</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{};</span>
    <span class="p">};</span>
    <span class="nx">Property</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">die</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">_ref</span><span class="p">,</span> <span class="nx">_ref2</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_removeHandlers</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">((</span><span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">base</span><span class="p">.</span><span class="nx">_batman</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">((</span><span class="nx">_ref2</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">properties</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">_ref2</span><span class="p">.</span><span class="nx">unset</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">key</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">isDead</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">Property</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">fire</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">_ref</span><span class="p">;</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">changeEvent</span><span class="p">()).</span><span class="nx">fire</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">_ref</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">Property</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">isolate</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_isolationCount</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_preIsolationValue</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getValue</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_isolationCount</span><span class="o">++</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">Property</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">expose</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_isolationCount</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_isolationCount</span><span class="o">--</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_needsRefresh</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_preIsolationValue</span><span class="p">;</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">refresh</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">value</span> <span class="o">!==</span> <span class="k">this</span><span class="p">.</span><span class="nx">_preIsolationValue</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_preIsolationValue</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_preIsolationValue</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_isolationCount</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_isolationCount</span><span class="o">--</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">Property</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">isIsolated</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_isolationCount</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">Property</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">Keypath</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">Keypath</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Property</span><span class="p">);</span>
    <span class="kd">function</span> <span class="nx">Keypath</span><span class="p">(</span><span class="nx">base</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">$typeOf</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;String&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">segments</span> <span class="o">=</span> <span class="nx">key</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">depth</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">segments</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">segments</span> <span class="o">=</span> <span class="p">[</span><span class="nx">key</span><span class="p">];</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">depth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">Keypath</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">Keypath</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">begin</span><span class="p">,</span> <span class="nx">end</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">base</span><span class="p">,</span> <span class="nx">segment</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">end</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">end</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">depth</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">base</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">base</span><span class="p">;</span>
      <span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">segments</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">begin</span><span class="p">);</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">segment</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">((</span><span class="nx">base</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">base</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Property</span><span class="p">.</span><span class="nx">forBaseAndKey</span><span class="p">(</span><span class="nx">base</span><span class="p">,</span> <span class="nx">segment</span><span class="p">).</span><span class="nx">getValue</span><span class="p">())))</span> <span class="p">{</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Property</span><span class="p">.</span><span class="nx">forBaseAndKey</span><span class="p">(</span><span class="nx">base</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">segments</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">begin</span><span class="p">,</span> <span class="nx">end</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">));</span>
    <span class="p">};</span>
    <span class="nx">Keypath</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">terminalProperty</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">Keypath</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">valueFromAccessor</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">_ref</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">depth</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Keypath</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">valueFromAccessor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">terminalProperty</span><span class="p">())</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">getValue</span><span class="p">()</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">Keypath</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setValue</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">_ref</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">depth</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Keypath</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">setValue</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">terminalProperty</span><span class="p">())</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">Keypath</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">unsetValue</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">_ref</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">depth</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Keypath</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">unsetValue</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">terminalProperty</span><span class="p">())</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">unsetValue</span><span class="p">()</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">Keypath</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">Observable</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">isObservable</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">hasProperty</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">_ref</span><span class="p">,</span> <span class="nx">_ref2</span><span class="p">;</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_batman</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="p">(</span><span class="nx">_ref2</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">properties</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="k">typeof</span> <span class="nx">_ref2</span><span class="p">.</span><span class="nx">hasKey</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span> <span class="o">?</span> <span class="nx">_ref2</span><span class="p">.</span><span class="nx">hasKey</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">property</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">properties</span><span class="p">,</span> <span class="nx">propertyClass</span><span class="p">,</span> <span class="nx">_base</span><span class="p">;</span>
      <span class="nx">Batman</span><span class="p">.</span><span class="nx">initializeObject</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="nx">propertyClass</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">propertyClass</span> <span class="o">||</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Keypath</span><span class="p">;</span>
      <span class="nx">properties</span> <span class="o">=</span> <span class="p">(</span><span class="nx">_base</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_batman</span><span class="p">).</span><span class="nx">properties</span> <span class="o">||</span> <span class="p">(</span><span class="nx">_base</span><span class="p">.</span><span class="nx">properties</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">SimpleHash</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">properties</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="o">||</span> <span class="nx">properties</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="k">new</span> <span class="nx">propertyClass</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">key</span><span class="p">));</span>
    <span class="p">},</span>
    <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">property</span><span class="p">(</span><span class="nx">key</span><span class="p">).</span><span class="nx">getValue</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="nx">set</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">property</span><span class="p">(</span><span class="nx">key</span><span class="p">).</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">val</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">unset</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">property</span><span class="p">(</span><span class="nx">key</span><span class="p">).</span><span class="nx">unsetValue</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="nx">getOrSet</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">valueFunction</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">currentValue</span><span class="p">;</span>
      <span class="nx">currentValue</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">currentValue</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">currentValue</span> <span class="o">=</span> <span class="nx">valueFunction</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">currentValue</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">currentValue</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">forget</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">observer</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">_ref</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">property</span><span class="p">(</span><span class="nx">key</span><span class="p">).</span><span class="nx">forget</span><span class="p">(</span><span class="nx">observer</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">((</span><span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_batman</span><span class="p">.</span><span class="nx">properties</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">_ref</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">property</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">property</span><span class="p">.</span><span class="nx">forget</span><span class="p">();</span>
          <span class="p">});</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">observe</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">;</span>
      <span class="nx">key</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">args</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">&lt;=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">:</span> <span class="p">[];</span>
      <span class="p">(</span><span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">property</span><span class="p">(</span><span class="nx">key</span><span class="p">)).</span><span class="nx">observe</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">_ref</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">observeAndFire</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">;</span>
      <span class="nx">key</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">args</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">&lt;=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">:</span> <span class="p">[];</span>
      <span class="p">(</span><span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">property</span><span class="p">(</span><span class="nx">key</span><span class="p">)).</span><span class="nx">observeAndFire</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">_ref</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="nx">$get</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">get</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">base</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">((</span><span class="nx">base</span><span class="p">.</span><span class="nx">get</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">base</span><span class="p">.</span><span class="nx">get</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">base</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Property</span><span class="p">.</span><span class="nx">forBaseAndKey</span><span class="p">(</span><span class="nx">base</span><span class="p">,</span> <span class="nx">key</span><span class="p">).</span><span class="nx">getValue</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">initializeObject</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">object</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">object</span><span class="p">.</span><span class="nx">_batman</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">object</span><span class="p">.</span><span class="nx">_batman</span><span class="p">.</span><span class="nx">check</span><span class="p">(</span><span class="nx">object</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">object</span><span class="p">.</span><span class="nx">_batman</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">_Batman</span><span class="p">(</span><span class="nx">object</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">_Batman</span> <span class="o">=</span> <span class="nx">_Batman</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">_Batman</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">mixins</span><span class="p">,</span> <span class="nx">object</span><span class="p">;</span>
      <span class="nx">object</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">mixins</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">&lt;=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">:</span> <span class="p">[];</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">object</span> <span class="o">=</span> <span class="nx">object</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">mixins</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$mixin</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="p">[</span><span class="k">this</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">mixins</span><span class="p">)));</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">_Batman</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">check</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">object</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">object</span> <span class="o">!==</span> <span class="k">this</span><span class="p">.</span><span class="nx">object</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">object</span><span class="p">.</span><span class="nx">_batman</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">_Batman</span><span class="p">(</span><span class="nx">object</span><span class="p">);</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">_Batman</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">get</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">results</span><span class="p">;</span>
      <span class="nx">results</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getAll</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
      <span class="k">switch</span> <span class="p">(</span><span class="nx">results</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
          <span class="k">return</span> <span class="nx">results</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="k">default</span><span class="o">:</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">results</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">concat</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">results</span> <span class="o">=</span> <span class="nx">results</span><span class="p">.</span><span class="nx">reduceRight</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">return</span> <span class="nx">a</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">b</span><span class="p">);</span>
            <span class="p">});</span>
          <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">results</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">merge</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">results</span> <span class="o">=</span> <span class="nx">results</span><span class="p">.</span><span class="nx">reduceRight</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">return</span> <span class="nx">a</span><span class="p">.</span><span class="nx">merge</span><span class="p">(</span><span class="nx">b</span><span class="p">);</span>
            <span class="p">});</span>
          <span class="p">}</span>
          <span class="k">return</span> <span class="nx">results</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">_Batman</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getFirst</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">results</span><span class="p">;</span>
      <span class="nx">results</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getAll</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">results</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="p">};</span>
    <span class="nx">_Batman</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getAll</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">keyOrGetter</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">getter</span><span class="p">,</span> <span class="nx">results</span><span class="p">,</span> <span class="nx">val</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">keyOrGetter</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">getter</span> <span class="o">=</span> <span class="nx">keyOrGetter</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">getter</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ancestor</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">_ref</span><span class="p">;</span>
          <span class="k">return</span> <span class="p">(</span><span class="nx">_ref</span> <span class="o">=</span> <span class="nx">ancestor</span><span class="p">.</span><span class="nx">_batman</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">_ref</span><span class="p">[</span><span class="nx">keyOrGetter</span><span class="p">]</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">};</span>
      <span class="p">}</span>
      <span class="nx">results</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">ancestors</span><span class="p">(</span><span class="nx">getter</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">val</span> <span class="o">=</span> <span class="nx">getter</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">object</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">results</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span><span class="nx">val</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">results</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">_Batman</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">ancestors</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">getter</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">isClass</span><span class="p">,</span> <span class="nx">parent</span><span class="p">,</span> <span class="nx">proto</span><span class="p">,</span> <span class="nx">results</span><span class="p">,</span> <span class="nx">val</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">,</span> <span class="nx">_ref2</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">getter</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">getter</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">x</span><span class="p">;</span>
        <span class="p">};</span>
      <span class="p">}</span>
      <span class="nx">results</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="nx">isClass</span> <span class="o">=</span> <span class="o">!!</span><span class="k">this</span><span class="p">.</span><span class="nx">object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
      <span class="nx">parent</span> <span class="o">=</span> <span class="nx">isClass</span> <span class="o">?</span> <span class="p">(</span><span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">object</span><span class="p">.</span><span class="nx">__super__</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span> <span class="o">:</span> <span class="p">(</span><span class="nx">proto</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">getPrototypeOf</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">object</span><span class="p">))</span> <span class="o">===</span> <span class="k">this</span><span class="p">.</span><span class="nx">object</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">object</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">__super__</span> <span class="o">:</span> <span class="nx">proto</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">parent</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">((</span><span class="nx">_ref2</span> <span class="o">=</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">_batman</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">_ref2</span><span class="p">.</span><span class="nx">check</span><span class="p">(</span><span class="nx">parent</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">val</span> <span class="o">=</span> <span class="nx">getter</span><span class="p">(</span><span class="nx">parent</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">val</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">val</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">parent</span><span class="p">.</span><span class="nx">_batman</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">results</span> <span class="o">=</span> <span class="nx">results</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">parent</span><span class="p">.</span><span class="nx">_batman</span><span class="p">.</span><span class="nx">ancestors</span><span class="p">(</span><span class="nx">getter</span><span class="p">));</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">results</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">_Batman</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">set</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">_Batman</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">BatmanObject</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">counter</span><span class="p">,</span> <span class="nx">getAccessorObject</span><span class="p">;</span>
    <span class="nx">Batman</span><span class="p">.</span><span class="nx">initializeObject</span><span class="p">(</span><span class="nx">BatmanObject</span><span class="p">);</span>
    <span class="nx">Batman</span><span class="p">.</span><span class="nx">initializeObject</span><span class="p">(</span><span class="nx">BatmanObject</span><span class="p">.</span><span class="nx">prototype</span><span class="p">);</span>
    <span class="nx">BatmanObject</span><span class="p">.</span><span class="nx">global</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">isGlobal</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">isGlobal</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">container</span><span class="p">[</span><span class="nx">$functionName</span><span class="p">(</span><span class="k">this</span><span class="p">)]</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">BatmanObject</span><span class="p">.</span><span class="nx">classMixin</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">$mixin</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="p">[</span><span class="k">this</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)));</span>
    <span class="p">};</span>
    <span class="nx">BatmanObject</span><span class="p">.</span><span class="nx">mixin</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">classMixin</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">BatmanObject</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">mixin</span> <span class="o">=</span> <span class="nx">BatmanObject</span><span class="p">.</span><span class="nx">classMixin</span><span class="p">;</span>
    <span class="nx">counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">BatmanObject</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_objectID</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">c</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_objectID</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">c</span><span class="p">;</span>
      <span class="p">};</span>
      <span class="k">return</span> <span class="nx">c</span> <span class="o">=</span> <span class="nx">counter</span><span class="o">++</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">BatmanObject</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hashKey</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">key</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="k">this</span><span class="p">.</span><span class="nx">isEqual</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">hashKey</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">key</span><span class="p">;</span>
      <span class="p">};</span>
      <span class="k">return</span> <span class="nx">key</span> <span class="o">=</span> <span class="s2">&quot;&lt;Batman.Object &quot;</span> <span class="o">+</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_objectID</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;&gt;&quot;</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">BatmanObject</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toJSON</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">obj</span><span class="p">,</span> <span class="nx">value</span><span class="p">;</span>
      <span class="nx">obj</span> <span class="o">=</span> <span class="p">{};</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">key</span> <span class="k">in</span> <span class="k">this</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">__hasProp</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">key</span><span class="p">))</span> <span class="k">continue</span><span class="p">;</span>
        <span class="nx">value</span> <span class="o">=</span> <span class="k">this</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">key</span> <span class="o">!==</span> <span class="s2">&quot;_batman&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">key</span> <span class="o">!==</span> <span class="s2">&quot;hashKey&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">key</span> <span class="o">!==</span> <span class="s2">&quot;_objectID&quot;</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">.</span><span class="nx">toJSON</span> <span class="o">?</span> <span class="nx">value</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">()</span> <span class="o">:</span> <span class="nx">value</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">obj</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">getAccessorObject</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">accessor</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">accessor</span><span class="p">.</span><span class="nx">get</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">accessor</span><span class="p">.</span><span class="nx">set</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">accessor</span><span class="p">.</span><span class="nx">unset</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">accessor</span> <span class="o">=</span> <span class="p">{</span>
          <span class="nx">get</span><span class="o">:</span> <span class="nx">accessor</span>
        <span class="p">};</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">accessor</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">BatmanObject</span><span class="p">.</span><span class="nx">classAccessor</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">accessor</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">keys</span><span class="p">,</span> <span class="nx">_base</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_j</span><span class="p">,</span> <span class="nx">_len</span><span class="p">,</span> <span class="nx">_results</span><span class="p">;</span>
      <span class="nx">keys</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">&lt;=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_i</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">:</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[]),</span> <span class="nx">accessor</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="nx">_i</span><span class="o">++</span><span class="p">];</span>
      <span class="nx">Batman</span><span class="p">.</span><span class="nx">initializeObject</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">keys</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_batman</span><span class="p">.</span><span class="nx">defaultAccessor</span> <span class="o">=</span> <span class="nx">getAccessorObject</span><span class="p">(</span><span class="nx">accessor</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="p">(</span><span class="nx">_base</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_batman</span><span class="p">).</span><span class="nx">keyAccessors</span> <span class="o">||</span> <span class="p">(</span><span class="nx">_base</span><span class="p">.</span><span class="nx">keyAccessors</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">SimpleHash</span><span class="p">);</span>
        <span class="nx">_results</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">_j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_j</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">key</span> <span class="o">=</span> <span class="nx">keys</span><span class="p">[</span><span class="nx">_j</span><span class="p">];</span>
          <span class="nx">_results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_batman</span><span class="p">.</span><span class="nx">keyAccessors</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">getAccessorObject</span><span class="p">(</span><span class="nx">accessor</span><span class="p">)));</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">_results</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">BatmanObject</span><span class="p">.</span><span class="nx">accessor</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">classAccessor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">BatmanObject</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">accessor</span> <span class="o">=</span> <span class="nx">BatmanObject</span><span class="p">.</span><span class="nx">classAccessor</span><span class="p">;</span>
    <span class="kd">function</span> <span class="nx">BatmanObject</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">mixins</span><span class="p">;</span>
      <span class="nx">mixins</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="p">[];</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_batman</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">_Batman</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">mixin</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">mixins</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">BatmanObject</span><span class="p">.</span><span class="nx">classMixin</span><span class="p">(</span><span class="nx">Batman</span><span class="p">.</span><span class="nx">EventEmitter</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Observable</span><span class="p">);</span>
    <span class="nx">BatmanObject</span><span class="p">.</span><span class="nx">mixin</span><span class="p">(</span><span class="nx">Batman</span><span class="p">.</span><span class="nx">EventEmitter</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Observable</span><span class="p">);</span>
    <span class="nx">BatmanObject</span><span class="p">.</span><span class="nx">observeAll</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">observe</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">BatmanObject</span><span class="p">.</span><span class="nx">singleton</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">singletonMethodName</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">singletonMethodName</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">singletonMethodName</span> <span class="o">=</span> <span class="s2">&quot;sharedInstance&quot;</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">classAccessor</span><span class="p">(</span><span class="nx">singletonMethodName</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">_name</span><span class="p">;</span>
          <span class="k">return</span> <span class="k">this</span><span class="p">[</span><span class="nx">_name</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nx">singletonMethodName</span><span class="p">]</span> <span class="o">||</span> <span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="nx">_name</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="k">this</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">});</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">BatmanObject</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nb">Object</span> <span class="o">=</span> <span class="nx">BatmanObject</span><span class="p">;</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">Accessible</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">Accessible</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nb">Object</span><span class="p">);</span>
    <span class="kd">function</span> <span class="nx">Accessible</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">accessor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">Accessible</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">TerminalAccessible</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">TerminalAccessible</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Accessible</span><span class="p">);</span>
    <span class="kd">function</span> <span class="nx">TerminalAccessible</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">TerminalAccessible</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">TerminalAccessible</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">propertyClass</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Property</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">TerminalAccessible</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">Enumerable</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">isEnumerable</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">map</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">r</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">ctx</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">container</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">r</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">r</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">f</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">));</span>
      <span class="p">});</span>
      <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">every</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">r</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">ctx</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">container</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">r</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">r</span> <span class="o">&amp;&amp;</span> <span class="nx">f</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
      <span class="p">});</span>
      <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">some</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">r</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">ctx</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">container</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">r</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">r</span> <span class="o">||</span> <span class="nx">f</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
      <span class="p">});</span>
      <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">reduce</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">r</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">count</span><span class="p">,</span> <span class="nx">self</span><span class="p">;</span>
      <span class="nx">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">r</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">f</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="p">[</span><span class="nx">r</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">),</span> <span class="p">[</span><span class="nx">count</span><span class="p">],</span> <span class="p">[</span><span class="nx">self</span><span class="p">]));</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="p">}</span>
      <span class="p">});</span>
      <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">filter</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">wrap</span><span class="p">;</span>
      <span class="nx">r</span> <span class="o">=</span> <span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">add</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">wrap</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">f</span><span class="p">(</span><span class="nx">e</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">r</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
        <span class="p">};</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">set</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">wrap</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">f</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="nx">v</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">r</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="nx">v</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
        <span class="p">};</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">r</span><span class="p">.</span><span class="nx">push</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">r</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="p">}</span>
        <span class="nx">wrap</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">f</span><span class="p">(</span><span class="nx">e</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">r</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
        <span class="p">};</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">reduce</span><span class="p">(</span><span class="nx">wrap</span><span class="p">,</span> <span class="nx">r</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="nx">$extendsEnumerable</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">onto</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">,</span> <span class="nx">_results</span><span class="p">;</span>
    <span class="nx">_ref</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Enumerable</span><span class="p">;</span>
    <span class="nx">_results</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="k">in</span> <span class="nx">_ref</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">v</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>
      <span class="nx">_results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">onto</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">v</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">_results</span><span class="p">;</span>
  <span class="p">};</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">SimpleHash</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">SimpleHash</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_storage</span> <span class="o">=</span> <span class="p">{};</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">$extendsEnumerable</span><span class="p">(</span><span class="nx">SimpleHash</span><span class="p">.</span><span class="nx">prototype</span><span class="p">);</span>
    <span class="nx">SimpleHash</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">propertyClass</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Property</span><span class="p">;</span>
    <span class="nx">SimpleHash</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hasKey</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">pair</span><span class="p">,</span> <span class="nx">pairs</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">pairs</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_storage</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">hashKeyFor</span><span class="p">(</span><span class="nx">key</span><span class="p">)])</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">pairs</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">pair</span> <span class="o">=</span> <span class="nx">pairs</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">equality</span><span class="p">(</span><span class="nx">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">key</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">SimpleHash</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">get</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">pair</span><span class="p">,</span> <span class="nx">pairs</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">pairs</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_storage</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">hashKeyFor</span><span class="p">(</span><span class="nx">key</span><span class="p">)])</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">pairs</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">pair</span> <span class="o">=</span> <span class="nx">pairs</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">equality</span><span class="p">(</span><span class="nx">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">key</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">SimpleHash</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">set</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">pair</span><span class="p">,</span> <span class="nx">pairs</span><span class="p">,</span> <span class="nx">_base</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">,</span> <span class="nx">_name</span><span class="p">;</span>
      <span class="nx">pairs</span> <span class="o">=</span> <span class="p">(</span><span class="nx">_base</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_storage</span><span class="p">)[</span><span class="nx">_name</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">hashKeyFor</span><span class="p">(</span><span class="nx">key</span><span class="p">)]</span> <span class="o">||</span> <span class="p">(</span><span class="nx">_base</span><span class="p">[</span><span class="nx">_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]);</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">pairs</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">pair</span> <span class="o">=</span> <span class="nx">pairs</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">equality</span><span class="p">(</span><span class="nx">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">key</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">length</span><span class="o">++</span><span class="p">;</span>
      <span class="nx">pairs</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="nx">key</span><span class="p">,</span> <span class="nx">val</span><span class="p">]);</span>
      <span class="k">return</span> <span class="nx">val</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">SimpleHash</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">unset</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">hashKey</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">obj</span><span class="p">,</span> <span class="nx">pair</span><span class="p">,</span> <span class="nx">pairs</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">_len</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">;</span>
      <span class="nx">hashKey</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">hashKeyFor</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">pairs</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_storage</span><span class="p">[</span><span class="nx">hashKey</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">pairs</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">index</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">index</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">_ref</span> <span class="o">=</span> <span class="nx">pairs</span><span class="p">[</span><span class="nx">index</span><span class="p">],</span> <span class="nx">obj</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">equality</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">key</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">pair</span> <span class="o">=</span> <span class="nx">pairs</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">pairs</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">_storage</span><span class="p">[</span><span class="nx">hashKey</span><span class="p">];</span>
            <span class="p">}</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">length</span><span class="o">--</span><span class="p">;</span>
            <span class="k">return</span> <span class="nx">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">SimpleHash</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getOrSet</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">getOrSet</span><span class="p">;</span>
    <span class="nx">SimpleHash</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hashKeyFor</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">obj</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="k">typeof</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">hashKey</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span> <span class="o">?</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">hashKey</span><span class="p">()</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="nx">obj</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">SimpleHash</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">equality</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">lhs</span><span class="p">,</span> <span class="nx">rhs</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">lhs</span> <span class="o">===</span> <span class="nx">rhs</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">lhs</span> <span class="o">!==</span> <span class="nx">lhs</span> <span class="o">&amp;&amp;</span> <span class="nx">rhs</span> <span class="o">!==</span> <span class="nx">rhs</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">((</span><span class="nx">lhs</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="k">typeof</span> <span class="nx">lhs</span><span class="p">.</span><span class="nx">isEqual</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span> <span class="o">?</span> <span class="nx">lhs</span><span class="p">.</span><span class="nx">isEqual</span><span class="p">(</span><span class="nx">rhs</span><span class="p">)</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">rhs</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="k">typeof</span> <span class="nx">rhs</span><span class="p">.</span><span class="nx">isEqual</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span> <span class="o">?</span> <span class="nx">rhs</span><span class="p">.</span><span class="nx">isEqual</span><span class="p">(</span><span class="nx">lhs</span><span class="p">)</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">SimpleHash</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">forEach</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">iterator</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">obj</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">values</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">,</span> <span class="nx">_results</span><span class="p">;</span>
      <span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_storage</span><span class="p">;</span>
      <span class="nx">_results</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">key</span> <span class="k">in</span> <span class="nx">_ref</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">values</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
        <span class="nx">_results</span><span class="p">.</span><span class="nx">push</span><span class="p">((</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">,</span> <span class="nx">_ref2</span><span class="p">,</span> <span class="nx">_ref3</span><span class="p">,</span> <span class="nx">_results2</span><span class="p">;</span>
          <span class="nx">_ref2</span> <span class="o">=</span> <span class="nx">values</span><span class="p">.</span><span class="nx">slice</span><span class="p">();</span>
          <span class="nx">_results2</span> <span class="o">=</span> <span class="p">[];</span>
          <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">_ref2</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">_ref3</span> <span class="o">=</span> <span class="nx">_ref2</span><span class="p">[</span><span class="nx">_i</span><span class="p">],</span> <span class="nx">obj</span> <span class="o">=</span> <span class="nx">_ref3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">_ref3</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
            <span class="nx">_results2</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">iterator</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">value</span><span class="p">));</span>
          <span class="p">}</span>
          <span class="k">return</span> <span class="nx">_results2</span><span class="p">;</span>
        <span class="p">})());</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">_results</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">SimpleHash</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">keys</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">result</span><span class="p">;</span>
      <span class="nx">result</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="nx">Batman</span><span class="p">.</span><span class="nx">SimpleHash</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">forEach</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
      <span class="p">});</span>
      <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">SimpleHash</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">clear</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_storage</span> <span class="o">=</span> <span class="p">{};</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">SimpleHash</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">isEmpty</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">SimpleHash</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">merge</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">hash</span><span class="p">,</span> <span class="nx">merged</span><span class="p">,</span> <span class="nx">others</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">;</span>
      <span class="nx">others</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="p">[];</span>
      <span class="nx">merged</span> <span class="o">=</span> <span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">;</span>
      <span class="nx">others</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">others</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">hash</span> <span class="o">=</span> <span class="nx">others</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
        <span class="nx">hash</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">merged</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
        <span class="p">});</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">merged</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">SimpleHash</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toJSON</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">reduce</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">.</span><span class="nx">toJSON</span> <span class="o">?</span> <span class="nx">value</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">()</span> <span class="o">:</span> <span class="nx">value</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">obj</span><span class="p">;</span>
      <span class="p">},</span> <span class="p">{});</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">SimpleHash</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">Hash</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">proto</span><span class="p">,</span> <span class="nx">_fn</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">;</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">Hash</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nb">Object</span><span class="p">);</span>
    <span class="kd">function</span> <span class="nx">Hash</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">self</span><span class="p">;</span>
      <span class="nx">Batman</span><span class="p">.</span><span class="nx">SimpleHash</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">meta</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nb">Object</span><span class="p">;</span>
      <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">accessor</span><span class="p">(</span><span class="s1">&#39;length&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">registerAsMutableSource</span><span class="p">();</span>
        <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
      <span class="p">});</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">accessor</span><span class="p">(</span><span class="s1">&#39;isEmpty&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">();</span>
      <span class="p">});</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">accessor</span><span class="p">(</span><span class="s1">&#39;keys&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">keys</span><span class="p">();</span>
      <span class="p">});</span>
      <span class="nx">Hash</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">$extendsEnumerable</span><span class="p">(</span><span class="nx">Hash</span><span class="p">.</span><span class="nx">prototype</span><span class="p">);</span>
    <span class="nx">Hash</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">propertyClass</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Property</span><span class="p">;</span>
    <span class="nx">Hash</span><span class="p">.</span><span class="nx">accessor</span><span class="p">({</span>
      <span class="nx">get</span><span class="o">:</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">SimpleHash</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">get</span><span class="p">,</span>
      <span class="nx">set</span><span class="o">:</span> <span class="nx">Hash</span><span class="p">.</span><span class="nx">mutation</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">result</span><span class="p">;</span>
        <span class="nx">result</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">SimpleHash</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">set</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="s1">&#39;itemsWereAdded&#39;</span><span class="p">,</span> <span class="nx">key</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
      <span class="p">}),</span>
      <span class="nx">unset</span><span class="o">:</span> <span class="nx">Hash</span><span class="p">.</span><span class="nx">mutation</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">result</span><span class="p">;</span>
        <span class="nx">result</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">SimpleHash</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">unset</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">key</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">result</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="s1">&#39;itemsWereRemoved&#39;</span><span class="p">,</span> <span class="nx">key</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
      <span class="p">}),</span>
      <span class="nx">cachable</span><span class="o">:</span> <span class="kc">false</span>
    <span class="p">});</span>
    <span class="nx">Hash</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">clear</span> <span class="o">=</span> <span class="nx">Hash</span><span class="p">.</span><span class="nx">mutation</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">keys</span><span class="p">,</span> <span class="nx">result</span><span class="p">;</span>
      <span class="nx">keys</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;keys&#39;</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">unset</span><span class="p">(</span><span class="nx">k</span><span class="p">);</span>
      <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
      <span class="nx">result</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">SimpleHash</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">clear</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">fire</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;itemsWereRemoved&#39;</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">keys</span><span class="p">)));</span>
      <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
    <span class="p">});</span>
    <span class="nx">Hash</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">equality</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">SimpleHash</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">equality</span><span class="p">;</span>
    <span class="nx">Hash</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hashKeyFor</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">SimpleHash</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hashKeyFor</span><span class="p">;</span>
    <span class="nx">_ref</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;hasKey&#39;</span><span class="p">,</span> <span class="s1">&#39;forEach&#39;</span><span class="p">,</span> <span class="s1">&#39;isEmpty&#39;</span><span class="p">,</span> <span class="s1">&#39;keys&#39;</span><span class="p">,</span> <span class="s1">&#39;merge&#39;</span><span class="p">,</span> <span class="s1">&#39;toJSON&#39;</span><span class="p">];</span>
    <span class="nx">_fn</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">proto</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">registerAsMutableSource</span><span class="p">();</span>
        <span class="k">return</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">SimpleHash</span><span class="p">.</span><span class="nx">prototype</span><span class="p">[</span><span class="nx">k</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
      <span class="p">};</span>
    <span class="p">};</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">k</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
      <span class="nx">proto</span> <span class="o">=</span> <span class="nx">Hash</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
      <span class="nx">_fn</span><span class="p">(</span><span class="nx">k</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">Hash</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">SimpleSet</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">SimpleSet</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_storage</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">SimpleHash</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_indexes</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">SimpleHash</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_sorts</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">SimpleHash</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">add</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">$extendsEnumerable</span><span class="p">(</span><span class="nx">SimpleSet</span><span class="p">.</span><span class="nx">prototype</span><span class="p">);</span>
    <span class="nx">SimpleSet</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">has</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_storage</span><span class="p">.</span><span class="nx">hasKey</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">SimpleSet</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">add</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">addedItems</span><span class="p">,</span> <span class="nx">item</span><span class="p">,</span> <span class="nx">items</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">;</span>
      <span class="nx">items</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="p">[];</span>
      <span class="nx">addedItems</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">items</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">item</span> <span class="o">=</span> <span class="nx">items</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_storage</span><span class="p">.</span><span class="nx">hasKey</span><span class="p">(</span><span class="nx">item</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">_storage</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
          <span class="nx">addedItems</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">length</span><span class="o">++</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">fire</span> <span class="o">&amp;&amp;</span> <span class="nx">addedItems</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">fire</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;itemsWereAdded&#39;</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">addedItems</span><span class="p">)));</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">addedItems</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">SimpleSet</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">remove</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">item</span><span class="p">,</span> <span class="nx">items</span><span class="p">,</span> <span class="nx">removedItems</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">;</span>
      <span class="nx">items</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="p">[];</span>
      <span class="nx">removedItems</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">items</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">item</span> <span class="o">=</span> <span class="nx">items</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_storage</span><span class="p">.</span><span class="nx">hasKey</span><span class="p">(</span><span class="nx">item</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">_storage</span><span class="p">.</span><span class="nx">unset</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
          <span class="nx">removedItems</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">length</span><span class="o">--</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">fire</span> <span class="o">&amp;&amp;</span> <span class="nx">removedItems</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">fire</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;itemsWereRemoved&#39;</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">removedItems</span><span class="p">)));</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">removedItems</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">SimpleSet</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">forEach</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">iterator</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_storage</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">iterator</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">};</span>
    <span class="nx">SimpleSet</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">isEmpty</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">SimpleSet</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">clear</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">items</span><span class="p">;</span>
      <span class="nx">items</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">toArray</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_storage</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">SimpleHash</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">fire</span> <span class="o">&amp;&amp;</span> <span class="nx">items</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">fire</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;itemsWereRemoved&#39;</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">items</span><span class="p">)));</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">items</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">SimpleSet</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toArray</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_storage</span><span class="p">.</span><span class="nx">keys</span><span class="p">();</span>
    <span class="p">};</span>
    <span class="nx">SimpleSet</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">merge</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">merged</span><span class="p">,</span> <span class="nx">others</span><span class="p">,</span> <span class="nx">set</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">;</span>
      <span class="nx">others</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="p">[];</span>
      <span class="nx">merged</span> <span class="o">=</span> <span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">;</span>
      <span class="nx">others</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">others</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">set</span> <span class="o">=</span> <span class="nx">others</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
        <span class="nx">set</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">merged</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">v</span><span class="p">);</span>
        <span class="p">});</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">merged</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">SimpleSet</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">indexedBy</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_indexes</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">_indexes</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">SetIndex</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">key</span><span class="p">));</span>
    <span class="p">};</span>
    <span class="nx">SimpleSet</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">sortedBy</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">order</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">sortsForKey</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">order</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">order</span> <span class="o">=</span> <span class="s2">&quot;asc&quot;</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">order</span> <span class="o">=</span> <span class="nx">order</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">===</span> <span class="s2">&quot;desc&quot;</span> <span class="o">?</span> <span class="s2">&quot;desc&quot;</span> <span class="o">:</span> <span class="s2">&quot;asc&quot;</span><span class="p">;</span>
      <span class="nx">sortsForKey</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_sorts</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">_sorts</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nb">Object</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">sortsForKey</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">order</span><span class="p">)</span> <span class="o">||</span> <span class="nx">sortsForKey</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">order</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">SetSort</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">order</span><span class="p">));</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">SimpleSet</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">Set</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">proto</span><span class="p">,</span> <span class="nx">_fn</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_j</span><span class="p">,</span> <span class="nx">_len</span><span class="p">,</span> <span class="nx">_len2</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">,</span> <span class="nx">_ref2</span><span class="p">;</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">Set</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nb">Object</span><span class="p">);</span>
    <span class="kd">function</span> <span class="nx">Set</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">Batman</span><span class="p">.</span><span class="nx">SimpleSet</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">$extendsEnumerable</span><span class="p">(</span><span class="nx">Set</span><span class="p">.</span><span class="nx">prototype</span><span class="p">);</span>
    <span class="nx">_ref</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="s1">&#39;remove&#39;</span><span class="p">,</span> <span class="s1">&#39;clear&#39;</span><span class="p">,</span> <span class="s1">&#39;indexedBy&#39;</span><span class="p">,</span> <span class="s1">&#39;sortedBy&#39;</span><span class="p">];</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">k</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
      <span class="nx">Set</span><span class="p">.</span><span class="nx">prototype</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">SimpleSet</span><span class="p">.</span><span class="nx">prototype</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="nx">_ref2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;merge&#39;</span><span class="p">,</span> <span class="s1">&#39;forEach&#39;</span><span class="p">,</span> <span class="s1">&#39;toArray&#39;</span><span class="p">,</span> <span class="s1">&#39;isEmpty&#39;</span><span class="p">,</span> <span class="s1">&#39;has&#39;</span><span class="p">];</span>
    <span class="nx">_fn</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">proto</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">registerAsMutableSource</span><span class="p">();</span>
        <span class="k">return</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">SimpleSet</span><span class="p">.</span><span class="nx">prototype</span><span class="p">[</span><span class="nx">k</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
      <span class="p">};</span>
    <span class="p">};</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">_j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len2</span> <span class="o">=</span> <span class="nx">_ref2</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_j</span> <span class="o">&lt;</span> <span class="nx">_len2</span><span class="p">;</span> <span class="nx">_j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">k</span> <span class="o">=</span> <span class="nx">_ref2</span><span class="p">[</span><span class="nx">_j</span><span class="p">];</span>
      <span class="nx">proto</span> <span class="o">=</span> <span class="nx">Set</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
      <span class="nx">_fn</span><span class="p">(</span><span class="nx">k</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">Set</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toJSON</span> <span class="o">=</span> <span class="nx">Set</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toArray</span><span class="p">;</span>
    <span class="nx">Set</span><span class="p">.</span><span class="nx">accessor</span><span class="p">(</span><span class="s1">&#39;indexedBy&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">TerminalAccessible</span><span class="p">(</span><span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">indexedBy</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
      <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
    <span class="p">});</span>
    <span class="nx">Set</span><span class="p">.</span><span class="nx">accessor</span><span class="p">(</span><span class="s1">&#39;sortedBy&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">TerminalAccessible</span><span class="p">(</span><span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">sortedBy</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
      <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
    <span class="p">});</span>
    <span class="nx">Set</span><span class="p">.</span><span class="nx">accessor</span><span class="p">(</span><span class="s1">&#39;sortedByDescending&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">TerminalAccessible</span><span class="p">(</span><span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">sortedBy</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="s1">&#39;desc&#39;</span><span class="p">);</span>
      <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
    <span class="p">});</span>
    <span class="nx">Set</span><span class="p">.</span><span class="nx">accessor</span><span class="p">(</span><span class="s1">&#39;isEmpty&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">();</span>
    <span class="p">});</span>
    <span class="nx">Set</span><span class="p">.</span><span class="nx">accessor</span><span class="p">(</span><span class="s1">&#39;toArray&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">toArray</span><span class="p">();</span>
    <span class="p">});</span>
    <span class="nx">Set</span><span class="p">.</span><span class="nx">accessor</span><span class="p">(</span><span class="s1">&#39;length&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">registerAsMutableSource</span><span class="p">();</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="nx">Set</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">SetObserver</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">SetObserver</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nb">Object</span><span class="p">);</span>
    <span class="kd">function</span> <span class="nx">SetObserver</span><span class="p">(</span><span class="nx">base</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">base</span> <span class="o">=</span> <span class="nx">base</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_itemObservers</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">SimpleHash</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_setObservers</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">SimpleHash</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_setObservers</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;itemsWereAdded&quot;</span><span class="p">,</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">fire</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;itemsWereAdded&#39;</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)));</span>
      <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_setObservers</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;itemsWereRemoved&quot;</span><span class="p">,</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">fire</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;itemsWereRemoved&#39;</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)));</span>
      <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;itemsWereAdded&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">startObservingItems</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;itemsWereRemoved&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">stopObservingItems</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="nx">SetObserver</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">observedItemKeys</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="nx">SetObserver</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">observerForItemAndKey</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{};</span>
    <span class="nx">SetObserver</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_getOrSetObserverForItemAndKey</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_itemObservers</span><span class="p">.</span><span class="nx">getOrSet</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">observersByKey</span><span class="p">;</span>
        <span class="nx">observersByKey</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">SimpleHash</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">observersByKey</span><span class="p">.</span><span class="nx">getOrSet</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">observerForItemAndKey</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">key</span><span class="p">);</span>
        <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
      <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
    <span class="p">};</span>
    <span class="nx">SetObserver</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">startObserving</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_manageItemObservers</span><span class="p">(</span><span class="s2">&quot;observe&quot;</span><span class="p">);</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_manageSetObservers</span><span class="p">(</span><span class="s2">&quot;addHandler&quot;</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">SetObserver</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">stopObserving</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_manageItemObservers</span><span class="p">(</span><span class="s2">&quot;forget&quot;</span><span class="p">);</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_manageSetObservers</span><span class="p">(</span><span class="s2">&quot;removeHandler&quot;</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">SetObserver</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">startObservingItems</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">item</span><span class="p">,</span> <span class="nx">items</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">,</span> <span class="nx">_results</span><span class="p">;</span>
      <span class="nx">items</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="p">[];</span>
      <span class="nx">_results</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">items</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">item</span> <span class="o">=</span> <span class="nx">items</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
        <span class="nx">_results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_manageObserversForItem</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="s2">&quot;observe&quot;</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">_results</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">SetObserver</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">stopObservingItems</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">item</span><span class="p">,</span> <span class="nx">items</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">,</span> <span class="nx">_results</span><span class="p">;</span>
      <span class="nx">items</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="p">[];</span>
      <span class="nx">_results</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">items</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">item</span> <span class="o">=</span> <span class="nx">items</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
        <span class="nx">_results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_manageObserversForItem</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="s2">&quot;forget&quot;</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">_results</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">SetObserver</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_manageObserversForItem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">method</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">item</span><span class="p">.</span><span class="nx">isObservable</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">observedItemKeys</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">key</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
        <span class="nx">item</span><span class="p">[</span><span class="nx">method</span><span class="p">](</span><span class="nx">key</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getOrSetObserverForItemAndKey</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">key</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">method</span> <span class="o">===</span> <span class="s2">&quot;forget&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_itemObservers</span><span class="p">.</span><span class="nx">unset</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">SetObserver</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_manageItemObservers</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">method</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">base</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_manageObserversForItem</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">method</span><span class="p">);</span>
      <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
    <span class="p">};</span>
    <span class="nx">SetObserver</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_manageSetObservers</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">method</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">base</span><span class="p">.</span><span class="nx">isObservable</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_setObservers</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">observer</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">base</span><span class="p">.</span><span class="nx">event</span><span class="p">(</span><span class="nx">key</span><span class="p">)[</span><span class="nx">method</span><span class="p">](</span><span class="nx">observer</span><span class="p">);</span>
      <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">SetObserver</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">SetProxy</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">_fn</span><span class="p">,</span> <span class="nx">_fn2</span><span class="p">,</span> <span class="nx">_fn3</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_j</span><span class="p">,</span> <span class="nx">_k</span><span class="p">,</span> <span class="nx">_len</span><span class="p">,</span> <span class="nx">_len2</span><span class="p">,</span> <span class="nx">_len3</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">,</span> <span class="nx">_ref2</span><span class="p">,</span> <span class="nx">_ref3</span><span class="p">;</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">SetProxy</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nb">Object</span><span class="p">);</span>
    <span class="kd">function</span> <span class="nx">SetProxy</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">SetProxy</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">$extendsEnumerable</span><span class="p">(</span><span class="nx">SetProxy</span><span class="p">.</span><span class="nx">prototype</span><span class="p">);</span>
    <span class="nx">SetProxy</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">filter</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">r</span><span class="p">;</span>
      <span class="nx">r</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Set</span><span class="p">();</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">reduce</span><span class="p">((</span><span class="kd">function</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">f</span><span class="p">(</span><span class="nx">e</span><span class="p">))</span> <span class="p">{</span>
          <span class="nx">r</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
      <span class="p">}),</span> <span class="nx">r</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">_ref</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="s1">&#39;remove&#39;</span><span class="p">,</span> <span class="s1">&#39;clear&#39;</span><span class="p">];</span>
    <span class="nx">_fn</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">prototype</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">results</span><span class="p">,</span> <span class="nx">_ref2</span><span class="p">;</span>
        <span class="nx">results</span> <span class="o">=</span> <span class="p">(</span><span class="nx">_ref2</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">base</span><span class="p">)[</span><span class="nx">k</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span><span class="nx">_ref2</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;length&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">base</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;length&#39;</span><span class="p">));</span>
        <span class="k">return</span> <span class="nx">results</span><span class="p">;</span>
      <span class="p">};</span>
    <span class="p">},</span> <span class="nx">SetProxy</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">k</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
      <span class="nx">_fn</span><span class="p">(</span><span class="nx">k</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">_ref2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;has&#39;</span><span class="p">,</span> <span class="s1">&#39;merge&#39;</span><span class="p">,</span> <span class="s1">&#39;toArray&#39;</span><span class="p">,</span> <span class="s1">&#39;isEmpty&#39;</span><span class="p">];</span>
    <span class="nx">_fn2</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">prototype</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">_ref3</span><span class="p">;</span>
        <span class="k">return</span> <span class="p">(</span><span class="nx">_ref3</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">base</span><span class="p">)[</span><span class="nx">k</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span><span class="nx">_ref3</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
      <span class="p">};</span>
    <span class="p">},</span> <span class="nx">SetProxy</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">_j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len2</span> <span class="o">=</span> <span class="nx">_ref2</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_j</span> <span class="o">&lt;</span> <span class="nx">_len2</span><span class="p">;</span> <span class="nx">_j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">k</span> <span class="o">=</span> <span class="nx">_ref2</span><span class="p">[</span><span class="nx">_j</span><span class="p">];</span>
      <span class="nx">_fn2</span><span class="p">(</span><span class="nx">k</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">_ref3</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;isEmpty&#39;</span><span class="p">,</span> <span class="s1">&#39;toArray&#39;</span><span class="p">];</span>
    <span class="nx">_fn3</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">accessor</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">base</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">k</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">},</span> <span class="nx">SetProxy</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">_k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len3</span> <span class="o">=</span> <span class="nx">_ref3</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_k</span> <span class="o">&lt;</span> <span class="nx">_len3</span><span class="p">;</span> <span class="nx">_k</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">k</span> <span class="o">=</span> <span class="nx">_ref3</span><span class="p">[</span><span class="nx">_k</span><span class="p">];</span>
      <span class="nx">_fn3</span><span class="p">(</span><span class="nx">k</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">SetProxy</span><span class="p">.</span><span class="nx">accessor</span><span class="p">(</span><span class="s1">&#39;length&#39;</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">registerAsMutableSource</span><span class="p">();</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">set</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="nx">v</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="nx">SetProxy</span><span class="p">;</span>
  <span class="p">}).</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">SetSort</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">SetSort</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">SetProxy</span><span class="p">);</span>
    <span class="kd">function</span> <span class="nx">SetSort</span><span class="p">(</span><span class="nx">base</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">order</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">boundReIndex</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">base</span> <span class="o">=</span> <span class="nx">base</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">key</span> <span class="o">=</span> <span class="nx">key</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">order</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">order</span> <span class="o">=</span> <span class="s2">&quot;asc&quot;</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">SetSort</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">descending</span> <span class="o">=</span> <span class="nx">order</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">===</span> <span class="s2">&quot;desc&quot;</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">base</span><span class="p">.</span><span class="nx">isObservable</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_setObserver</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">SetObserver</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">base</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_setObserver</span><span class="p">.</span><span class="nx">observedItemKeys</span> <span class="o">=</span> <span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">key</span><span class="p">];</span>
        <span class="nx">boundReIndex</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_reIndex</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_setObserver</span><span class="p">.</span><span class="nx">observerForItemAndKey</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">boundReIndex</span><span class="p">;</span>
        <span class="p">};</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_setObserver</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;itemsWereAdded&#39;</span><span class="p">,</span> <span class="nx">boundReIndex</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_setObserver</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;itemsWereRemoved&#39;</span><span class="p">,</span> <span class="nx">boundReIndex</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">startObserving</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_reIndex</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="nx">SetSort</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">startObserving</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">_ref</span><span class="p">;</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_setObserver</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">startObserving</span><span class="p">()</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">SetSort</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">stopObserving</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">_ref</span><span class="p">;</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_setObserver</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">stopObserving</span><span class="p">()</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">SetSort</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toArray</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;_storage&#39;</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">SetSort</span><span class="p">.</span><span class="nx">accessor</span><span class="p">(</span><span class="s1">&#39;toArray&#39;</span><span class="p">,</span> <span class="nx">SetSort</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toArray</span><span class="p">);</span>
    <span class="nx">SetSort</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">forEach</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">iterator</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">e</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">,</span> <span class="nx">_results</span><span class="p">;</span>
      <span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;_storage&#39;</span><span class="p">);</span>
      <span class="nx">_results</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">e</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
        <span class="nx">_results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">iterator</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">i</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">_results</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">SetSort</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">compare</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">typeComparison</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">===</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">===</span> <span class="k">void</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">b</span> <span class="o">===</span> <span class="k">void</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">b</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">((</span><span class="k">typeof</span> <span class="nx">a</span><span class="p">.</span><span class="nx">isEqual</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span> <span class="o">?</span> <span class="nx">a</span><span class="p">.</span><span class="nx">isEqual</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">b</span><span class="p">.</span><span class="nx">isEqual</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span> <span class="o">?</span> <span class="nx">b</span><span class="p">.</span><span class="nx">isEqual</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">typeComparison</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">SetSort</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">compare</span><span class="p">(</span><span class="nx">$typeOf</span><span class="p">(</span><span class="nx">a</span><span class="p">),</span> <span class="nx">$typeOf</span><span class="p">(</span><span class="nx">b</span><span class="p">));</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">typeComparison</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">typeComparison</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">!==</span> <span class="nx">a</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">b</span> <span class="o">!==</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">&gt;</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">&lt;</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">SetSort</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_reIndex</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">newOrder</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">;</span>
      <span class="nx">newOrder</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">base</span><span class="p">.</span><span class="nx">toArray</span><span class="p">().</span><span class="nx">sort</span><span class="p">(</span><span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">multiple</span><span class="p">,</span> <span class="nx">valueA</span><span class="p">,</span> <span class="nx">valueB</span><span class="p">;</span>
        <span class="nx">valueA</span> <span class="o">=</span> <span class="nx">$get</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">key</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">valueA</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">valueA</span> <span class="o">=</span> <span class="nx">valueA</span><span class="p">.</span><span class="nx">valueOf</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="nx">valueB</span> <span class="o">=</span> <span class="nx">$get</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">key</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">valueB</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">valueB</span> <span class="o">=</span> <span class="nx">valueB</span><span class="p">.</span><span class="nx">valueOf</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="nx">multiple</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">descending</span> <span class="o">?</span> <span class="o">-</span><span class="mi">1</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">compare</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">valueA</span><span class="p">,</span> <span class="nx">valueB</span><span class="p">)</span> <span class="o">*</span> <span class="nx">multiple</span><span class="p">;</span>
      <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
      <span class="k">if</span> <span class="p">((</span><span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_setObserver</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">_ref</span><span class="p">.</span><span class="nx">startObservingItems</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">_ref</span><span class="p">,</span> <span class="nx">newOrder</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;_storage&#39;</span><span class="p">,</span> <span class="nx">newOrder</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">SetSort</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">SetIndex</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">SetIndex</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nb">Object</span><span class="p">);</span>
    <span class="kd">function</span> <span class="nx">SetIndex</span><span class="p">(</span><span class="nx">base</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">base</span> <span class="o">=</span> <span class="nx">base</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">key</span> <span class="o">=</span> <span class="nx">key</span><span class="p">;</span>
      <span class="nx">SetIndex</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_storage</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">SimpleHash</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">base</span><span class="p">.</span><span class="nx">isEventEmitter</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_setObserver</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">SetObserver</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">base</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_setObserver</span><span class="p">.</span><span class="nx">observedItemKeys</span> <span class="o">=</span> <span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">key</span><span class="p">];</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_setObserver</span><span class="p">.</span><span class="nx">observerForItemAndKey</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">observerForItemAndKey</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_setObserver</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;itemsWereAdded&#39;</span><span class="p">,</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">item</span><span class="p">,</span> <span class="nx">items</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">,</span> <span class="nx">_results</span><span class="p">;</span>
          <span class="nx">items</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="p">[];</span>
          <span class="nx">_results</span> <span class="o">=</span> <span class="p">[];</span>
          <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">items</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">item</span> <span class="o">=</span> <span class="nx">items</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
            <span class="nx">_results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_addItem</span><span class="p">(</span><span class="nx">item</span><span class="p">));</span>
          <span class="p">}</span>
          <span class="k">return</span> <span class="nx">_results</span><span class="p">;</span>
        <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_setObserver</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;itemsWereRemoved&#39;</span><span class="p">,</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">item</span><span class="p">,</span> <span class="nx">items</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">,</span> <span class="nx">_results</span><span class="p">;</span>
          <span class="nx">items</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="p">[];</span>
          <span class="nx">_results</span> <span class="o">=</span> <span class="p">[];</span>
          <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">items</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">item</span> <span class="o">=</span> <span class="nx">items</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
            <span class="nx">_results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_removeItem</span><span class="p">(</span><span class="nx">item</span><span class="p">));</span>
          <span class="p">}</span>
          <span class="k">return</span> <span class="nx">_results</span><span class="p">;</span>
        <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">base</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_addItem</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">startObserving</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="nx">SetIndex</span><span class="p">.</span><span class="nx">accessor</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_resultSetForKey</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="nx">SetIndex</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">startObserving</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">_ref</span><span class="p">;</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_setObserver</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">startObserving</span><span class="p">()</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">SetIndex</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">stopObserving</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">_ref</span><span class="p">;</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_setObserver</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">stopObserving</span><span class="p">()</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">SetIndex</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">observerForItemAndKey</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">newValue</span><span class="p">,</span> <span class="nx">oldValue</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_removeItemFromKey</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">oldValue</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_addItemToKey</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">newValue</span><span class="p">);</span>
      <span class="p">},</span> <span class="k">this</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">SetIndex</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_addItem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_addItemToKey</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_keyForItem</span><span class="p">(</span><span class="nx">item</span><span class="p">));</span>
    <span class="p">};</span>
    <span class="nx">SetIndex</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_addItemToKey</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_resultSetForKey</span><span class="p">(</span><span class="nx">key</span><span class="p">).</span><span class="nx">add</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">SetIndex</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_removeItem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_removeItemFromKey</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_keyForItem</span><span class="p">(</span><span class="nx">item</span><span class="p">));</span>
    <span class="p">};</span>
    <span class="nx">SetIndex</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_removeItemFromKey</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">results</span><span class="p">;</span>
      <span class="nx">results</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_resultSetForKey</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
      <span class="nx">results</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">results</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_storage</span><span class="p">.</span><span class="nx">unset</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">SetIndex</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_resultSetForKey</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_storage</span><span class="p">.</span><span class="nx">getOrSet</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Set</span><span class="p">;</span>
      <span class="p">});</span>
    <span class="p">};</span>
    <span class="nx">SetIndex</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_keyForItem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Keypath</span><span class="p">.</span><span class="nx">forBaseAndKey</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">key</span><span class="p">).</span><span class="nx">getValue</span><span class="p">();</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">SetIndex</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">UniqueSetIndex</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">UniqueSetIndex</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">SetIndex</span><span class="p">);</span>
    <span class="kd">function</span> <span class="nx">UniqueSetIndex</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_uniqueIndex</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Hash</span><span class="p">;</span>
      <span class="nx">UniqueSetIndex</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">UniqueSetIndex</span><span class="p">.</span><span class="nx">accessor</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_uniqueIndex</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="nx">UniqueSetIndex</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_addItemToKey</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_resultSetForKey</span><span class="p">(</span><span class="nx">key</span><span class="p">).</span><span class="nx">add</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_uniqueIndex</span><span class="p">.</span><span class="nx">hasKey</span><span class="p">(</span><span class="nx">key</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_uniqueIndex</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">item</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">UniqueSetIndex</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_removeItemFromKey</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">resultSet</span><span class="p">;</span>
      <span class="nx">resultSet</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_resultSetForKey</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
      <span class="nx">UniqueSetIndex</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">_removeItemFromKey</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">resultSet</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_uniqueIndex</span><span class="p">.</span><span class="nx">unset</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_uniqueIndex</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">resultSet</span><span class="p">.</span><span class="nx">toArray</span><span class="p">()[</span><span class="mi">0</span><span class="p">]);</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">UniqueSetIndex</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">StateMachine</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">Batman</span><span class="p">.</span><span class="nx">initializeObject</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_batman</span><span class="p">.</span><span class="nx">states</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_batman</span><span class="p">.</span><span class="nx">states</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">SimpleHash</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">state</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">Batman</span><span class="p">.</span><span class="nx">StateMachine</span><span class="p">.</span><span class="nx">initialize</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_batman</span><span class="p">.</span><span class="nx">getFirst</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">developer</span><span class="p">.</span><span class="nx">assert</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isEventEmitter</span><span class="p">,</span> <span class="s2">&quot;StateMachine requires EventEmitter&quot;</span><span class="p">);</span>
      <span class="k">this</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">||</span> <span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">_stateMachine_setState</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">name</span><span class="p">);</span>
      <span class="p">});</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">callback</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">transition</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">from</span><span class="p">,</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">Batman</span><span class="p">.</span><span class="nx">StateMachine</span><span class="p">.</span><span class="nx">initialize</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">(</span><span class="nx">from</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">(</span><span class="nx">to</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="nx">from</span> <span class="o">+</span> <span class="s2">&quot;-&gt;&quot;</span> <span class="o">+</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nb">Object</span><span class="p">.</span><span class="nx">actsAsStateMachine</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">includeInstanceMethods</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">includeInstanceMethods</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">includeInstanceMethods</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">Batman</span><span class="p">.</span><span class="nx">StateMachine</span><span class="p">.</span><span class="nx">initialize</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="nx">Batman</span><span class="p">.</span><span class="nx">StateMachine</span><span class="p">.</span><span class="nx">initialize</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">prototype</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">classState</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">StateMachine</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">classState</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">includeInstanceMethods</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">classState</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">classTransition</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">StateMachine</span><span class="p">.</span><span class="nx">transition</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">transition</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">classTransition</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">includeInstanceMethods</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">transition</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">classTransition</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="nx">_stateMachine_setState</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">newState</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">oldState</span><span class="p">,</span> <span class="nx">_base</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">;</span>
    <span class="nx">Batman</span><span class="p">.</span><span class="nx">StateMachine</span><span class="p">.</span><span class="nx">initialize</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_batman</span><span class="p">.</span><span class="nx">isTransitioning</span><span class="p">)</span> <span class="p">{</span>
      <span class="p">((</span><span class="nx">_base</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_batman</span><span class="p">).</span><span class="nx">nextState</span> <span class="o">||</span> <span class="p">(</span><span class="nx">_base</span><span class="p">.</span><span class="nx">nextState</span> <span class="o">=</span> <span class="p">[])).</span><span class="nx">push</span><span class="p">(</span><span class="nx">newState</span><span class="p">);</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_batman</span><span class="p">.</span><span class="nx">isTransitioning</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nx">oldState</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_batman</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="nx">newState</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">newState</span> <span class="o">&amp;&amp;</span> <span class="nx">oldState</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="nx">oldState</span> <span class="o">+</span> <span class="s2">&quot;-&gt;&quot;</span> <span class="o">+</span> <span class="nx">newState</span><span class="p">,</span> <span class="nx">newState</span><span class="p">,</span> <span class="nx">oldState</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">newState</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="nx">newState</span><span class="p">,</span> <span class="nx">newState</span><span class="p">,</span> <span class="nx">oldState</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_batman</span><span class="p">.</span><span class="nx">isTransitioning</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">((</span><span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_batman</span><span class="p">.</span><span class="nx">nextState</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">length</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">_batman</span><span class="p">.</span><span class="nx">nextState</span><span class="p">.</span><span class="nx">shift</span><span class="p">()]();</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">newState</span><span class="p">;</span>
  <span class="p">};</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">Request</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">Request</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nb">Object</span><span class="p">);</span>
    <span class="nx">Request</span><span class="p">.</span><span class="nx">objectToFormData</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">formData</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">pairForList</span><span class="p">,</span> <span class="nx">val</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">,</span> <span class="nx">_ref2</span><span class="p">;</span>
      <span class="nx">pairForList</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">object</span><span class="p">,</span> <span class="nx">first</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">list</span><span class="p">,</span> <span class="nx">v</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">first</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">first</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">list</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="k">switch</span> <span class="p">(</span><span class="nx">Batman</span><span class="p">.</span><span class="nx">typeOf</span><span class="p">(</span><span class="nx">object</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">case</span> <span class="s1">&#39;Object&#39;</span><span class="o">:</span>
              <span class="nx">list</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">_results</span><span class="p">;</span>
                <span class="nx">_results</span> <span class="o">=</span> <span class="p">[];</span>
                <span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="k">in</span> <span class="nx">object</span><span class="p">)</span> <span class="p">{</span>
                  <span class="nx">v</span> <span class="o">=</span> <span class="nx">object</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>
                  <span class="nx">_results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">pairForList</span><span class="p">((</span><span class="nx">first</span> <span class="o">?</span> <span class="nx">k</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="nx">key</span> <span class="o">+</span> <span class="s2">&quot;[&quot;</span> <span class="o">+</span> <span class="nx">k</span> <span class="o">+</span> <span class="s2">&quot;]&quot;</span><span class="p">),</span> <span class="nx">v</span><span class="p">));</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="nx">_results</span><span class="p">;</span>
              <span class="p">})();</span>
              <span class="k">return</span> <span class="nx">list</span><span class="p">.</span><span class="nx">reduce</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">acc</span><span class="p">,</span> <span class="nx">list</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">acc</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">list</span><span class="p">);</span>
              <span class="p">},</span> <span class="p">[]);</span>
            <span class="k">case</span> <span class="s1">&#39;Array&#39;</span><span class="o">:</span>
              <span class="k">return</span> <span class="nx">object</span><span class="p">.</span><span class="nx">reduce</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">acc</span><span class="p">,</span> <span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">acc</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">pairForList</span><span class="p">(</span><span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="nx">key</span> <span class="o">+</span> <span class="s2">&quot;[]&quot;</span><span class="p">,</span> <span class="nx">element</span><span class="p">));</span>
              <span class="p">},</span> <span class="p">[]);</span>
            <span class="k">default</span><span class="o">:</span>
              <span class="k">return</span> <span class="p">[[</span><span class="nx">key</span><span class="p">,</span> <span class="nx">object</span><span class="p">]];</span>
          <span class="p">}</span>
        <span class="p">})();</span>
      <span class="p">};</span>
      <span class="nx">formData</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">();</span>
      <span class="nx">_ref</span> <span class="o">=</span> <span class="nx">pairForList</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">_ref2</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="nx">_i</span><span class="p">],</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">_ref2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">val</span> <span class="o">=</span> <span class="nx">_ref2</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
        <span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">val</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">formData</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">Request</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">url</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="nx">Request</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="nx">Request</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">method</span> <span class="o">=</span> <span class="s1">&#39;get&#39;</span><span class="p">;</span>
    <span class="nx">Request</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">formData</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">Request</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">response</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="nx">Request</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">status</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="nx">Request</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">contentType</span> <span class="o">=</span> <span class="s1">&#39;application/x-www-form-urlencoded&#39;</span><span class="p">;</span>
    <span class="kd">function</span> <span class="nx">Request</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">handler</span><span class="p">,</span> <span class="nx">handlers</span><span class="p">,</span> <span class="nx">k</span><span class="p">;</span>
      <span class="nx">handlers</span> <span class="o">=</span> <span class="p">{};</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="k">in</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">handler</span> <span class="o">=</span> <span class="nx">options</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">k</span> <span class="o">===</span> <span class="s1">&#39;success&#39;</span> <span class="o">||</span> <span class="nx">k</span> <span class="o">===</span> <span class="s1">&#39;error&#39;</span> <span class="o">||</span> <span class="nx">k</span> <span class="o">===</span> <span class="s1">&#39;loading&#39;</span> <span class="o">||</span> <span class="nx">k</span> <span class="o">===</span> <span class="s1">&#39;loaded&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">handlers</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">handler</span><span class="p">;</span>
          <span class="k">delete</span> <span class="nx">options</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="nx">Request</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="k">in</span> <span class="nx">handlers</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">handler</span> <span class="o">=</span> <span class="nx">handlers</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="nx">handler</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">Request</span><span class="p">.</span><span class="nx">observeAll</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_autosendTimeout</span> <span class="o">=</span> <span class="nx">$setImmediate</span><span class="p">(</span><span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>
      <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
    <span class="p">});</span>
    <span class="nx">Request</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">send</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">developer</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;Please source a dependency file for a request implementation&quot;</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">Request</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">cancel</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_autosendTimeout</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">clearTimeout</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_autosendTimeout</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">Request</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">App</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">App</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nb">Object</span><span class="p">);</span>
    <span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">App</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">App</span><span class="p">.</span><span class="nx">requirePath</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="nx">developer</span><span class="p">[</span><span class="s2">&quot;do&quot;</span><span class="p">](</span><span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">App</span><span class="p">.</span><span class="nx">require</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">base</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">names</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">;</span>
        <span class="nx">path</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">names</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">&lt;=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">:</span> <span class="p">[];</span>
        <span class="nx">base</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">requirePath</span> <span class="o">+</span> <span class="nx">path</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">names</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">name</span> <span class="o">=</span> <span class="nx">names</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">prevent</span><span class="p">(</span><span class="s1">&#39;run&#39;</span><span class="p">);</span>
          <span class="nx">path</span> <span class="o">=</span> <span class="nx">base</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nx">name</span> <span class="o">+</span> <span class="s1">&#39;.coffee&#39;</span><span class="p">;</span>
          <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Request</span><span class="p">({</span>
            <span class="nx">url</span><span class="o">:</span> <span class="nx">path</span><span class="p">,</span>
            <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;html&#39;</span><span class="p">,</span>
            <span class="nx">success</span><span class="o">:</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">CoffeeScript</span><span class="p">.</span><span class="nb">eval</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
              <span class="k">this</span><span class="p">.</span><span class="nx">allow</span><span class="p">(</span><span class="s1">&#39;run&#39;</span><span class="p">);</span>
              <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">isPrevented</span><span class="p">(</span><span class="s1">&#39;run&#39;</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="s1">&#39;loaded&#39;</span><span class="p">);</span>
              <span class="p">}</span>
              <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">wantsToRun</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">run</span><span class="p">();</span>
              <span class="p">}</span>
            <span class="p">},</span> <span class="k">this</span><span class="p">)</span>
          <span class="p">});</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
      <span class="p">};</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">controller</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">names</span><span class="p">;</span>
        <span class="nx">names</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="p">[];</span>
        <span class="nx">names</span> <span class="o">=</span> <span class="nx">names</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">n</span> <span class="o">+</span> <span class="s1">&#39;_controller&#39;</span><span class="p">;</span>
        <span class="p">});</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">require</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;controllers&#39;</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">names</span><span class="p">)));</span>
      <span class="p">};</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">model</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">require</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;models&#39;</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)));</span>
      <span class="p">};</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">view</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">require</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;views&#39;</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)));</span>
      <span class="p">};</span>
    <span class="p">},</span> <span class="nx">App</span><span class="p">));</span>
    <span class="nx">App</span><span class="p">.</span><span class="nx">layout</span> <span class="o">=</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">App</span><span class="p">.</span><span class="nx">event</span><span class="p">(</span><span class="s1">&#39;ready&#39;</span><span class="p">).</span><span class="nx">oneShot</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nx">App</span><span class="p">.</span><span class="nx">event</span><span class="p">(</span><span class="s1">&#39;run&#39;</span><span class="p">).</span><span class="nx">oneShot</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nx">App</span><span class="p">.</span><span class="nx">run</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">Batman</span><span class="p">.</span><span class="nx">currentApp</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">Batman</span><span class="p">.</span><span class="nx">currentApp</span> <span class="o">===</span> <span class="k">this</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">Batman</span><span class="p">.</span><span class="nx">currentApp</span><span class="p">.</span><span class="nx">stop</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">hasRun</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isPrevented</span><span class="p">(</span><span class="s1">&#39;run&#39;</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">wantsToRun</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">wantsToRun</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">Batman</span><span class="p">.</span><span class="nx">currentApp</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="k">this</span><span class="p">.</span><span class="nx">dispatcher</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">dispatcher</span> <span class="o">||</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">dispatcher</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Dispatcher</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">observe</span><span class="p">(</span><span class="s1">&#39;layout&#39;</span><span class="p">,</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">layout</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">layout</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">layout</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;ready&#39;</span><span class="p">,</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="s1">&#39;ready&#39;</span><span class="p">);</span>
        <span class="p">},</span> <span class="k">this</span><span class="p">))</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="k">this</span><span class="p">.</span><span class="nx">layout</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;layout&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">View</span><span class="p">({</span>
          <span class="nx">contexts</span><span class="o">:</span> <span class="p">[</span><span class="k">this</span><span class="p">],</span>
          <span class="nx">node</span><span class="o">:</span> <span class="nb">document</span>
        <span class="p">}));</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="k">this</span><span class="p">.</span><span class="nx">layout</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;layout&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="k">this</span><span class="p">[</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">camelize</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">layout</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;View&#39;</span><span class="p">]);</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="k">this</span><span class="p">.</span><span class="nx">navigator</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">dispatcher</span><span class="p">.</span><span class="nx">routeMap</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;run&#39;</span><span class="p">,</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">navigator</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">navigator</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Navigator</span><span class="p">.</span><span class="nx">forApp</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
          <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
        <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">hasRun</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="s1">&#39;run&#39;</span><span class="p">);</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">App</span><span class="p">.</span><span class="nx">event</span><span class="p">(</span><span class="s1">&#39;ready&#39;</span><span class="p">).</span><span class="nx">oneShot</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nx">App</span><span class="p">.</span><span class="nx">event</span><span class="p">(</span><span class="s1">&#39;stop&#39;</span><span class="p">).</span><span class="nx">oneShot</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nx">App</span><span class="p">.</span><span class="nx">stop</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">_ref</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">((</span><span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">navigator</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">_ref</span><span class="p">.</span><span class="nx">stop</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="nx">Batman</span><span class="p">.</span><span class="nx">navigator</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">hasRun</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="s1">&#39;stop&#39;</span><span class="p">);</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">App</span><span class="p">;</span>
  <span class="p">}).</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">Route</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">escapeRegExp</span><span class="p">,</span> <span class="nx">namedOrSplat</span><span class="p">,</span> <span class="nx">namedParam</span><span class="p">,</span> <span class="nx">queryParam</span><span class="p">,</span> <span class="nx">splatParam</span><span class="p">;</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">Route</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nb">Object</span><span class="p">);</span>
    <span class="nx">namedParam</span> <span class="o">=</span> <span class="sr">/:([\w\d]+)/g</span><span class="p">;</span>
    <span class="nx">splatParam</span> <span class="o">=</span> <span class="sr">/\*([\w\d]+)/g</span><span class="p">;</span>
    <span class="nx">queryParam</span> <span class="o">=</span> <span class="s1">&#39;(?:\\?.+)?&#39;</span><span class="p">;</span>
    <span class="nx">namedOrSplat</span> <span class="o">=</span> <span class="sr">/[:|\*]([\w\d]+)/g</span><span class="p">;</span>
    <span class="nx">escapeRegExp</span> <span class="o">=</span> <span class="sr">/[-[\]{}()+?.,\\^$|#\s]/g</span><span class="p">;</span>
    <span class="kd">function</span> <span class="nx">Route</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">array</span><span class="p">;</span>
      <span class="nx">Route</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">pattern</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">url</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">escapeRegExp</span><span class="p">,</span> <span class="s1">&#39;\\$&amp;&#39;</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">regexp</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">&#39;^&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">pattern</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">namedParam</span><span class="p">,</span> <span class="s1">&#39;([^\/]*)&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="nx">splatParam</span><span class="p">,</span> <span class="s1">&#39;(.*?)&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="nx">queryParam</span> <span class="o">+</span> <span class="s1">&#39;$&#39;</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">namedArguments</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">while</span> <span class="p">((</span><span class="nx">array</span> <span class="o">=</span> <span class="nx">namedOrSplat</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">pattern</span><span class="p">))</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">array</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">namedArguments</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">array</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">Route</span><span class="p">.</span><span class="nx">accessor</span><span class="p">(</span><span class="s1">&#39;action&#39;</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">components</span><span class="p">,</span> <span class="nx">result</span><span class="p">,</span> <span class="nx">signature</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">action</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">action</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">result</span> <span class="o">=</span> <span class="nx">$mixin</span><span class="p">({},</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">);</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">signature</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">signature</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">components</span> <span class="o">=</span> <span class="nx">signature</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">);</span>
            <span class="nx">result</span><span class="p">.</span><span class="nx">controller</span> <span class="o">=</span> <span class="nx">components</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
            <span class="nx">result</span><span class="p">.</span><span class="nx">action</span> <span class="o">=</span> <span class="nx">components</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">||</span> <span class="s1">&#39;index&#39;</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="nx">result</span><span class="p">.</span><span class="nx">target</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">dispatcher</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">controller</span><span class="p">);</span>
          <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;action&#39;</span><span class="p">,</span> <span class="nx">result</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="nx">set</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">action</span> <span class="o">=</span> <span class="nx">action</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">});</span>
    <span class="nx">Route</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">parameterize</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">action</span><span class="p">,</span> <span class="nx">array</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">param</span><span class="p">,</span> <span class="nx">params</span><span class="p">,</span> <span class="nx">query</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">,</span> <span class="nx">_len2</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">,</span> <span class="nx">_ref2</span><span class="p">,</span> <span class="nx">_ref3</span><span class="p">,</span> <span class="nx">_ref4</span><span class="p">;</span>
      <span class="nx">_ref</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">),</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">query</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
      <span class="nx">array</span> <span class="o">=</span> <span class="p">(</span><span class="nx">_ref2</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">regexp</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">url</span><span class="p">))</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">_ref2</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span>
      <span class="nx">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">url</span><span class="o">:</span> <span class="nx">url</span>
      <span class="p">};</span>
      <span class="nx">action</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;action&#39;</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">action</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">params</span><span class="p">.</span><span class="nx">action</span> <span class="o">=</span> <span class="nx">action</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">$mixin</span><span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="nx">action</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">array</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">array</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">index</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">index</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">param</span> <span class="o">=</span> <span class="nx">array</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span>
          <span class="nx">params</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">namedArguments</span><span class="p">[</span><span class="nx">index</span><span class="p">]]</span> <span class="o">=</span> <span class="nx">param</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">query</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">_ref3</span> <span class="o">=</span> <span class="nx">query</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len2</span> <span class="o">=</span> <span class="nx">_ref3</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len2</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">s</span> <span class="o">=</span> <span class="nx">_ref3</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
          <span class="nx">_ref4</span> <span class="o">=</span> <span class="nx">s</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">),</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">_ref4</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">_ref4</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
          <span class="nx">params</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">params</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">Route</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">dispatch</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">action</span><span class="p">,</span> <span class="nx">params</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">,</span> <span class="nx">_ref2</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">$typeOf</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;String&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">params</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">parameterize</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">action</span> <span class="o">=</span> <span class="nx">params</span><span class="p">.</span><span class="nx">action</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">url</span> <span class="o">!==</span> <span class="s1">&#39;/404&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$redirect</span><span class="p">(</span><span class="s1">&#39;/404&#39;</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">action</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">action</span><span class="p">(</span><span class="nx">params</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">((</span><span class="nx">_ref</span> <span class="o">=</span> <span class="nx">params</span><span class="p">.</span><span class="nx">target</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">dispatch</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">params</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">action</span><span class="p">,</span> <span class="nx">params</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">_ref2</span> <span class="o">=</span> <span class="nx">params</span><span class="p">.</span><span class="nx">target</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">_ref2</span><span class="p">[</span><span class="nx">action</span><span class="p">](</span><span class="nx">params</span><span class="p">)</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">Route</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">Dispatcher</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">Dispatcher</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nb">Object</span><span class="p">);</span>
    <span class="kd">function</span> <span class="nx">Dispatcher</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">controller</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">app</span> <span class="o">=</span> <span class="nx">app</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">app</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">app</span><span class="p">.</span><span class="nx">controllers</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nb">Object</span><span class="p">;</span>
      <span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">app</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">key</span> <span class="k">in</span> <span class="nx">_ref</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">controller</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">((</span><span class="nx">controller</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">controller</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">)</span> <span class="k">instanceof</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Controller</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">prepareController</span><span class="p">(</span><span class="nx">controller</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">Dispatcher</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">prepareController</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">controller</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">getter</span><span class="p">,</span> <span class="nx">name</span><span class="p">;</span>
      <span class="nx">name</span> <span class="o">=</span> <span class="nx">helpers</span><span class="p">.</span><span class="nx">underscore</span><span class="p">(</span><span class="nx">$functionName</span><span class="p">(</span><span class="nx">controller</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;Controller&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">));</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">getter</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">controller</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;sharedController&#39;</span><span class="p">);</span>
      <span class="p">};</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">accessor</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">getter</span><span class="p">);</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">app</span><span class="p">.</span><span class="nx">controllers</span><span class="p">.</span><span class="nx">accessor</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">getter</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">Dispatcher</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">register</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">route</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">url</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">url</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nx">url</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">route</span> <span class="o">=</span> <span class="nx">$typeOf</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;Function&#39;</span> <span class="o">?</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Route</span><span class="p">({</span>
        <span class="nx">url</span><span class="o">:</span> <span class="nx">url</span><span class="p">,</span>
        <span class="nx">action</span><span class="o">:</span> <span class="nx">options</span><span class="p">,</span>
        <span class="nx">dispatcher</span><span class="o">:</span> <span class="k">this</span>
      <span class="p">})</span> <span class="o">:</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Route</span><span class="p">({</span>
        <span class="nx">url</span><span class="o">:</span> <span class="nx">url</span><span class="p">,</span>
        <span class="nx">options</span><span class="o">:</span> <span class="nx">options</span><span class="p">,</span>
        <span class="nx">dispatcher</span><span class="o">:</span> <span class="k">this</span>
      <span class="p">});</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">routeMap</span> <span class="o">||</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">routeMap</span> <span class="o">=</span> <span class="p">{});</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">routeMap</span><span class="p">[</span><span class="nx">url</span><span class="p">]</span> <span class="o">=</span> <span class="nx">route</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">Dispatcher</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">findRoute</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">route</span><span class="p">,</span> <span class="nx">routeUrl</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">url</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">url</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nx">url</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">((</span><span class="nx">route</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">routeMap</span><span class="p">[</span><span class="nx">url</span><span class="p">]))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">route</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">routeMap</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">routeUrl</span> <span class="k">in</span> <span class="nx">_ref</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">route</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="nx">routeUrl</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">route</span><span class="p">.</span><span class="nx">regexp</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">url</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">route</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">Dispatcher</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">findUrl</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">action</span><span class="p">,</span> <span class="nx">controller</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">matches</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">paramsCopy</span><span class="p">,</span> <span class="nx">queryString</span><span class="p">,</span> <span class="nx">regex</span><span class="p">,</span> <span class="nx">route</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">,</span> <span class="nx">_ref2</span><span class="p">;</span>
      <span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">routeMap</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">url</span> <span class="k">in</span> <span class="nx">_ref</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">route</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="nx">url</span><span class="p">];</span>
        <span class="nx">matches</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="nx">options</span> <span class="o">=</span> <span class="nx">route</span><span class="p">.</span><span class="nx">options</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">resource</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">matches</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">resource</span> <span class="o">===</span> <span class="nx">params</span><span class="p">.</span><span class="nx">resource</span> <span class="o">&amp;&amp;</span> <span class="nx">options</span><span class="p">.</span><span class="nx">action</span> <span class="o">===</span> <span class="nx">params</span><span class="p">.</span><span class="nx">action</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">action</span> <span class="o">=</span> <span class="nx">route</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;action&#39;</span><span class="p">);</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">action</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">matches</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">_ref2</span> <span class="o">=</span> <span class="nx">action</span><span class="p">,</span> <span class="nx">controller</span> <span class="o">=</span> <span class="nx">_ref2</span><span class="p">.</span><span class="nx">controller</span><span class="p">,</span> <span class="nx">action</span> <span class="o">=</span> <span class="nx">_ref2</span><span class="p">.</span><span class="nx">action</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">controller</span> <span class="o">===</span> <span class="nx">params</span><span class="p">.</span><span class="nx">controller</span> <span class="o">&amp;&amp;</span> <span class="nx">action</span> <span class="o">===</span> <span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">action</span> <span class="o">||</span> <span class="s1">&#39;index&#39;</span><span class="p">))</span> <span class="p">{</span>
              <span class="nx">matches</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">matches</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">$mixin</span><span class="p">(</span><span class="nx">paramsCopy</span> <span class="o">=</span> <span class="p">{},</span> <span class="nx">params</span><span class="p">);</span>
        <span class="nx">$unmixin</span><span class="p">(</span><span class="nx">paramsCopy</span><span class="p">,</span> <span class="p">{</span>
          <span class="nx">controller</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
          <span class="nx">action</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
          <span class="nx">resource</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
          <span class="nx">url</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
          <span class="nx">signature</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
          <span class="nx">target</span><span class="o">:</span> <span class="kc">null</span>
        <span class="p">});</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">key</span> <span class="k">in</span> <span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">value</span> <span class="o">=</span> <span class="nx">params</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
          <span class="nx">regex</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">&#39;[:|\*]&#39;</span> <span class="o">+</span> <span class="nx">key</span><span class="p">);</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">regex</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">url</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">continue</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="nx">url</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">regex</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
          <span class="nx">paramsCopy</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
          <span class="k">delete</span> <span class="nx">paramsCopy</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="nx">queryString</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">key</span> <span class="k">in</span> <span class="nx">paramsCopy</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">value</span> <span class="o">=</span> <span class="nx">paramsCopy</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
          <span class="nx">queryString</span> <span class="o">+=</span> <span class="o">!</span><span class="nx">queryString</span> <span class="o">?</span> <span class="s1">&#39;?&#39;</span> <span class="o">:</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">;</span>
          <span class="nx">queryString</span> <span class="o">+=</span> <span class="nx">key</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span> <span class="o">+</span> <span class="nx">value</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">url</span> <span class="o">+</span> <span class="nx">queryString</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">Dispatcher</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">pathFromParams</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">$typeOf</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;String&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Navigator</span><span class="p">.</span><span class="nx">normalizePath</span><span class="p">(</span><span class="nx">params</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">findUrl</span><span class="p">(</span><span class="nx">params</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">Dispatcher</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">dispatch</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">route</span><span class="p">,</span> <span class="nx">url</span><span class="p">;</span>
      <span class="nx">url</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">pathFromParams</span><span class="p">(</span><span class="nx">params</span><span class="p">);</span>
      <span class="nx">route</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">findRoute</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">route</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">route</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">url</span> <span class="o">!==</span> <span class="s1">&#39;/404&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$redirect</span><span class="p">(</span><span class="s1">&#39;/404&#39;</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">app</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;currentURL&#39;</span><span class="p">,</span> <span class="nx">url</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">app</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;currentRoute&#39;</span><span class="p">,</span> <span class="nx">route</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">app</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;currentParams&#39;</span><span class="p">,</span> <span class="nx">params</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">url</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">Dispatcher</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">Navigator</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">Navigator</span><span class="p">.</span><span class="nx">defaultClass</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">Batman</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">usePushState</span> <span class="o">&amp;&amp;</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">PushStateNavigator</span><span class="p">.</span><span class="nx">isSupported</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">PushStateNavigator</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">HashbangNavigator</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">Navigator</span><span class="p">.</span><span class="nx">forApp</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">defaultClass</span><span class="p">())(</span><span class="nx">app</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="kd">function</span> <span class="nx">Navigator</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">app</span> <span class="o">=</span> <span class="nx">app</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">handleCurrentLocation</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">handleCurrentLocation</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">Navigator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">start</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nb">window</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">started</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">started</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">startWatching</span><span class="p">();</span>
      <span class="nx">Batman</span><span class="p">.</span><span class="nx">currentApp</span><span class="p">.</span><span class="nx">prevent</span><span class="p">(</span><span class="s1">&#39;ready&#39;</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">$setImmediate</span><span class="p">(</span><span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">handleCurrentLocation</span><span class="p">();</span>
        <span class="k">return</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">currentApp</span><span class="p">.</span><span class="nx">allowAndFire</span><span class="p">(</span><span class="s1">&#39;ready&#39;</span><span class="p">);</span>
      <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
    <span class="p">};</span>
    <span class="nx">Navigator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">stop</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">stopWatching</span><span class="p">();</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">started</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">Navigator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">handleLocation</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">location</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">path</span><span class="p">;</span>
      <span class="nx">path</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">pathFromLocation</span><span class="p">(</span><span class="nx">location</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">path</span> <span class="o">===</span> <span class="k">this</span><span class="p">.</span><span class="nx">cachedPath</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">path</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">Navigator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">handleCurrentLocation</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">handleLocation</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">Navigator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">dispatch</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">cachedPath</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">app</span><span class="p">.</span><span class="nx">dispatcher</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">params</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">Navigator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">push</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">path</span><span class="p">;</span>
      <span class="nx">path</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">params</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">pushState</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">path</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">path</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">Navigator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">replace</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">path</span><span class="p">;</span>
      <span class="nx">path</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">params</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">replaceState</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">path</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">path</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">Navigator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">redirect</span> <span class="o">=</span> <span class="nx">Navigator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">push</span><span class="p">;</span>
    <span class="nx">Navigator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">normalizePath</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">seg</span><span class="p">,</span> <span class="nx">segments</span><span class="p">;</span>
      <span class="nx">segments</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="p">[];</span>
      <span class="nx">segments</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">_len</span><span class="p">,</span> <span class="nx">_results</span><span class="p">;</span>
        <span class="nx">_results</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">segments</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">seg</span> <span class="o">=</span> <span class="nx">segments</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
          <span class="nx">_results</span><span class="p">.</span><span class="nx">push</span><span class="p">((</span><span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="nx">seg</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^(?!\/)/</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\/+$/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">_results</span><span class="p">;</span>
      <span class="p">})();</span>
      <span class="k">return</span> <span class="nx">segments</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="s1">&#39;/&#39;</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">Navigator</span><span class="p">.</span><span class="nx">normalizePath</span> <span class="o">=</span> <span class="nx">Navigator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">normalizePath</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">Navigator</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">PushStateNavigator</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">PushStateNavigator</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Navigator</span><span class="p">);</span>
    <span class="kd">function</span> <span class="nx">PushStateNavigator</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">PushStateNavigator</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">PushStateNavigator</span><span class="p">.</span><span class="nx">isSupported</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">_ref</span><span class="p">;</span>
      <span class="k">return</span> <span class="p">(</span><span class="k">typeof</span> <span class="nb">window</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">window</span> <span class="o">!==</span> <span class="kc">null</span> <span class="o">?</span> <span class="p">(</span><span class="nx">_ref</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">history</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">pushState</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">PushStateNavigator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">startWatching</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">$addEventListener</span><span class="p">(</span><span class="nb">window</span><span class="p">,</span> <span class="s1">&#39;popstate&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">handleCurrentLocation</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">PushStateNavigator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">stopWatching</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">$removeEventListener</span><span class="p">(</span><span class="nb">window</span><span class="p">,</span> <span class="s1">&#39;popstate&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">handleCurrentLocation</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">PushStateNavigator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">pushState</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">stateObject</span><span class="p">,</span> <span class="nx">title</span><span class="p">,</span> <span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nb">window</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">pushState</span><span class="p">(</span><span class="nx">stateObject</span><span class="p">,</span> <span class="nx">title</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">linkTo</span><span class="p">(</span><span class="nx">path</span><span class="p">));</span>
    <span class="p">};</span>
    <span class="nx">PushStateNavigator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">replaceState</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">stateObject</span><span class="p">,</span> <span class="nx">title</span><span class="p">,</span> <span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nb">window</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">replaceState</span><span class="p">(</span><span class="nx">stateObject</span><span class="p">,</span> <span class="nx">title</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">linkTo</span><span class="p">(</span><span class="nx">path</span><span class="p">));</span>
    <span class="p">};</span>
    <span class="nx">PushStateNavigator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">linkTo</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">normalizePath</span><span class="p">(</span><span class="nx">Batman</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">pathPrefix</span><span class="p">,</span> <span class="nx">url</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">PushStateNavigator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">pathFromLocation</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">location</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">fullPath</span><span class="p">,</span> <span class="nx">prefixPattern</span><span class="p">;</span>
      <span class="nx">fullPath</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">location</span><span class="p">.</span><span class="nx">pathname</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">location</span><span class="p">.</span><span class="nx">search</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
      <span class="nx">prefixPattern</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;^&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">normalizePath</span><span class="p">(</span><span class="nx">Batman</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">pathPrefix</span><span class="p">)));</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">normalizePath</span><span class="p">(</span><span class="nx">fullPath</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">prefixPattern</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">));</span>
    <span class="p">};</span>
    <span class="nx">PushStateNavigator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">handleLocation</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">location</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">hashbangPath</span><span class="p">,</span> <span class="nx">path</span><span class="p">;</span>
      <span class="nx">path</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">pathFromLocation</span><span class="p">(</span><span class="nx">location</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">path</span> <span class="o">===</span> <span class="s1">&#39;/&#39;</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">hashbangPath</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">HashbangNavigator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">pathFromLocation</span><span class="p">(</span><span class="nx">location</span><span class="p">))</span> <span class="o">!==</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">hashbangPath</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">PushStateNavigator</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">handleLocation</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">PushStateNavigator</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">HashbangNavigator</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">HashbangNavigator</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Navigator</span><span class="p">);</span>
    <span class="kd">function</span> <span class="nx">HashbangNavigator</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">HashbangNavigator</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">HashbangNavigator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">HASH_PREFIX</span> <span class="o">=</span> <span class="s1">&#39;#!&#39;</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">((</span><span class="k">typeof</span> <span class="nb">window</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">window</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;onhashchange&#39;</span> <span class="k">in</span> <span class="nb">window</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">HashbangNavigator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">startWatching</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$addEventListener</span><span class="p">(</span><span class="nb">window</span><span class="p">,</span> <span class="s1">&#39;hashchange&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">handleCurrentLocation</span><span class="p">);</span>
      <span class="p">};</span>
      <span class="nx">HashbangNavigator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">stopWatching</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$removeEventListener</span><span class="p">(</span><span class="nb">window</span><span class="p">,</span> <span class="s1">&#39;hashchange&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">handleCurrentLocation</span><span class="p">);</span>
      <span class="p">};</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">HashbangNavigator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">startWatching</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">interval</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">handleCurrentLocation</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
      <span class="p">};</span>
      <span class="nx">HashbangNavigator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">stopWatching</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">interval</span> <span class="o">=</span> <span class="nx">clearInterval</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">interval</span><span class="p">);</span>
      <span class="p">};</span>
    <span class="p">}</span>
    <span class="nx">HashbangNavigator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">pushState</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">stateObject</span><span class="p">,</span> <span class="nx">title</span><span class="p">,</span> <span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">linkTo</span><span class="p">(</span><span class="nx">path</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">HashbangNavigator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">replaceState</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">stateObject</span><span class="p">,</span> <span class="nx">title</span><span class="p">,</span> <span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">loc</span><span class="p">;</span>
      <span class="nx">loc</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">;</span>
      <span class="k">return</span> <span class="nx">loc</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="nx">loc</span><span class="p">.</span><span class="nx">pathname</span> <span class="o">+</span> <span class="nx">loc</span><span class="p">.</span><span class="nx">search</span> <span class="o">+</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">linkTo</span><span class="p">(</span><span class="nx">path</span><span class="p">)));</span>
    <span class="p">};</span>
    <span class="nx">HashbangNavigator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">linkTo</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">HASH_PREFIX</span> <span class="o">+</span> <span class="nx">url</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">HashbangNavigator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">pathFromLocation</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">location</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">hash</span><span class="p">;</span>
      <span class="nx">hash</span> <span class="o">=</span> <span class="nx">location</span><span class="p">.</span><span class="nx">hash</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">((</span><span class="nx">hash</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">hash</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="k">this</span><span class="p">.</span><span class="nx">HASH_PREFIX</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">normalizePath</span><span class="p">(</span><span class="nx">hash</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;/&#39;</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">HashbangNavigator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">handleLocation</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">location</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">realPath</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Batman</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">usePushState</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">HashbangNavigator</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">handleLocation</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">realPath</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">PushStateNavigator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">pathFromLocation</span><span class="p">(</span><span class="nx">location</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">realPath</span> <span class="o">===</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">HashbangNavigator</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">handleLocation</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">location</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">normalizePath</span><span class="p">(</span><span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">pathPrefix</span> <span class="o">+</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">linkTo</span><span class="p">(</span><span class="nx">realPath</span><span class="p">))));</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">HashbangNavigator</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">redirect</span> <span class="o">=</span> <span class="nx">$redirect</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">_ref</span><span class="p">;</span>
    <span class="k">return</span> <span class="p">(</span><span class="nx">_ref</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">navigator</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">};</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">App</span><span class="p">.</span><span class="nx">classMixin</span><span class="p">({</span>
    <span class="nx">route</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">signature</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">dispatcher</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">options</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">options</span> <span class="o">=</span> <span class="p">{};</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">url</span> <span class="k">instanceof</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Dispatcher</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">dispatcher</span> <span class="o">=</span> <span class="nx">url</span><span class="p">;</span>
        <span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_dispatcherCache</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">key</span> <span class="k">in</span> <span class="nx">_ref</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">value</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
          <span class="nx">dispatcher</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_dispatcherCache</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">dispatcher</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">$typeOf</span><span class="p">(</span><span class="nx">signature</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;String&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">options</span><span class="p">.</span><span class="nx">signature</span> <span class="o">=</span> <span class="nx">signature</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">$typeOf</span><span class="p">(</span><span class="nx">signature</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;Function&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">options</span> <span class="o">=</span> <span class="nx">signature</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">signature</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$mixin</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="nx">signature</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_dispatcherCache</span> <span class="o">||</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_dispatcherCache</span> <span class="o">=</span> <span class="p">{});</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_dispatcherCache</span><span class="p">[</span><span class="nx">url</span><span class="p">]</span> <span class="o">=</span> <span class="nx">options</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">root</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">signature</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="nx">signature</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">resources</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">resource</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">app</span><span class="p">,</span> <span class="nx">controller</span><span class="p">,</span> <span class="nx">ops</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">options</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">options</span> <span class="o">=</span> <span class="p">{};</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">options</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">callback</span> <span class="o">=</span> <span class="nx">options</span><span class="p">;</span>
        <span class="nx">options</span> <span class="o">=</span> <span class="p">{};</span>
      <span class="p">}</span>
      <span class="nx">resource</span> <span class="o">=</span> <span class="nx">helpers</span><span class="p">.</span><span class="nx">pluralize</span><span class="p">(</span><span class="nx">resource</span><span class="p">);</span>
      <span class="nx">controller</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">controller</span> <span class="o">||</span> <span class="nx">resource</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">parentResource</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">resource</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="nx">options</span><span class="p">.</span><span class="nx">parentResource</span> <span class="o">+</span> <span class="s2">&quot;/:&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">singularize</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">parentResource</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;Id/&quot;</span> <span class="o">+</span> <span class="nx">resource</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">index</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="nx">resource</span><span class="p">,</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="nx">controller</span> <span class="o">+</span> <span class="s2">&quot;#index&quot;</span><span class="p">,</span> <span class="p">{</span>
          <span class="nx">resource</span><span class="o">:</span> <span class="nx">controller</span><span class="p">,</span>
          <span class="nx">action</span><span class="o">:</span> <span class="s1">&#39;index&#39;</span>
        <span class="p">});</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">[</span><span class="s2">&quot;new&quot;</span><span class="p">]</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="nx">resource</span> <span class="o">+</span> <span class="s2">&quot;/new&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="nx">controller</span> <span class="o">+</span> <span class="s2">&quot;#new&quot;</span><span class="p">,</span> <span class="p">{</span>
          <span class="nx">resource</span><span class="o">:</span> <span class="nx">controller</span><span class="p">,</span>
          <span class="nx">action</span><span class="o">:</span> <span class="s1">&#39;new&#39;</span>
        <span class="p">});</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">show</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="nx">resource</span> <span class="o">+</span> <span class="s2">&quot;/:id&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="nx">controller</span> <span class="o">+</span> <span class="s2">&quot;#show&quot;</span><span class="p">,</span> <span class="p">{</span>
          <span class="nx">resource</span><span class="o">:</span> <span class="nx">controller</span><span class="p">,</span>
          <span class="nx">action</span><span class="o">:</span> <span class="s1">&#39;show&#39;</span>
        <span class="p">});</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">edit</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="nx">resource</span> <span class="o">+</span> <span class="s2">&quot;/:id/edit&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="nx">controller</span> <span class="o">+</span> <span class="s2">&quot;#edit&quot;</span><span class="p">,</span> <span class="p">{</span>
          <span class="nx">resource</span><span class="o">:</span> <span class="nx">controller</span><span class="p">,</span>
          <span class="nx">action</span><span class="o">:</span> <span class="s1">&#39;edit&#39;</span>
        <span class="p">});</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">app</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="nx">ops</span> <span class="o">=</span> <span class="p">{</span>
          <span class="nx">collection</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">collectionCallback</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">collectionCallback</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">collectionCallback</span><span class="p">.</span><span class="nx">call</span><span class="p">({</span>
              <span class="nx">route</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">methodName</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">app</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="nx">resource</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nx">url</span><span class="p">,</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="nx">controller</span> <span class="o">+</span> <span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">methodName</span> <span class="o">||</span> <span class="nx">url</span><span class="p">));</span>
              <span class="p">}</span>
            <span class="p">})</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span>
          <span class="p">},</span>
          <span class="nx">member</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">memberCallback</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">memberCallback</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">memberCallback</span><span class="p">.</span><span class="nx">call</span><span class="p">({</span>
              <span class="nx">route</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">methodName</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">app</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="nx">resource</span> <span class="o">+</span> <span class="s2">&quot;/:id/&quot;</span> <span class="o">+</span> <span class="nx">url</span><span class="p">,</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="nx">controller</span> <span class="o">+</span> <span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">methodName</span> <span class="o">||</span> <span class="nx">url</span><span class="p">));</span>
              <span class="p">}</span>
            <span class="p">})</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span>
          <span class="p">},</span>
          <span class="nx">resources</span><span class="o">:</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">childResource</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">options</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">options</span> <span class="o">=</span> <span class="p">{};</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">options</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">callback</span> <span class="o">=</span> <span class="nx">options</span><span class="p">;</span>
              <span class="nx">options</span> <span class="o">=</span> <span class="p">{};</span>
            <span class="p">}</span>
            <span class="nx">options</span><span class="p">.</span><span class="nx">parentResource</span> <span class="o">=</span> <span class="nx">resource</span><span class="p">;</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">resources</span><span class="p">(</span><span class="nx">childResource</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
          <span class="p">},</span> <span class="k">this</span><span class="p">)</span>
        <span class="p">};</span>
        <span class="k">return</span> <span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">ops</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">redirect</span><span class="o">:</span> <span class="nx">$redirect</span>
  <span class="p">});</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">Controller</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">Controller</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nb">Object</span><span class="p">);</span>
    <span class="kd">function</span> <span class="nx">Controller</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">redirect</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">redirect</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
      <span class="nx">Controller</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">Controller</span><span class="p">.</span><span class="nx">singleton</span><span class="p">(</span><span class="s1">&#39;sharedController&#39;</span><span class="p">);</span>
    <span class="nx">Controller</span><span class="p">.</span><span class="nx">beforeFilter</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">nameOrFunction</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">filters</span><span class="p">,</span> <span class="nx">_base</span><span class="p">;</span>
      <span class="nx">Batman</span><span class="p">.</span><span class="nx">initializeObject</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="nx">filters</span> <span class="o">=</span> <span class="p">(</span><span class="nx">_base</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_batman</span><span class="p">).</span><span class="nx">beforeFilters</span> <span class="o">||</span> <span class="p">(</span><span class="nx">_base</span><span class="p">.</span><span class="nx">beforeFilters</span> <span class="o">=</span> <span class="p">[]);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">filters</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">nameOrFunction</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">filters</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">nameOrFunction</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">Controller</span><span class="p">.</span><span class="nx">accessor</span><span class="p">(</span><span class="s1">&#39;controllerName&#39;</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_controllerName</span> <span class="o">||</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_controllerName</span> <span class="o">=</span> <span class="nx">helpers</span><span class="p">.</span><span class="nx">underscore</span><span class="p">(</span><span class="nx">$functionName</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;Controller&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)));</span>
      <span class="p">}</span>
    <span class="p">});</span>
    <span class="nx">Controller</span><span class="p">.</span><span class="nx">afterFilter</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">nameOrFunction</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">filters</span><span class="p">,</span> <span class="nx">_base</span><span class="p">;</span>
      <span class="nx">Batman</span><span class="p">.</span><span class="nx">initializeObject</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="nx">filters</span> <span class="o">=</span> <span class="p">(</span><span class="nx">_base</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_batman</span><span class="p">).</span><span class="nx">afterFilters</span> <span class="o">||</span> <span class="p">(</span><span class="nx">_base</span><span class="p">.</span><span class="nx">afterFilters</span> <span class="o">=</span> <span class="p">[]);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">filters</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">nameOrFunction</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">filters</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">nameOrFunction</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">Controller</span><span class="p">.</span><span class="nx">accessor</span><span class="p">(</span><span class="s1">&#39;action&#39;</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_currentAction</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">set</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_currentAction</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">});</span>
    <span class="nx">Controller</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">dispatch</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">action</span><span class="p">,</span> <span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">filter</span><span class="p">,</span> <span class="nx">filters</span><span class="p">,</span> <span class="nx">oldRedirect</span><span class="p">,</span> <span class="nx">redirectTo</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_j</span><span class="p">,</span> <span class="nx">_len</span><span class="p">,</span> <span class="nx">_len2</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">,</span> <span class="nx">_ref2</span><span class="p">,</span> <span class="nx">_ref3</span><span class="p">,</span> <span class="nx">_ref4</span><span class="p">,</span> <span class="nx">_ref5</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">params</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">params</span> <span class="o">=</span> <span class="p">{};</span>
      <span class="p">}</span>
      <span class="nx">params</span><span class="p">.</span><span class="nx">controller</span> <span class="o">||</span> <span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">controller</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;controllerName&#39;</span><span class="p">));</span>
      <span class="nx">params</span><span class="p">.</span><span class="nx">action</span> <span class="o">||</span> <span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">action</span> <span class="o">=</span> <span class="nx">action</span><span class="p">);</span>
      <span class="nx">params</span><span class="p">.</span><span class="nx">target</span> <span class="o">||</span> <span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">target</span> <span class="o">=</span> <span class="k">this</span><span class="p">);</span>
      <span class="nx">oldRedirect</span> <span class="o">=</span> <span class="p">(</span><span class="nx">_ref</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">navigator</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">redirect</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">((</span><span class="nx">_ref2</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">navigator</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">_ref2</span><span class="p">.</span><span class="nx">redirect</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">redirect</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_actedDuringAction</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;action&#39;</span><span class="p">,</span> <span class="nx">action</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;params&#39;</span><span class="p">,</span> <span class="nx">params</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">filters</span> <span class="o">=</span> <span class="p">(</span><span class="nx">_ref3</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">_batman</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">_ref3</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;beforeFilters&#39;</span><span class="p">)</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">filters</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">filter</span> <span class="o">=</span> <span class="nx">filters</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">filter</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">filter</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">params</span><span class="p">);</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">[</span><span class="nx">filter</span><span class="p">](</span><span class="nx">params</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="nx">developer</span><span class="p">.</span><span class="nx">assert</span><span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="nx">action</span><span class="p">],</span> <span class="s2">&quot;Error! Controller action &quot;</span> <span class="o">+</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;controllerName&#39;</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="nx">action</span> <span class="o">+</span> <span class="s2">&quot; couldn&#39;t be found!&quot;</span><span class="p">);</span>
      <span class="k">this</span><span class="p">[</span><span class="nx">action</span><span class="p">](</span><span class="nx">params</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_actedDuringAction</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">filters</span> <span class="o">=</span> <span class="p">(</span><span class="nx">_ref4</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">_batman</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">_ref4</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;afterFilters&#39;</span><span class="p">)</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">_j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len2</span> <span class="o">=</span> <span class="nx">filters</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_j</span> <span class="o">&lt;</span> <span class="nx">_len2</span><span class="p">;</span> <span class="nx">_j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">filter</span> <span class="o">=</span> <span class="nx">filters</span><span class="p">[</span><span class="nx">_j</span><span class="p">];</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">filter</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">filter</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">params</span><span class="p">);</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">[</span><span class="nx">filter</span><span class="p">](</span><span class="nx">params</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">_actedDuringAction</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">((</span><span class="nx">_ref5</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">navigator</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">_ref5</span><span class="p">.</span><span class="nx">redirect</span> <span class="o">=</span> <span class="nx">oldRedirect</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">redirectTo</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_afterFilterRedirect</span><span class="p">;</span>
      <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">_afterFilterRedirect</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">redirectTo</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$redirect</span><span class="p">(</span><span class="nx">redirectTo</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">Controller</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">redirect</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_actedDuringAction</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="s1">&#39;DoubleRedirectError&#39;</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;action&#39;</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_actedDuringAction</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_afterFilterRedirect</span> <span class="o">=</span> <span class="nx">url</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">$typeOf</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;Object&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">url</span><span class="p">.</span><span class="nx">controller</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">url</span><span class="p">.</span><span class="nx">controller</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">$redirect</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">Controller</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">render</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">controllerName</span><span class="p">,</span> <span class="nx">view</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">,</span> <span class="nx">_ref2</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">options</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">options</span> <span class="o">=</span> <span class="p">{};</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_actedDuringAction</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="s1">&#39;DoubleRenderError&#39;</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_actedDuringAction</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">options</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">.</span><span class="nx">view</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">controllerName</span> <span class="o">=</span> <span class="nx">$functionName</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;Controller&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
        <span class="nx">options</span><span class="p">.</span><span class="nx">contexts</span> <span class="o">||</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">contexts</span> <span class="o">=</span> <span class="p">[]);</span>
        <span class="nx">options</span><span class="p">.</span><span class="nx">contexts</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="nx">options</span><span class="p">.</span><span class="nx">source</span> <span class="o">||</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">source</span> <span class="o">=</span> <span class="nx">helpers</span><span class="p">.</span><span class="nx">underscore</span><span class="p">(</span><span class="nx">controllerName</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_currentAction</span><span class="p">);</span>
        <span class="nx">options</span><span class="p">.</span><span class="nx">view</span> <span class="o">=</span> <span class="k">new</span> <span class="p">(((</span><span class="nx">_ref</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">currentApp</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">_ref</span><span class="p">[</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">camelize</span><span class="p">(</span><span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="nx">controllerName</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_currentAction</span> <span class="o">+</span> <span class="s2">&quot;_view&quot;</span><span class="p">)]</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">View</span><span class="p">)(</span><span class="nx">options</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">view</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">view</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">((</span><span class="nx">_ref2</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">currentApp</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">_ref2</span><span class="p">.</span><span class="nx">prevent</span><span class="p">(</span><span class="s1">&#39;ready&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">view</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;ready&#39;</span><span class="p">,</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">node</span><span class="p">,</span> <span class="nx">yieldTo</span><span class="p">,</span> <span class="nx">yieldingNode</span><span class="p">,</span> <span class="nx">_ref3</span><span class="p">;</span>
          <span class="nx">node</span> <span class="o">=</span> <span class="nx">view</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;node&#39;</span><span class="p">);</span>
          <span class="nx">yieldTo</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">into</span> <span class="o">||</span> <span class="s1">&#39;main&#39;</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">view</span><span class="p">.</span><span class="nx">hasContainer</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">yieldingNode</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">_yields</span><span class="p">[</span><span class="nx">yieldTo</span><span class="p">];</span>
            <span class="nx">$setInnerHTML</span><span class="p">(</span><span class="nx">yieldingNode</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
            <span class="k">while</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">$appendChild</span><span class="p">(</span><span class="nx">yieldingNode</span><span class="p">,</span> <span class="nx">node</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
            <span class="p">}</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">yieldTo</span><span class="p">,</span> <span class="nx">node</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">if</span> <span class="p">((</span><span class="nx">_ref3</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">currentApp</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">_ref3</span><span class="p">.</span><span class="nx">allowAndFire</span><span class="p">(</span><span class="s1">&#39;ready&#39;</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">return</span> <span class="k">typeof</span> <span class="nx">view</span><span class="p">.</span><span class="nx">ready</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span> <span class="o">?</span> <span class="nx">view</span><span class="p">.</span><span class="nx">ready</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">params</span><span class="p">)</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">view</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">Controller</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">Model</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">_fn</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_j</span><span class="p">,</span> <span class="nx">_k</span><span class="p">,</span> <span class="nx">_len</span><span class="p">,</span> <span class="nx">_len2</span><span class="p">,</span> <span class="nx">_len3</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">,</span> <span class="nx">_ref2</span><span class="p">,</span> <span class="nx">_ref3</span><span class="p">;</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">Model</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nb">Object</span><span class="p">);</span>
    <span class="nx">Model</span><span class="p">.</span><span class="nx">primaryKey</span> <span class="o">=</span> <span class="s1">&#39;id&#39;</span><span class="p">;</span>
    <span class="nx">Model</span><span class="p">.</span><span class="nx">storageKey</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="nx">Model</span><span class="p">.</span><span class="nx">persist</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">mechanism</span><span class="p">,</span> <span class="nx">mechanisms</span><span class="p">,</span> <span class="nx">results</span><span class="p">,</span> <span class="nx">storage</span><span class="p">,</span> <span class="nx">_base</span><span class="p">;</span>
      <span class="nx">mechanisms</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="p">[];</span>
      <span class="nx">Batman</span><span class="p">.</span><span class="nx">initializeObject</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">prototype</span><span class="p">);</span>
      <span class="nx">storage</span> <span class="o">=</span> <span class="p">(</span><span class="nx">_base</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_batman</span><span class="p">).</span><span class="nx">storage</span> <span class="o">||</span> <span class="p">(</span><span class="nx">_base</span><span class="p">.</span><span class="nx">storage</span> <span class="o">=</span> <span class="p">[]);</span>
      <span class="nx">results</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">,</span> <span class="nx">_results</span><span class="p">;</span>
        <span class="nx">_results</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">mechanisms</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">mechanism</span> <span class="o">=</span> <span class="nx">mechanisms</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
          <span class="nx">mechanism</span> <span class="o">=</span> <span class="nx">mechanism</span><span class="p">.</span><span class="nx">isStorageAdapter</span> <span class="o">?</span> <span class="nx">mechanism</span> <span class="o">:</span> <span class="k">new</span> <span class="nx">mechanism</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
          <span class="nx">storage</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">mechanism</span><span class="p">);</span>
          <span class="nx">_results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">mechanism</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">_results</span><span class="p">;</span>
      <span class="p">}).</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">results</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">results</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">results</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">Model</span><span class="p">.</span><span class="nx">encode</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">decoder</span><span class="p">,</span> <span class="nx">encoder</span><span class="p">,</span> <span class="nx">encoderOrLastKey</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">keys</span><span class="p">,</span> <span class="nx">_base</span><span class="p">,</span> <span class="nx">_base2</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_j</span><span class="p">,</span> <span class="nx">_len</span><span class="p">,</span> <span class="nx">_results</span><span class="p">;</span>
      <span class="nx">keys</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">&lt;=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_i</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">:</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[]),</span> <span class="nx">encoderOrLastKey</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="nx">_i</span><span class="o">++</span><span class="p">];</span>
      <span class="nx">Batman</span><span class="p">.</span><span class="nx">initializeObject</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">prototype</span><span class="p">);</span>
      <span class="p">(</span><span class="nx">_base</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_batman</span><span class="p">).</span><span class="nx">encoders</span> <span class="o">||</span> <span class="p">(</span><span class="nx">_base</span><span class="p">.</span><span class="nx">encoders</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">SimpleHash</span><span class="p">);</span>
      <span class="p">(</span><span class="nx">_base2</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_batman</span><span class="p">).</span><span class="nx">decoders</span> <span class="o">||</span> <span class="p">(</span><span class="nx">_base2</span><span class="p">.</span><span class="nx">decoders</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">SimpleHash</span><span class="p">);</span>
      <span class="k">switch</span> <span class="p">(</span><span class="nx">$typeOf</span><span class="p">(</span><span class="nx">encoderOrLastKey</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">case</span> <span class="s1">&#39;String&#39;</span><span class="o">:</span>
          <span class="nx">keys</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">encoderOrLastKey</span><span class="p">);</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s1">&#39;Function&#39;</span><span class="o">:</span>
          <span class="nx">encoder</span> <span class="o">=</span> <span class="nx">encoderOrLastKey</span><span class="p">;</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">default</span><span class="o">:</span>
          <span class="nx">encoder</span> <span class="o">=</span> <span class="nx">encoderOrLastKey</span><span class="p">.</span><span class="nx">encode</span><span class="p">;</span>
          <span class="nx">decoder</span> <span class="o">=</span> <span class="nx">encoderOrLastKey</span><span class="p">.</span><span class="nx">decode</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">encoder</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">encoder</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">defaultEncoder</span><span class="p">.</span><span class="nx">encode</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">decoder</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">decoder</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">defaultEncoder</span><span class="p">.</span><span class="nx">decode</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">_results</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">_j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_j</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">key</span> <span class="o">=</span> <span class="nx">keys</span><span class="p">[</span><span class="nx">_j</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">encoder</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_batman</span><span class="p">.</span><span class="nx">encoders</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">encoder</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">_results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">decoder</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_batman</span><span class="p">.</span><span class="nx">decoders</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">decoder</span><span class="p">)</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">_results</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">Model</span><span class="p">.</span><span class="nx">defaultEncoder</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">encode</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">x</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">decode</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">x</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">Model</span><span class="p">.</span><span class="nx">observeAndFire</span><span class="p">(</span><span class="s1">&#39;primaryKey&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">newPrimaryKey</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">encode</span><span class="p">(</span><span class="nx">newPrimaryKey</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">encode</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">decode</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">defaultEncoder</span><span class="p">.</span><span class="nx">decode</span>
      <span class="p">});</span>
    <span class="p">});</span>
    <span class="nx">Model</span><span class="p">.</span><span class="nx">validate</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">keys</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">matches</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">optionsOrFunction</span><span class="p">,</span> <span class="nx">validator</span><span class="p">,</span> <span class="nx">validators</span><span class="p">,</span> <span class="nx">_base</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_j</span><span class="p">,</span> <span class="nx">_len</span><span class="p">,</span> <span class="nx">_results</span><span class="p">;</span>
      <span class="nx">keys</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">&lt;=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_i</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">:</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[]),</span> <span class="nx">optionsOrFunction</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="nx">_i</span><span class="o">++</span><span class="p">];</span>
      <span class="nx">Batman</span><span class="p">.</span><span class="nx">initializeObject</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">prototype</span><span class="p">);</span>
      <span class="nx">validators</span> <span class="o">=</span> <span class="p">(</span><span class="nx">_base</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_batman</span><span class="p">).</span><span class="nx">validators</span> <span class="o">||</span> <span class="p">(</span><span class="nx">_base</span><span class="p">.</span><span class="nx">validators</span> <span class="o">=</span> <span class="p">[]);</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">optionsOrFunction</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">validators</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
          <span class="nx">keys</span><span class="o">:</span> <span class="nx">keys</span><span class="p">,</span>
          <span class="nx">callback</span><span class="o">:</span> <span class="nx">optionsOrFunction</span>
        <span class="p">});</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">options</span> <span class="o">=</span> <span class="nx">optionsOrFunction</span><span class="p">;</span>
        <span class="nx">_results</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">_j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">Validators</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_j</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">validator</span> <span class="o">=</span> <span class="nx">Validators</span><span class="p">[</span><span class="nx">_j</span><span class="p">];</span>
          <span class="nx">_results</span><span class="p">.</span><span class="nx">push</span><span class="p">((</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">_k</span><span class="p">,</span> <span class="nx">_len2</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">((</span><span class="nx">matches</span> <span class="o">=</span> <span class="nx">validator</span><span class="p">.</span><span class="nx">matches</span><span class="p">(</span><span class="nx">options</span><span class="p">)))</span> <span class="p">{</span>
              <span class="k">for</span> <span class="p">(</span><span class="nx">_k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len2</span> <span class="o">=</span> <span class="nx">matches</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_k</span> <span class="o">&lt;</span> <span class="nx">_len2</span><span class="p">;</span> <span class="nx">_k</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">match</span> <span class="o">=</span> <span class="nx">matches</span><span class="p">[</span><span class="nx">_k</span><span class="p">];</span>
                <span class="k">delete</span> <span class="nx">options</span><span class="p">[</span><span class="nx">match</span><span class="p">];</span>
              <span class="p">}</span>
              <span class="k">return</span> <span class="nx">validators</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
                <span class="nx">keys</span><span class="o">:</span> <span class="nx">keys</span><span class="p">,</span>
                <span class="nx">validator</span><span class="o">:</span> <span class="k">new</span> <span class="nx">validator</span><span class="p">(</span><span class="nx">matches</span><span class="p">)</span>
              <span class="p">});</span>
            <span class="p">}</span>
          <span class="p">})());</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">_results</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">Model</span><span class="p">.</span><span class="nx">classAccessor</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">_ref</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hasStorage</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="p">((</span><span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">classState</span><span class="p">())</span> <span class="o">!==</span> <span class="s1">&#39;loaded&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">_ref</span> <span class="o">!==</span> <span class="s1">&#39;loading&#39;</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">load</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;loaded&#39;</span><span class="p">);</span>
      <span class="p">},</span>
      <span class="nx">set</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;loaded&#39;</span><span class="p">,</span> <span class="nx">v</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
    <span class="nx">Model</span><span class="p">.</span><span class="nx">classAccessor</span><span class="p">(</span><span class="s1">&#39;loaded&#39;</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_loaded</span> <span class="o">||</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_loaded</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Set</span><span class="p">);</span>
      <span class="p">},</span>
      <span class="nx">set</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_loaded</span> <span class="o">=</span> <span class="nx">v</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">});</span>
    <span class="nx">Model</span><span class="p">.</span><span class="nx">classAccessor</span><span class="p">(</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">).</span><span class="nx">toArray</span><span class="p">()[</span><span class="mi">0</span><span class="p">];</span>
    <span class="p">});</span>
    <span class="nx">Model</span><span class="p">.</span><span class="nx">classAccessor</span><span class="p">(</span><span class="s1">&#39;last&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">x</span><span class="p">;</span>
      <span class="nx">x</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">).</span><span class="nx">toArray</span><span class="p">();</span>
      <span class="k">return</span> <span class="nx">x</span><span class="p">[</span><span class="nx">x</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
    <span class="p">});</span>
    <span class="nx">Model</span><span class="p">.</span><span class="nx">find</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">newRecord</span><span class="p">,</span> <span class="nx">record</span><span class="p">;</span>
      <span class="nx">developer</span><span class="p">.</span><span class="nx">assert</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="s2">&quot;Must call find with a callback!&quot;</span><span class="p">);</span>
      <span class="nx">record</span> <span class="o">=</span> <span class="k">new</span> <span class="k">this</span><span class="p">();</span>
      <span class="nx">record</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="nx">id</span><span class="p">);</span>
      <span class="nx">newRecord</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_mapIdentity</span><span class="p">(</span><span class="nx">record</span><span class="p">);</span>
      <span class="nx">newRecord</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">newRecord</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">Model</span><span class="p">.</span><span class="nx">load</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">$typeOf</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;Function&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">callback</span> <span class="o">=</span> <span class="nx">options</span><span class="p">;</span>
        <span class="nx">options</span> <span class="o">=</span> <span class="p">{};</span>
      <span class="p">}</span>
      <span class="nx">developer</span><span class="p">.</span><span class="nx">assert</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_batman</span><span class="p">.</span><span class="nx">getAll</span><span class="p">(</span><span class="s1">&#39;storage&#39;</span><span class="p">).</span><span class="nx">length</span><span class="p">,</span> <span class="s2">&quot;Can&#39;t load model &quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">$functionName</span><span class="p">(</span><span class="k">this</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; without any storage adapters!&quot;</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">loading</span><span class="p">();</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_doStorageOperation</span><span class="p">(</span><span class="s1">&#39;readAll&#39;</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">records</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">mappedRecords</span><span class="p">,</span> <span class="nx">record</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="k">typeof</span> <span class="nx">callback</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span> <span class="o">?</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="p">[])</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">mappedRecords</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">,</span> <span class="nx">_results</span><span class="p">;</span>
            <span class="nx">_results</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">records</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">record</span> <span class="o">=</span> <span class="nx">records</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
              <span class="nx">_results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_mapIdentity</span><span class="p">(</span><span class="nx">record</span><span class="p">));</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nx">_results</span><span class="p">;</span>
          <span class="p">}).</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">loaded</span><span class="p">();</span>
          <span class="k">return</span> <span class="k">typeof</span> <span class="nx">callback</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span> <span class="o">?</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">mappedRecords</span><span class="p">)</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
    <span class="p">};</span>
    <span class="nx">Model</span><span class="p">.</span><span class="nx">create</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">attrs</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">obj</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">_ref</span> <span class="o">=</span> <span class="p">[{},</span> <span class="nx">attrs</span><span class="p">],</span> <span class="nx">attrs</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">callback</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
      <span class="p">}</span>
      <span class="nx">obj</span> <span class="o">=</span> <span class="k">new</span> <span class="k">this</span><span class="p">(</span><span class="nx">attrs</span><span class="p">);</span>
      <span class="nx">obj</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">obj</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">Model</span><span class="p">.</span><span class="nx">findOrCreate</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">attrs</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">foundRecord</span><span class="p">,</span> <span class="nx">record</span><span class="p">;</span>
      <span class="nx">record</span> <span class="o">=</span> <span class="k">new</span> <span class="k">this</span><span class="p">(</span><span class="nx">attrs</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">record</span><span class="p">.</span><span class="nx">isNew</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">record</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">foundRecord</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_mapIdentity</span><span class="p">(</span><span class="nx">record</span><span class="p">);</span>
        <span class="nx">foundRecord</span><span class="p">.</span><span class="nx">updateAttributes</span><span class="p">(</span><span class="nx">attrs</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="k">void</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">foundRecord</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">Model</span><span class="p">.</span><span class="nx">_mapIdentity</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">existing</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="p">(</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">record</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">))</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">||</span> <span class="nx">id</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">record</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">existing</span> <span class="o">=</span> <span class="p">(</span><span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;loaded.indexedBy.id&quot;</span><span class="p">).</span><span class="nx">get</span><span class="p">(</span><span class="nx">id</span><span class="p">))</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">toArray</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">existing</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">existing</span><span class="p">.</span><span class="nx">updateAttributes</span><span class="p">(</span><span class="nx">record</span><span class="p">.</span><span class="nx">_batman</span><span class="p">.</span><span class="nx">attributes</span> <span class="o">||</span> <span class="p">{});</span>
          <span class="k">return</span> <span class="nx">existing</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;loaded&#39;</span><span class="p">).</span><span class="nx">add</span><span class="p">(</span><span class="nx">record</span><span class="p">);</span>
          <span class="k">return</span> <span class="nx">record</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">_ref</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;belongsTo&#39;</span><span class="p">,</span> <span class="s1">&#39;hasOne&#39;</span><span class="p">,</span> <span class="s1">&#39;hasMany&#39;</span><span class="p">];</span>
    <span class="nx">_fn</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">label</span><span class="p">,</span> <span class="nx">scope</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">collection</span><span class="p">,</span> <span class="nx">_base</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_batman</span><span class="p">.</span><span class="nx">check</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="nx">collection</span> <span class="o">=</span> <span class="p">(</span><span class="nx">_base</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_batman</span><span class="p">).</span><span class="nx">associations</span> <span class="o">||</span> <span class="p">(</span><span class="nx">_base</span><span class="p">.</span><span class="nx">associations</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">AssociationCollection</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
        <span class="k">return</span> <span class="nx">collection</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Association</span><span class="p">[</span><span class="nx">k</span><span class="p">](</span><span class="k">this</span><span class="p">,</span> <span class="nx">label</span><span class="p">,</span> <span class="nx">scope</span><span class="p">));</span>
      <span class="p">};</span>
    <span class="p">},</span> <span class="nx">Model</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">k</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
      <span class="nx">_fn</span><span class="p">(</span><span class="nx">k</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">Model</span><span class="p">.</span><span class="nx">accessor</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">pk</span><span class="p">;</span>
        <span class="nx">pk</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">primaryKey</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">pk</span> <span class="o">===</span> <span class="s1">&#39;id&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">pk</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="nx">set</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">pk</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">v</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">v</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/[^0-9]/</span><span class="p">)</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">v</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">pk</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">primaryKey</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">pk</span> <span class="o">===</span> <span class="s1">&#39;id&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">v</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">pk</span><span class="p">,</span> <span class="nx">v</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">});</span>
    <span class="nx">Model</span><span class="p">.</span><span class="nx">accessor</span><span class="p">(</span><span class="s1">&#39;dirtyKeys&#39;</span><span class="p">,</span> <span class="s1">&#39;errors&#39;</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Property</span><span class="p">.</span><span class="nx">defaultAccessor</span><span class="p">);</span>
    <span class="nx">Model</span><span class="p">.</span><span class="nx">accessor</span><span class="p">(</span><span class="s1">&#39;batmanState&#39;</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">();</span>
      <span class="p">},</span>
      <span class="nx">set</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">(</span><span class="nx">v</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
    <span class="nx">Model</span><span class="p">.</span><span class="nx">accessor</span><span class="p">(</span><span class="nx">Model</span><span class="p">.</span><span class="nx">defaultAccessor</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">_base</span><span class="p">;</span>
        <span class="k">return</span> <span class="p">((</span><span class="nx">_base</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_batman</span><span class="p">).</span><span class="nx">attributes</span> <span class="o">||</span> <span class="p">(</span><span class="nx">_base</span><span class="p">.</span><span class="nx">attributes</span> <span class="o">=</span> <span class="p">{}))[</span><span class="nx">k</span><span class="p">]</span> <span class="o">||</span> <span class="k">this</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>
      <span class="p">},</span>
      <span class="nx">set</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">_base</span><span class="p">;</span>
        <span class="k">return</span> <span class="p">((</span><span class="nx">_base</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_batman</span><span class="p">).</span><span class="nx">attributes</span> <span class="o">||</span> <span class="p">(</span><span class="nx">_base</span><span class="p">.</span><span class="nx">attributes</span> <span class="o">=</span> <span class="p">{}))[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">v</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">unset</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">_base</span><span class="p">;</span>
        <span class="nx">x</span> <span class="o">=</span> <span class="p">((</span><span class="nx">_base</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_batman</span><span class="p">).</span><span class="nx">attributes</span> <span class="o">||</span> <span class="p">(</span><span class="nx">_base</span><span class="p">.</span><span class="nx">attributes</span> <span class="o">=</span> <span class="p">{}))[</span><span class="nx">k</span><span class="p">];</span>
        <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">_batman</span><span class="p">.</span><span class="nx">attributes</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>
        <span class="k">return</span> <span class="nx">x</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">});</span>
    <span class="kd">function</span> <span class="nx">Model</span><span class="p">(</span><span class="nx">idOrAttributes</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">idOrAttributes</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">idOrAttributes</span> <span class="o">=</span> <span class="p">{};</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">destroy</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">destroy</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">save</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">save</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">load</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">load</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
      <span class="nx">developer</span><span class="p">.</span><span class="nx">assert</span><span class="p">(</span><span class="k">this</span> <span class="k">instanceof</span> <span class="nx">Batman</span><span class="p">.</span><span class="nb">Object</span><span class="p">,</span> <span class="s2">&quot;constructors must be called with new&quot;</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">dirtyKeys</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Hash</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">errors</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">ErrorsSet</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">$typeOf</span><span class="p">(</span><span class="nx">idOrAttributes</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;Object&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Model</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">idOrAttributes</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">Model</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="nx">idOrAttributes</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">empty</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">Model</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">set</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">oldValue</span><span class="p">,</span> <span class="nx">result</span><span class="p">,</span> <span class="nx">_ref2</span><span class="p">;</span>
      <span class="nx">oldValue</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">oldValue</span> <span class="o">===</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">result</span> <span class="o">=</span> <span class="nx">Model</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">set</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">dirtyKeys</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">oldValue</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">((</span><span class="nx">_ref2</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">())</span> <span class="o">!==</span> <span class="s1">&#39;dirty&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">_ref2</span> <span class="o">!==</span> <span class="s1">&#39;loading&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">_ref2</span> <span class="o">!==</span> <span class="s1">&#39;creating&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">dirty</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">Model</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">updateAttributes</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">attrs</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">mixin</span><span class="p">(</span><span class="nx">attrs</span><span class="p">);</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">Model</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">$functionName</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">));</span>
    <span class="p">};</span>
    <span class="nx">Model</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toJSON</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">encoders</span><span class="p">,</span> <span class="nx">obj</span><span class="p">;</span>
      <span class="nx">obj</span> <span class="o">=</span> <span class="p">{};</span>
      <span class="nx">encoders</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_batman</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;encoders&#39;</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="o">!</span><span class="nx">encoders</span> <span class="o">||</span> <span class="nx">encoders</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">()))</span> <span class="p">{</span>
        <span class="nx">encoders</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">encoder</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">encodedVal</span><span class="p">,</span> <span class="nx">val</span><span class="p">;</span>
          <span class="nx">val</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">val</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">encodedVal</span> <span class="o">=</span> <span class="nx">encoder</span><span class="p">(</span><span class="nx">val</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">obj</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">encodedVal</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">return</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">encodedVal</span><span class="p">;</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">obj</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">Model</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">fromJSON</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">decoders</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">obj</span><span class="p">,</span> <span class="nx">value</span><span class="p">;</span>
      <span class="nx">obj</span> <span class="o">=</span> <span class="p">{};</span>
      <span class="nx">decoders</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_batman</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;decoders&#39;</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">decoders</span> <span class="o">||</span> <span class="nx">decoders</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">key</span> <span class="k">in</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">value</span> <span class="o">=</span> <span class="nx">data</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
          <span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">decoders</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">decoder</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nx">key</span><span class="p">])</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">decoder</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nx">key</span><span class="p">],</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">obj</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="nx">developer</span><span class="p">[</span><span class="s2">&quot;do&quot;</span><span class="p">](</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">((</span><span class="o">!</span><span class="nx">decoders</span><span class="p">)</span> <span class="o">||</span> <span class="nx">decoders</span><span class="p">.</span><span class="nx">reduce</span><span class="p">((</span><span class="kd">function</span><span class="p">(</span><span class="nx">sum</span><span class="p">,</span> <span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">sum</span> <span class="o">+</span> <span class="nx">x</span><span class="p">;</span>
        <span class="p">}),</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">developer</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s2">&quot;Warning: Model &quot;</span> <span class="o">+</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;storageKey&#39;</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; has suspiciously few decoders!&quot;</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">});</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">mixin</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">Model</span><span class="p">.</span><span class="nx">actsAsStateMachine</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
    <span class="nx">_ref2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;empty&#39;</span><span class="p">,</span> <span class="s1">&#39;dirty&#39;</span><span class="p">,</span> <span class="s1">&#39;loading&#39;</span><span class="p">,</span> <span class="s1">&#39;loaded&#39;</span><span class="p">,</span> <span class="s1">&#39;saving&#39;</span><span class="p">,</span> <span class="s1">&#39;saved&#39;</span><span class="p">,</span> <span class="s1">&#39;creating&#39;</span><span class="p">,</span> <span class="s1">&#39;created&#39;</span><span class="p">,</span> <span class="s1">&#39;validating&#39;</span><span class="p">,</span> <span class="s1">&#39;validated&#39;</span><span class="p">,</span> <span class="s1">&#39;destroying&#39;</span><span class="p">,</span> <span class="s1">&#39;destroyed&#39;</span><span class="p">];</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">_j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len2</span> <span class="o">=</span> <span class="nx">_ref2</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_j</span> <span class="o">&lt;</span> <span class="nx">_len2</span><span class="p">;</span> <span class="nx">_j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">k</span> <span class="o">=</span> <span class="nx">_ref2</span><span class="p">[</span><span class="nx">_j</span><span class="p">];</span>
      <span class="nx">Model</span><span class="p">.</span><span class="nx">state</span><span class="p">(</span><span class="nx">k</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">_ref3</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;loading&#39;</span><span class="p">,</span> <span class="s1">&#39;loaded&#39;</span><span class="p">];</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">_k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len3</span> <span class="o">=</span> <span class="nx">_ref3</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_k</span> <span class="o">&lt;</span> <span class="nx">_len3</span><span class="p">;</span> <span class="nx">_k</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">k</span> <span class="o">=</span> <span class="nx">_ref3</span><span class="p">[</span><span class="nx">_k</span><span class="p">];</span>
      <span class="nx">Model</span><span class="p">.</span><span class="nx">classState</span><span class="p">(</span><span class="nx">k</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">Model</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_doStorageOperation</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">operation</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">mechanism</span><span class="p">,</span> <span class="nx">mechanisms</span><span class="p">,</span> <span class="nx">_l</span><span class="p">,</span> <span class="nx">_len4</span><span class="p">;</span>
      <span class="nx">developer</span><span class="p">.</span><span class="nx">assert</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">hasStorage</span><span class="p">(),</span> <span class="s2">&quot;Can&#39;t &quot;</span> <span class="o">+</span> <span class="nx">operation</span> <span class="o">+</span> <span class="s2">&quot; model &quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">$functionName</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; without any storage adapters!&quot;</span><span class="p">);</span>
      <span class="nx">mechanisms</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_batman</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;storage&#39;</span><span class="p">);</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">_l</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len4</span> <span class="o">=</span> <span class="nx">mechanisms</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_l</span> <span class="o">&lt;</span> <span class="nx">_len4</span><span class="p">;</span> <span class="nx">_l</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">mechanism</span> <span class="o">=</span> <span class="nx">mechanisms</span><span class="p">[</span><span class="nx">_l</span><span class="p">];</span>
        <span class="nx">mechanism</span><span class="p">[</span><span class="nx">operation</span><span class="p">](</span><span class="k">this</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">Model</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hasStorage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_batman</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;storage&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="p">[]).</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">Model</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">load</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">_ref4</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">((</span><span class="nx">_ref4</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">())</span> <span class="o">===</span> <span class="s1">&#39;destroying&#39;</span> <span class="o">||</span> <span class="nx">_ref4</span> <span class="o">===</span> <span class="s1">&#39;destroyed&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">callback</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">callback</span><span class="p">(</span><span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Can&#39;t load a destroyed record!&quot;</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">loading</span><span class="p">();</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_doStorageOperation</span><span class="p">(</span><span class="s1">&#39;read&#39;</span><span class="p">,</span> <span class="p">{},</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">loaded</span><span class="p">();</span>
          <span class="nx">record</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">_mapIdentity</span><span class="p">(</span><span class="nx">record</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">typeof</span> <span class="nx">callback</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span> <span class="o">?</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">record</span><span class="p">)</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
    <span class="p">};</span>
    <span class="nx">Model</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">save</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">_ref4</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">((</span><span class="nx">_ref4</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">())</span> <span class="o">===</span> <span class="s1">&#39;destroying&#39;</span> <span class="o">||</span> <span class="nx">_ref4</span> <span class="o">===</span> <span class="s1">&#39;destroyed&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">callback</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">callback</span><span class="p">(</span><span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Can&#39;t save a destroyed record!&quot;</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">validate</span><span class="p">(</span><span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">isValid</span><span class="p">,</span> <span class="nx">errors</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">associations</span><span class="p">,</span> <span class="nx">creating</span><span class="p">,</span> <span class="nx">_ref5</span><span class="p">,</span> <span class="nx">_ref6</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isValid</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">callback</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">callback</span><span class="p">(</span><span class="nx">errors</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">creating</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">isNew</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">saving</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">creating</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">creating</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="nx">associations</span> <span class="o">=</span> <span class="p">(</span><span class="nx">_ref5</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">_batman</span><span class="p">.</span><span class="nx">associations</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">_ref5</span><span class="p">.</span><span class="nx">getAll</span><span class="p">()</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">associations</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">((</span><span class="nx">_ref6</span> <span class="o">=</span> <span class="nx">associations</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;belongsTo&#39;</span><span class="p">))</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">_ref6</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">association</span><span class="p">,</span> <span class="nx">label</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">return</span> <span class="nx">association</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
            <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_doStorageOperation</span><span class="p">((</span><span class="nx">creating</span> <span class="o">?</span> <span class="s1">&#39;create&#39;</span> <span class="o">:</span> <span class="s1">&#39;update&#39;</span><span class="p">),</span> <span class="p">{},</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">_ref7</span><span class="p">,</span> <span class="nx">_ref8</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">creating</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">this</span><span class="p">.</span><span class="nx">created</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">saved</span><span class="p">();</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">dirtyKeys</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">associations</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">if</span> <span class="p">((</span><span class="nx">_ref7</span> <span class="o">=</span> <span class="nx">associations</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;hasOne&#39;</span><span class="p">))</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">_ref7</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">association</span><span class="p">)</span> <span class="p">{</span>
                  <span class="k">return</span> <span class="nx">association</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">record</span><span class="p">);</span>
                <span class="p">});</span>
              <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">associations</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">if</span> <span class="p">((</span><span class="nx">_ref8</span> <span class="o">=</span> <span class="nx">associations</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;hasMany&#39;</span><span class="p">))</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">_ref8</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">association</span><span class="p">)</span> <span class="p">{</span>
                  <span class="k">return</span> <span class="nx">association</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">record</span><span class="p">);</span>
                <span class="p">});</span>
              <span class="p">}</span>
            <span class="p">}</span>
            <span class="nx">record</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">_mapIdentity</span><span class="p">(</span><span class="nx">record</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">return</span> <span class="k">typeof</span> <span class="nx">callback</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span> <span class="o">?</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">record</span><span class="p">)</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
      <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
    <span class="p">};</span>
    <span class="nx">Model</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">destroy</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">destroying</span><span class="p">();</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_doStorageOperation</span><span class="p">(</span><span class="s1">&#39;destroy&#39;</span><span class="p">,</span> <span class="p">{},</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">).</span><span class="nx">remove</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">destroyed</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">typeof</span> <span class="nx">callback</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span> <span class="o">?</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
    <span class="p">};</span>
    <span class="nx">Model</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">validate</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">count</span><span class="p">,</span> <span class="nx">finish</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">oldState</span><span class="p">,</span> <span class="nx">v</span><span class="p">,</span> <span class="nx">validationCallback</span><span class="p">,</span> <span class="nx">validator</span><span class="p">,</span> <span class="nx">validators</span><span class="p">,</span> <span class="nx">_l</span><span class="p">,</span> <span class="nx">_len4</span><span class="p">,</span> <span class="nx">_len5</span><span class="p">,</span> <span class="nx">_m</span><span class="p">,</span> <span class="nx">_ref4</span><span class="p">;</span>
      <span class="nx">oldState</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">errors</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">validating</span><span class="p">();</span>
      <span class="nx">finish</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">validated</span><span class="p">();</span>
        <span class="k">this</span><span class="p">[</span><span class="nx">oldState</span><span class="p">]();</span>
        <span class="k">return</span> <span class="k">typeof</span> <span class="nx">callback</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span> <span class="o">?</span> <span class="nx">callback</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">errors</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">errors</span><span class="p">)</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">},</span> <span class="k">this</span><span class="p">);</span>
      <span class="nx">validators</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_batman</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;validators&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="p">[];</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">validators</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">finish</span><span class="p">();</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">count</span> <span class="o">=</span> <span class="nx">validators</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
        <span class="nx">validationCallback</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">--</span><span class="nx">count</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">finish</span><span class="p">();</span>
          <span class="p">}</span>
        <span class="p">},</span> <span class="k">this</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">_l</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len4</span> <span class="o">=</span> <span class="nx">validators</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_l</span> <span class="o">&lt;</span> <span class="nx">_len4</span><span class="p">;</span> <span class="nx">_l</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">validator</span> <span class="o">=</span> <span class="nx">validators</span><span class="p">[</span><span class="nx">_l</span><span class="p">];</span>
          <span class="nx">v</span> <span class="o">=</span> <span class="nx">validator</span><span class="p">.</span><span class="nx">validator</span><span class="p">;</span>
          <span class="nx">_ref4</span> <span class="o">=</span> <span class="nx">validator</span><span class="p">.</span><span class="nx">keys</span><span class="p">;</span>
          <span class="k">for</span> <span class="p">(</span><span class="nx">_m</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len5</span> <span class="o">=</span> <span class="nx">_ref4</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_m</span> <span class="o">&lt;</span> <span class="nx">_len5</span><span class="p">;</span> <span class="nx">_m</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">key</span> <span class="o">=</span> <span class="nx">_ref4</span><span class="p">[</span><span class="nx">_m</span><span class="p">];</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">v</span><span class="p">.</span><span class="nx">validateEach</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">errors</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">validationCallback</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
              <span class="nx">validator</span><span class="p">.</span><span class="nx">callback</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">errors</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">validationCallback</span><span class="p">);</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">Model</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">isNew</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">typeof</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">Model</span><span class="p">;</span>
  <span class="p">}).</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">AssociationCollection</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">AssociationCollection</span><span class="p">.</span><span class="nx">availableAssociations</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;belongsTo&#39;</span><span class="p">,</span> <span class="s1">&#39;hasOne&#39;</span><span class="p">,</span> <span class="s1">&#39;hasMany&#39;</span><span class="p">];</span>
    <span class="kd">function</span> <span class="nx">AssociationCollection</span><span class="p">(</span><span class="nx">model</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">model</span> <span class="o">=</span> <span class="nx">model</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">storage</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">SimpleHash</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">AssociationCollection</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">add</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">association</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">associationTypeHash</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">associationTypeHash</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">storage</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">association</span><span class="p">.</span><span class="nx">constructor</span><span class="p">)))</span> <span class="p">{</span>
        <span class="nx">associationTypeHash</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">SimpleHash</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">storage</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">association</span><span class="p">.</span><span class="nx">associationType</span><span class="p">,</span> <span class="nx">associationTypeHash</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">associationTypeHash</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">association</span><span class="p">,</span> <span class="nx">association</span><span class="p">.</span><span class="nx">label</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">AssociationCollection</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">get</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">storage</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">AssociationCollection</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getAll</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">ancestorCollection</span><span class="p">,</span> <span class="nx">ancestorCollections</span><span class="p">,</span> <span class="nx">ancestorValuesAtKey</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">newStorage</span><span class="p">,</span> <span class="nx">val</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">,</span> <span class="nx">_ref2</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">_batman</span><span class="p">.</span><span class="nx">check</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">);</span>
      <span class="nx">ancestorCollections</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">_batman</span><span class="p">.</span><span class="nx">ancestors</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">ancestor</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">ancestor</span><span class="p">.</span><span class="nx">_batman</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;associations&#39;</span><span class="p">);</span>
      <span class="p">});</span>
      <span class="nx">newStorage</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">SimpleHash</span><span class="p">;</span>
      <span class="nx">_ref</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">AssociationCollection</span><span class="p">.</span><span class="nx">availableAssociations</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">key</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
        <span class="nx">ancestorValuesAtKey</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">_j</span><span class="p">,</span> <span class="nx">_len2</span><span class="p">,</span> <span class="nx">_results</span><span class="p">;</span>
          <span class="nx">_results</span> <span class="o">=</span> <span class="p">[];</span>
          <span class="k">for</span> <span class="p">(</span><span class="nx">_j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len2</span> <span class="o">=</span> <span class="nx">ancestorCollections</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_j</span> <span class="o">&lt;</span> <span class="nx">_len2</span><span class="p">;</span> <span class="nx">_j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">ancestorCollection</span> <span class="o">=</span> <span class="nx">ancestorCollections</span><span class="p">[</span><span class="nx">_j</span><span class="p">];</span>
            <span class="k">if</span> <span class="p">((</span><span class="nx">ancestorCollection</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">val</span> <span class="o">=</span> <span class="nx">ancestorCollection</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">key</span><span class="p">)))</span> <span class="p">{</span>
              <span class="nx">_results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">val</span><span class="p">);</span>
            <span class="p">}</span>
          <span class="p">}</span>
          <span class="k">return</span> <span class="nx">_results</span><span class="p">;</span>
        <span class="p">})();</span>
        <span class="nx">newStorage</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="p">(</span><span class="nx">_ref2</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">storage</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="o">||</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">SimpleHash</span><span class="p">).</span><span class="nx">merge</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">_ref2</span><span class="p">,</span> <span class="nx">ancestorValuesAtKey</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">storage</span> <span class="o">=</span> <span class="nx">newStorage</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">getAll</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">storage</span><span class="p">;</span>
      <span class="p">};</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">storage</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">AssociationCollection</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">Association</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">AssociationSetSetIndex</span><span class="p">;</span>
    <span class="nx">Association</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">associationType</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="nx">Association</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">defaultOptions</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">saveInline</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="nx">autoload</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">};</span>
    <span class="kd">function</span> <span class="nx">Association</span><span class="p">(</span><span class="nx">model</span><span class="p">,</span> <span class="nx">label</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">defaultOptions</span><span class="p">,</span> <span class="nx">getAccessor</span><span class="p">,</span> <span class="nx">self</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">model</span> <span class="o">=</span> <span class="nx">model</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">label</span> <span class="o">=</span> <span class="nx">label</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">options</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">options</span> <span class="o">=</span> <span class="p">{};</span>
      <span class="p">}</span>
      <span class="nx">defaultOptions</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">namespace</span><span class="o">:</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">currentApp</span><span class="p">,</span>
        <span class="nx">name</span><span class="o">:</span> <span class="nx">helpers</span><span class="p">.</span><span class="nx">camelize</span><span class="p">(</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">singularize</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">label</span><span class="p">))</span>
      <span class="p">};</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">options</span> <span class="o">=</span> <span class="nx">$mixin</span><span class="p">(</span><span class="nx">defaultOptions</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">defaultOptions</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
      <span class="nx">model</span><span class="p">.</span><span class="nx">encode</span><span class="p">(</span><span class="nx">label</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">encoder</span><span class="p">());</span>
      <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="nx">getAccessor</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">getAccessor</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">self</span><span class="p">,</span> <span class="nx">model</span><span class="p">,</span> <span class="nx">label</span><span class="p">);</span>
      <span class="p">};</span>
      <span class="nx">model</span><span class="p">.</span><span class="nx">accessor</span><span class="p">(</span><span class="nx">label</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">get</span><span class="o">:</span> <span class="nx">getAccessor</span><span class="p">,</span>
        <span class="nx">set</span><span class="o">:</span> <span class="nx">model</span><span class="p">.</span><span class="nx">defaultAccessor</span><span class="p">.</span><span class="nx">set</span><span class="p">,</span>
        <span class="nx">unset</span><span class="o">:</span> <span class="nx">model</span><span class="p">.</span><span class="nx">defaultAccessor</span><span class="p">.</span><span class="nx">unset</span>
      <span class="p">});</span>
    <span class="p">}</span>
    <span class="nx">AssociationSetSetIndex</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">__extends</span><span class="p">(</span><span class="nx">AssociationSetSetIndex</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">SetIndex</span><span class="p">);</span>
      <span class="kd">function</span> <span class="nx">AssociationSetSetIndex</span><span class="p">(</span><span class="nx">association</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">association</span> <span class="o">=</span> <span class="nx">association</span><span class="p">;</span>
        <span class="nx">AssociationSetSetIndex</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">association</span><span class="p">.</span><span class="nx">getRelatedModel</span><span class="p">().</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;loaded&#39;</span><span class="p">),</span> <span class="k">this</span><span class="p">.</span><span class="nx">association</span><span class="p">.</span><span class="nx">foreignKey</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">AssociationSetSetIndex</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_resultSetForKey</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_storage</span><span class="p">.</span><span class="nx">getOrSet</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="k">return</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Association</span><span class="p">.</span><span class="nx">Set</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">association</span><span class="p">);</span>
        <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
      <span class="p">};</span>
      <span class="k">return</span> <span class="nx">AssociationSetSetIndex</span><span class="p">;</span>
    <span class="p">})();</span>
    <span class="nx">Association</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setIndex</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">index</span> <span class="o">||</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">index</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AssociationSetSetIndex</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">index</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">Association</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getRelatedModel</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">modelName</span><span class="p">,</span> <span class="nx">scope</span><span class="p">;</span>
      <span class="nx">scope</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">namespace</span> <span class="o">||</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">currentApp</span><span class="p">;</span>
      <span class="nx">modelName</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
      <span class="k">return</span> <span class="nx">scope</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">scope</span><span class="p">[</span><span class="nx">modelName</span><span class="p">]</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">Association</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getFromAttributes</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">record</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">defaultAccessor</span><span class="p">.</span><span class="nx">get</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">record</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">label</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">Association</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getAccessor</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">developer</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;You must override getAccessor in Batman.Association subclasses.&quot;</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">Association</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">encoder</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">developer</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;You must override encoder in Batman.Association subclasses.&quot;</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">Association</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">Association</span><span class="p">.</span><span class="nx">belongsTo</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">belongsTo</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Association</span><span class="p">);</span>
    <span class="nx">belongsTo</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">associationType</span> <span class="o">=</span> <span class="s1">&#39;belongsTo&#39;</span><span class="p">;</span>
    <span class="nx">belongsTo</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">defaultOptions</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">saveInline</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="nx">autoload</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">};</span>
    <span class="kd">function</span> <span class="nx">belongsTo</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">belongsTo</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">encode</span><span class="p">(</span><span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">label</span> <span class="o">+</span> <span class="s2">&quot;_id&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">belongsTo</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getAccessor</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">self</span><span class="p">,</span> <span class="nx">model</span><span class="p">,</span> <span class="nx">label</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">loadedRecord</span><span class="p">,</span> <span class="nx">relatedID</span><span class="p">,</span> <span class="nx">relatedModel</span><span class="p">,</span> <span class="nx">relatedRecord</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">relatedRecord</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">getFromAttributes</span><span class="p">(</span><span class="k">this</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">relatedRecord</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">relatedID</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="nx">label</span> <span class="o">+</span> <span class="s2">&quot;_id&quot;</span><span class="p">)))</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">relatedModel</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">getRelatedModel</span><span class="p">()))</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">loadedRecord</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">setIndex</span><span class="p">().</span><span class="nx">get</span><span class="p">(</span><span class="nx">relatedID</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">loadedRecord</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">loadedRecord</span><span class="p">.</span><span class="nx">toArray</span><span class="p">()[</span><span class="mi">0</span><span class="p">];</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">autoload</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">relatedModel</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">relatedID</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">loadedRecord</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">throw</span> <span class="nx">error</span><span class="p">;</span>
            <span class="p">}</span>
          <span class="p">});</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">return</span> <span class="k">new</span> <span class="nx">relatedModel</span><span class="p">(</span><span class="nx">relatedID</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">belongsTo</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">encoder</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">association</span><span class="p">;</span>
      <span class="nx">association</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="k">return</span> <span class="p">{</span>
        <span class="nx">encode</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">association</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">saveInline</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="k">return</span> <span class="nx">val</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">();</span>
        <span class="p">},</span>
        <span class="nx">decode</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">record</span><span class="p">;</span>
          <span class="nx">record</span> <span class="o">=</span> <span class="k">new</span> <span class="p">(</span><span class="nx">association</span><span class="p">.</span><span class="nx">getRelatedModel</span><span class="p">())();</span>
          <span class="nx">record</span><span class="p">.</span><span class="nx">fromJSON</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
          <span class="k">return</span> <span class="nx">record</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">};</span>
    <span class="p">};</span>
    <span class="nx">belongsTo</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">apply</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">base</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">model</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">model</span> <span class="o">=</span> <span class="nx">base</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">label</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">base</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">label</span> <span class="o">+</span> <span class="s2">&quot;_id&quot;</span><span class="p">,</span> <span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">));</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">belongsTo</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">Association</span><span class="p">.</span><span class="nx">hasOne</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">hasOne</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Association</span><span class="p">);</span>
    <span class="nx">hasOne</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">associationType</span> <span class="o">=</span> <span class="s1">&#39;hasOne&#39;</span><span class="p">;</span>
    <span class="kd">function</span> <span class="nx">hasOne</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">hasOne</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">propertyName</span> <span class="o">=</span> <span class="nx">$functionName</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">foreignKey</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">underscore</span><span class="p">(</span><span class="nx">$functionName</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">)))</span> <span class="o">+</span> <span class="s2">&quot;_id&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">hasOne</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getAccessor</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">self</span><span class="p">,</span> <span class="nx">model</span><span class="p">,</span> <span class="nx">label</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">existingInstance</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">loadingRecord</span><span class="p">,</span> <span class="nx">relatedModel</span><span class="p">,</span> <span class="nx">relatedRecords</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">amSetting</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">existingInstance</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">getFromAttributes</span><span class="p">(</span><span class="k">this</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">existingInstance</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">relatedModel</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">getRelatedModel</span><span class="p">()))</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">id</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)))</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">relatedRecords</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">setIndex</span><span class="p">().</span><span class="nx">get</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">relatedRecords</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">relatedRecords</span><span class="p">.</span><span class="nx">toArray</span><span class="p">()[</span><span class="mi">0</span><span class="p">];</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">loadingRecord</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">relatedModel</span><span class="p">;</span>
        <span class="nx">loadingRecord</span><span class="p">.</span><span class="nx">load</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">loadOptions</span><span class="p">;</span>
          <span class="nx">loadOptions</span> <span class="o">=</span> <span class="p">{};</span>
          <span class="nx">loadOptions</span><span class="p">[</span><span class="nx">self</span><span class="p">.</span><span class="nx">foreignKey</span><span class="p">]</span> <span class="o">=</span> <span class="nx">id</span><span class="p">;</span>
          <span class="k">return</span> <span class="nx">relatedModel</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">loadOptions</span><span class="p">,</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">loadedRecords</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">loadedRecords</span> <span class="o">||</span> <span class="nx">loadedRecords</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t find related record!&quot;</span><span class="p">));</span>
              <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">fromJSON</span><span class="p">(</span><span class="nx">loadedRecords</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">toJSON</span><span class="p">());</span>
              <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="k">void</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">loadedRecords</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
          <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
        <span class="p">};</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">amSetting</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">label</span><span class="p">,</span> <span class="nx">loadingRecord</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">amSetting</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">autoload</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">loadingRecord</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{});</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">loadingRecord</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">hasOne</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">apply</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">baseSaveError</span><span class="p">,</span> <span class="nx">base</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">relation</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">relation</span> <span class="o">=</span> <span class="nx">base</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">defaultAccessor</span><span class="p">.</span><span class="nx">get</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">base</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">label</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">relation</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">foreignKey</span><span class="p">,</span> <span class="nx">base</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">));</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">hasOne</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">encoder</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">association</span><span class="p">;</span>
      <span class="nx">association</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="k">return</span> <span class="p">{</span>
        <span class="nx">encode</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">val</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">object</span><span class="p">,</span> <span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">json</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">association</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">saveInline</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="nx">json</span> <span class="o">=</span> <span class="nx">val</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">();</span>
          <span class="nx">json</span><span class="p">[</span><span class="nx">association</span><span class="p">.</span><span class="nx">foreignKey</span><span class="p">]</span> <span class="o">=</span> <span class="nx">record</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">);</span>
          <span class="k">return</span> <span class="nx">json</span><span class="p">;</span>
        <span class="p">},</span>
        <span class="nx">decode</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">record</span><span class="p">;</span>
          <span class="nx">record</span> <span class="o">=</span> <span class="k">new</span> <span class="p">(</span><span class="nx">association</span><span class="p">.</span><span class="nx">getRelatedModel</span><span class="p">())();</span>
          <span class="nx">record</span><span class="p">.</span><span class="nx">fromJSON</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
          <span class="k">return</span> <span class="nx">record</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">};</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">hasOne</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">Association</span><span class="p">.</span><span class="nx">hasMany</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">hasMany</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Association</span><span class="p">);</span>
    <span class="nx">hasMany</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">associationType</span> <span class="o">=</span> <span class="s1">&#39;hasMany&#39;</span><span class="p">;</span>
    <span class="kd">function</span> <span class="nx">hasMany</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">hasMany</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">propertyName</span> <span class="o">=</span> <span class="nx">$functionName</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">foreignKey</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">underscore</span><span class="p">(</span><span class="nx">$functionName</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">)))</span> <span class="o">+</span> <span class="s2">&quot;_id&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">hasMany</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getAccessor</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">self</span><span class="p">,</span> <span class="nx">model</span><span class="p">,</span> <span class="nx">label</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">recordInAttributes</span><span class="p">,</span> <span class="nx">relatedModel</span><span class="p">,</span> <span class="nx">relatedRecords</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">amSetting</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">relatedModel</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">getRelatedModel</span><span class="p">()))</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">recordInAttributes</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">getFromAttributes</span><span class="p">(</span><span class="k">this</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">recordInAttributes</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">id</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)))</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">relatedRecords</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">setIndex</span><span class="p">().</span><span class="nx">get</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">amSetting</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">label</span><span class="p">,</span> <span class="nx">relatedRecords</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">amSetting</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">autoload</span> <span class="o">&amp;&amp;</span> <span class="nx">relatedRecords</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">())</span> <span class="p">{</span>
        <span class="nx">relatedRecords</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">records</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="nx">error</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">});</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">relatedRecords</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">hasMany</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">apply</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">baseSaveError</span><span class="p">,</span> <span class="nx">base</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">relations</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">relations</span> <span class="o">=</span> <span class="nx">base</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">defaultAccessor</span><span class="p">.</span><span class="nx">get</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">base</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">label</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">relations</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">model</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">model</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">foreignKey</span><span class="p">,</span> <span class="nx">base</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">));</span>
        <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">hasMany</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">encoder</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">association</span><span class="p">;</span>
      <span class="nx">association</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="k">return</span> <span class="p">{</span>
        <span class="nx">encode</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">relationSet</span><span class="p">,</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">jsonArray</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">association</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">saveInline</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">relationSet</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">jsonArray</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="nx">relationSet</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">relation</span><span class="p">)</span> <span class="p">{</span>
              <span class="kd">var</span> <span class="nx">relationJSON</span><span class="p">;</span>
              <span class="nx">relationJSON</span> <span class="o">=</span> <span class="nx">relation</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">();</span>
              <span class="nx">relationJSON</span><span class="p">[</span><span class="nx">association</span><span class="p">.</span><span class="nx">foreignKey</span><span class="p">]</span> <span class="o">=</span> <span class="nx">record</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">);</span>
              <span class="k">return</span> <span class="nx">jsonArray</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">relationJSON</span><span class="p">);</span>
            <span class="p">});</span>
          <span class="p">}</span>
          <span class="k">return</span> <span class="nx">jsonArray</span><span class="p">;</span>
        <span class="p">},</span>
        <span class="nx">decode</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">jsonObject</span><span class="p">,</span> <span class="nx">record</span><span class="p">,</span> <span class="nx">relatedModel</span><span class="p">,</span> <span class="nx">relations</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">;</span>
          <span class="nx">relations</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Set</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">relatedModel</span> <span class="o">=</span> <span class="nx">association</span><span class="p">.</span><span class="nx">getRelatedModel</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">jsonObject</span> <span class="o">=</span> <span class="nx">data</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
              <span class="nx">record</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">relatedModel</span><span class="p">(</span><span class="nx">jsonObject</span><span class="p">);</span>
              <span class="nx">record</span> <span class="o">=</span> <span class="nx">relatedModel</span><span class="p">.</span><span class="nx">_mapIdentity</span><span class="p">(</span><span class="nx">record</span><span class="p">);</span>
              <span class="nx">relations</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">record</span><span class="p">);</span>
            <span class="p">}</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">developer</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;Can&#39;t decode model &quot;</span> <span class="o">+</span> <span class="nx">association</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">&quot; because it hasn&#39;t been loaded yet!&quot;</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">return</span> <span class="nx">relations</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">};</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">hasMany</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">Association</span><span class="p">.</span><span class="nx">Set</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">Set</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Set</span><span class="p">);</span>
    <span class="kd">function</span> <span class="nx">Set</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">association</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">key</span> <span class="o">=</span> <span class="nx">key</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">association</span> <span class="o">=</span> <span class="nx">association</span><span class="p">;</span>
      <span class="nx">Set</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">Set</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">load</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">loadOptions</span><span class="p">;</span>
      <span class="nx">loadOptions</span> <span class="o">=</span> <span class="p">{};</span>
      <span class="nx">loadOptions</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">association</span><span class="p">.</span><span class="nx">foreignKey</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">key</span><span class="p">;</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">association</span><span class="p">.</span><span class="nx">getRelatedModel</span><span class="p">().</span><span class="nx">load</span><span class="p">(</span><span class="nx">loadOptions</span><span class="p">,</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
      <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">Set</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">ValidationError</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">ValidationError</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nb">Object</span><span class="p">);</span>
    <span class="kd">function</span> <span class="nx">ValidationError</span><span class="p">(</span><span class="nx">attribute</span><span class="p">,</span> <span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">ValidationError</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">attribute</span><span class="o">:</span> <span class="nx">attribute</span><span class="p">,</span>
        <span class="nx">message</span><span class="o">:</span> <span class="nx">message</span>
      <span class="p">});</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">ValidationError</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">ErrorsSet</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">ErrorsSet</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Set</span><span class="p">);</span>
    <span class="kd">function</span> <span class="nx">ErrorsSet</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">ErrorsSet</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">ErrorsSet</span><span class="p">.</span><span class="nx">accessor</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">indexedBy</span><span class="p">(</span><span class="s1">&#39;attribute&#39;</span><span class="p">).</span><span class="nx">get</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="nx">ErrorsSet</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">add</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">ErrorsSet</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">add</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">ValidationError</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">error</span><span class="p">));</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">ErrorsSet</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">Validator</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">Validator</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nb">Object</span><span class="p">);</span>
    <span class="kd">function</span> <span class="nx">Validator</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">mixins</span><span class="p">,</span> <span class="nx">options</span><span class="p">;</span>
      <span class="nx">options</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">mixins</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">&lt;=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">:</span> <span class="p">[];</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span><span class="p">;</span>
      <span class="nx">Validator</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">mixins</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">Validator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">validate</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">developer</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;You must override validate in Batman.Validator subclasses.&quot;</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">Validator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">format</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">messageKey</span><span class="p">,</span> <span class="nx">interpolations</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;errors.format&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">attribute</span><span class="o">:</span> <span class="nx">key</span><span class="p">,</span>
        <span class="nx">message</span><span class="o">:</span> <span class="nx">t</span><span class="p">(</span><span class="s2">&quot;errors.messages.&quot;</span> <span class="o">+</span> <span class="nx">messageKey</span><span class="p">,</span> <span class="nx">interpolations</span><span class="p">)</span>
      <span class="p">});</span>
    <span class="p">};</span>
    <span class="nx">Validator</span><span class="p">.</span><span class="nx">options</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">options</span><span class="p">;</span>
      <span class="nx">options</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="p">[];</span>
      <span class="nx">Batman</span><span class="p">.</span><span class="nx">initializeObject</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_batman</span><span class="p">.</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_batman</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_batman</span><span class="p">.</span><span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">Validator</span><span class="p">.</span><span class="nx">matches</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">results</span><span class="p">,</span> <span class="nx">shouldReturn</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">,</span> <span class="nx">_ref2</span><span class="p">;</span>
      <span class="nx">results</span> <span class="o">=</span> <span class="p">{};</span>
      <span class="nx">shouldReturn</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">key</span> <span class="k">in</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">value</span> <span class="o">=</span> <span class="nx">options</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">~</span><span class="p">((</span><span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_batman</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="p">(</span><span class="nx">_ref2</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">options</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">_ref2</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
          <span class="nx">results</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
          <span class="nx">shouldReturn</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">shouldReturn</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">results</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">Validator</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Validators</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Validators</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nx">Batman</span><span class="p">.</span><span class="nx">LengthValidator</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">__extends</span><span class="p">(</span><span class="nx">LengthValidator</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Validator</span><span class="p">);</span>
      <span class="nx">LengthValidator</span><span class="p">.</span><span class="nx">options</span><span class="p">(</span><span class="s1">&#39;minLength&#39;</span><span class="p">,</span> <span class="s1">&#39;maxLength&#39;</span><span class="p">,</span> <span class="s1">&#39;length&#39;</span><span class="p">,</span> <span class="s1">&#39;lengthWithin&#39;</span><span class="p">,</span> <span class="s1">&#39;lengthIn&#39;</span><span class="p">);</span>
      <span class="kd">function</span> <span class="nx">LengthValidator</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">range</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">range</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">lengthIn</span> <span class="o">||</span> <span class="nx">options</span><span class="p">.</span><span class="nx">lengthWithin</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">options</span><span class="p">.</span><span class="nx">minLength</span> <span class="o">=</span> <span class="nx">range</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
          <span class="nx">options</span><span class="p">.</span><span class="nx">maxLength</span> <span class="o">=</span> <span class="nx">range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">||</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
          <span class="k">delete</span> <span class="nx">options</span><span class="p">.</span><span class="nx">lengthWithin</span><span class="p">;</span>
          <span class="k">delete</span> <span class="nx">options</span><span class="p">.</span><span class="nx">lengthIn</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">LengthValidator</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">LengthValidator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">validateEach</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">errors</span><span class="p">,</span> <span class="nx">record</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">value</span><span class="p">;</span>
        <span class="nx">options</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">;</span>
        <span class="nx">value</span> <span class="o">=</span> <span class="nx">record</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">minLength</span> <span class="o">&amp;&amp;</span> <span class="nx">value</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="nx">options</span><span class="p">.</span><span class="nx">minLength</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">errors</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="s1">&#39;too_short&#39;</span><span class="p">,</span> <span class="p">{</span>
            <span class="nx">count</span><span class="o">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">minLength</span>
          <span class="p">}));</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">maxLength</span> <span class="o">&amp;&amp;</span> <span class="nx">value</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="nx">options</span><span class="p">.</span><span class="nx">maxLength</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">errors</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="s1">&#39;too_long&#39;</span><span class="p">,</span> <span class="p">{</span>
            <span class="nx">count</span><span class="o">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">maxLength</span>
          <span class="p">}));</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">length</span> <span class="o">&amp;&amp;</span> <span class="nx">value</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="nx">options</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">errors</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="s1">&#39;wrong_length&#39;</span><span class="p">,</span> <span class="p">{</span>
            <span class="nx">count</span><span class="o">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">length</span>
          <span class="p">}));</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">callback</span><span class="p">();</span>
      <span class="p">};</span>
      <span class="k">return</span> <span class="nx">LengthValidator</span><span class="p">;</span>
    <span class="p">})(),</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">PresenceValidator</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">__extends</span><span class="p">(</span><span class="nx">PresenceValidator</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Validator</span><span class="p">);</span>
      <span class="kd">function</span> <span class="nx">PresenceValidator</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">PresenceValidator</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">PresenceValidator</span><span class="p">.</span><span class="nx">options</span><span class="p">(</span><span class="s1">&#39;presence&#39;</span><span class="p">);</span>
      <span class="nx">PresenceValidator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">validateEach</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">errors</span><span class="p">,</span> <span class="nx">record</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">value</span><span class="p">;</span>
        <span class="nx">value</span> <span class="o">=</span> <span class="nx">record</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">presence</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="nx">value</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">))</span> <span class="p">{</span>
          <span class="nx">errors</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="s1">&#39;blank&#39;</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">callback</span><span class="p">();</span>
      <span class="p">};</span>
      <span class="k">return</span> <span class="nx">PresenceValidator</span><span class="p">;</span>
    <span class="p">})()</span>
  <span class="p">];</span>
  <span class="nx">$mixin</span><span class="p">(</span><span class="nx">Batman</span><span class="p">.</span><span class="nx">translate</span><span class="p">.</span><span class="nx">messages</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">errors</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">format</span><span class="o">:</span> <span class="s2">&quot;%{attribute} %{message}&quot;</span><span class="p">,</span>
      <span class="nx">messages</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">too_short</span><span class="o">:</span> <span class="s2">&quot;must be at least %{count} characters&quot;</span><span class="p">,</span>
        <span class="nx">too_long</span><span class="o">:</span> <span class="s2">&quot;must be less than %{count} characters&quot;</span><span class="p">,</span>
        <span class="nx">wrong_length</span><span class="o">:</span> <span class="s2">&quot;must be %{count} characters&quot;</span><span class="p">,</span>
        <span class="nx">blank</span><span class="o">:</span> <span class="s2">&quot;can&#39;t be blank&quot;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">});</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">StorageAdapter</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">time</span><span class="p">,</span> <span class="nx">_fn</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_j</span><span class="p">,</span> <span class="nx">_len</span><span class="p">,</span> <span class="nx">_len2</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">,</span> <span class="nx">_ref2</span><span class="p">;</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">StorageAdapter</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nb">Object</span><span class="p">);</span>
    <span class="kd">function</span> <span class="nx">StorageAdapter</span><span class="p">(</span><span class="nx">model</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">StorageAdapter</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">model</span><span class="o">:</span> <span class="nx">model</span>
      <span class="p">});</span>
    <span class="p">}</span>
    <span class="nx">StorageAdapter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">isStorageAdapter</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nx">StorageAdapter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">modelKey</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">model</span><span class="p">;</span>
      <span class="nx">model</span> <span class="o">=</span> <span class="p">(</span><span class="nx">record</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">record</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">;</span>
      <span class="k">return</span> <span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;storageKey&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="nx">helpers</span><span class="p">.</span><span class="nx">pluralize</span><span class="p">(</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">underscore</span><span class="p">(</span><span class="nx">$functionName</span><span class="p">(</span><span class="nx">model</span><span class="p">)));</span>
    <span class="p">};</span>
    <span class="nx">StorageAdapter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_batman</span><span class="p">.</span><span class="nx">check</span><span class="p">(</span><span class="nx">StorageAdapter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">);</span>
    <span class="nx">_ref</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="s1">&#39;read&#39;</span><span class="p">,</span> <span class="s1">&#39;readAll&#39;</span><span class="p">,</span> <span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="s1">&#39;destroy&#39;</span><span class="p">];</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">k</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
      <span class="nx">_ref2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;before&#39;</span><span class="p">,</span> <span class="s1">&#39;after&#39;</span><span class="p">];</span>
      <span class="nx">_fn</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="nx">time</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">key</span><span class="p">;</span>
        <span class="nx">key</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="nx">time</span> <span class="o">+</span> <span class="p">(</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">capitalize</span><span class="p">(</span><span class="nx">k</span><span class="p">));</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">prototype</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">filter</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">_base</span><span class="p">,</span> <span class="nx">_name</span><span class="p">;</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">_batman</span><span class="p">.</span><span class="nx">check</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
          <span class="k">return</span> <span class="p">((</span><span class="nx">_base</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_batman</span><span class="p">)[</span><span class="nx">_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="nx">key</span> <span class="o">+</span> <span class="s2">&quot;Filters&quot;</span><span class="p">]</span> <span class="o">||</span> <span class="p">(</span><span class="nx">_base</span><span class="p">[</span><span class="nx">_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[])).</span><span class="nx">push</span><span class="p">(</span><span class="nx">filter</span><span class="p">);</span>
        <span class="p">};</span>
      <span class="p">},</span> <span class="nx">StorageAdapter</span><span class="p">);</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">_j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len2</span> <span class="o">=</span> <span class="nx">_ref2</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_j</span> <span class="o">&lt;</span> <span class="nx">_len2</span><span class="p">;</span> <span class="nx">_j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">time</span> <span class="o">=</span> <span class="nx">_ref2</span><span class="p">[</span><span class="nx">_j</span><span class="p">];</span>
        <span class="nx">_fn</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="nx">time</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">StorageAdapter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">before</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">keys</span><span class="p">,</span> <span class="nx">_k</span><span class="p">,</span> <span class="nx">_l</span><span class="p">,</span> <span class="nx">_len3</span><span class="p">,</span> <span class="nx">_results</span><span class="p">;</span>
      <span class="nx">keys</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">&lt;=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_k</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">:</span> <span class="p">(</span><span class="nx">_k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[]),</span> <span class="nx">callback</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="nx">_k</span><span class="o">++</span><span class="p">];</span>
      <span class="nx">_results</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">_l</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len3</span> <span class="o">=</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_l</span> <span class="o">&lt;</span> <span class="nx">_len3</span><span class="p">;</span> <span class="nx">_l</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">k</span> <span class="o">=</span> <span class="nx">keys</span><span class="p">[</span><span class="nx">_l</span><span class="p">];</span>
        <span class="nx">_results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="s2">&quot;before&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">capitalize</span><span class="p">(</span><span class="nx">k</span><span class="p">))](</span><span class="nx">callback</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">_results</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">StorageAdapter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">after</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">keys</span><span class="p">,</span> <span class="nx">_k</span><span class="p">,</span> <span class="nx">_l</span><span class="p">,</span> <span class="nx">_len3</span><span class="p">,</span> <span class="nx">_results</span><span class="p">;</span>
      <span class="nx">keys</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">&lt;=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_k</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">:</span> <span class="p">(</span><span class="nx">_k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[]),</span> <span class="nx">callback</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="nx">_k</span><span class="o">++</span><span class="p">];</span>
      <span class="nx">_results</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">_l</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len3</span> <span class="o">=</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_l</span> <span class="o">&lt;</span> <span class="nx">_len3</span><span class="p">;</span> <span class="nx">_l</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">k</span> <span class="o">=</span> <span class="nx">keys</span><span class="p">[</span><span class="nx">_l</span><span class="p">];</span>
        <span class="nx">_results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="s2">&quot;after&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">capitalize</span><span class="p">(</span><span class="nx">k</span><span class="p">))](</span><span class="nx">callback</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">_results</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">StorageAdapter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_filterData</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">action</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">prefix</span><span class="p">;</span>
      <span class="nx">prefix</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">action</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">data</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">&lt;=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">:</span> <span class="p">[];</span>
      <span class="k">return</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_batman</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="nx">prefix</span> <span class="o">+</span> <span class="p">(</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">capitalize</span><span class="p">(</span><span class="nx">action</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;Filters&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="p">[]).</span><span class="nx">concat</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_batman</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="nx">prefix</span> <span class="o">+</span> <span class="s2">&quot;AllFilters&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="p">[]).</span><span class="nx">reduce</span><span class="p">(</span><span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">filteredData</span><span class="p">,</span> <span class="nx">filter</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">filter</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">filteredData</span><span class="p">);</span>
      <span class="p">},</span> <span class="k">this</span><span class="p">),</span> <span class="nx">data</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">StorageAdapter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getRecordFromData</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">record</span><span class="p">;</span>
      <span class="nx">record</span> <span class="o">=</span> <span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">();</span>
      <span class="nx">record</span><span class="p">.</span><span class="nx">fromJSON</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">record</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">StorageAdapter</span><span class="p">;</span>
  <span class="p">}).</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  <span class="nx">$passError</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">filterables</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">err</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">filterables</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">filterables</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">err</span> <span class="o">=</span> <span class="nx">filterables</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
        <span class="nx">filterables</span> <span class="o">=</span> <span class="nx">f</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">filterables</span><span class="p">);</span>
        <span class="nx">filterables</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">filterables</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">};</span>
  <span class="p">};</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">LocalStorage</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">LocalStorage</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">StorageAdapter</span><span class="p">);</span>
    <span class="kd">function</span> <span class="nx">LocalStorage</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">LocalStorage</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">storage</span> <span class="o">=</span> <span class="nx">localStorage</span><span class="p">;</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">LocalStorage</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">storageRegExp</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;^&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">modelKey</span><span class="p">(</span><span class="nx">record</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;(\\d+)$&quot;</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">LocalStorage</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">idForRecord</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">nextId</span><span class="p">,</span> <span class="nx">re</span><span class="p">;</span>
      <span class="nx">re</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">storageRegExp</span><span class="p">(</span><span class="nx">record</span><span class="p">);</span>
      <span class="nx">nextId</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_forAllRecords</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">matches</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">matches</span> <span class="o">=</span> <span class="nx">re</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">k</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">nextId</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">nextId</span><span class="p">,</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">matches</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">});</span>
      <span class="k">return</span> <span class="nx">nextId</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">LocalStorage</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">before</span><span class="p">(</span><span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="nx">$passError</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">_arg</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">record</span><span class="p">;</span>
      <span class="nx">record</span> <span class="o">=</span> <span class="nx">_arg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">options</span> <span class="o">=</span> <span class="nx">_arg</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
      <span class="k">return</span> <span class="p">[</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">record</span><span class="p">),</span> <span class="nx">options</span><span class="p">];</span>
    <span class="p">}));</span>
    <span class="nx">LocalStorage</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">after</span><span class="p">(</span><span class="s1">&#39;read&#39;</span><span class="p">,</span> <span class="nx">$passError</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">_arg</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">attributes</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">record</span><span class="p">;</span>
      <span class="nx">record</span> <span class="o">=</span> <span class="nx">_arg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">attributes</span> <span class="o">=</span> <span class="nx">_arg</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">options</span> <span class="o">=</span> <span class="nx">_arg</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
      <span class="k">return</span> <span class="p">[</span><span class="nx">record</span><span class="p">.</span><span class="nx">fromJSON</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">attributes</span><span class="p">)),</span> <span class="nx">attributes</span><span class="p">,</span> <span class="nx">options</span><span class="p">];</span>
    <span class="p">}));</span>
    <span class="nx">LocalStorage</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_forAllRecords</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">,</span> <span class="nx">_results</span><span class="p">;</span>
      <span class="nx">_results</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">storage</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="nx">_ref</span> <span class="o">?</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">_ref</span> <span class="o">:</span> <span class="nx">i</span> <span class="o">&gt;</span> <span class="nx">_ref</span><span class="p">;</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="nx">_ref</span> <span class="o">?</span> <span class="nx">i</span><span class="o">++</span> <span class="o">:</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">k</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">storage</span><span class="p">.</span><span class="nx">key</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
        <span class="nx">_results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">f</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">k</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">storage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="nx">k</span><span class="p">)));</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">_results</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">LocalStorage</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getRecordFromData</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">record</span><span class="p">;</span>
      <span class="nx">record</span> <span class="o">=</span> <span class="nx">LocalStorage</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">getRecordFromData</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">nextId</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">nextId</span><span class="p">,</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">record</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">),</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">record</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">LocalStorage</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">update</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">record</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">recordToSave</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">;</span>
      <span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_filterData</span><span class="p">(</span><span class="s1">&#39;before&#39;</span><span class="p">,</span> <span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="k">void</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">record</span><span class="p">,</span> <span class="nx">options</span><span class="p">),</span> <span class="nx">err</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">recordToSave</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">id</span> <span class="o">=</span> <span class="nx">record</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">id</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">storage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">modelKey</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="o">+</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">recordToSave</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">err</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t get record primary key.&quot;</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">callback</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_filterData</span><span class="p">(</span><span class="s1">&#39;after&#39;</span><span class="p">,</span> <span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">record</span><span class="p">,</span> <span class="nx">options</span><span class="p">));</span>
    <span class="p">};</span>
    <span class="nx">LocalStorage</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">create</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">record</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">recordToSave</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">;</span>
      <span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_filterData</span><span class="p">(</span><span class="s1">&#39;before&#39;</span><span class="p">,</span> <span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="k">void</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">record</span><span class="p">,</span> <span class="nx">options</span><span class="p">),</span> <span class="nx">err</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">recordToSave</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">id</span> <span class="o">=</span> <span class="nx">record</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="nx">record</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">idForRecord</span><span class="p">(</span><span class="nx">record</span><span class="p">));</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">id</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">key</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">modelKey</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="o">+</span> <span class="nx">id</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">storage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="nx">key</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">err</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Can&#39;t create because the record already exists!&quot;</span><span class="p">);</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">storage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">recordToSave</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">err</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t set record primary key on create!&quot;</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">callback</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_filterData</span><span class="p">(</span><span class="s1">&#39;after&#39;</span><span class="p">,</span> <span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">record</span><span class="p">,</span> <span class="nx">options</span><span class="p">));</span>
    <span class="p">};</span>
    <span class="nx">LocalStorage</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">read</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">record</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">attrs</span><span class="p">,</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">;</span>
      <span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_filterData</span><span class="p">(</span><span class="s1">&#39;before&#39;</span><span class="p">,</span> <span class="s1">&#39;read&#39;</span><span class="p">,</span> <span class="k">void</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">record</span><span class="p">,</span> <span class="nx">options</span><span class="p">),</span> <span class="nx">err</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">record</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
      <span class="nx">id</span> <span class="o">=</span> <span class="nx">record</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">id</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">attrs</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">storage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">modelKey</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="o">+</span> <span class="nx">id</span><span class="p">);</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">attrs</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">err</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t find record!&quot;</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">err</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t get record primary key.&quot;</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">callback</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_filterData</span><span class="p">(</span><span class="s1">&#39;after&#39;</span><span class="p">,</span> <span class="s1">&#39;read&#39;</span><span class="p">,</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">record</span><span class="p">,</span> <span class="nx">attrs</span><span class="p">,</span> <span class="nx">options</span><span class="p">));</span>
    <span class="p">};</span>
    <span class="nx">LocalStorage</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">readAll</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">proto</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">re</span><span class="p">,</span> <span class="nx">records</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">;</span>
      <span class="nx">records</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_filterData</span><span class="p">(</span><span class="s1">&#39;before&#39;</span><span class="p">,</span> <span class="s1">&#39;readAll&#39;</span><span class="p">,</span> <span class="k">void</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">options</span><span class="p">),</span> <span class="nx">err</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">options</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">re</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">storageRegExp</span><span class="p">(</span><span class="nx">proto</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_forAllRecords</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">storageKey</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">keyMatches</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">keyMatches</span> <span class="o">=</span> <span class="nx">re</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">storageKey</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">records</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
              <span class="nx">data</span><span class="o">:</span> <span class="nx">data</span><span class="p">,</span>
              <span class="nx">id</span><span class="o">:</span> <span class="nx">keyMatches</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="p">});</span>
          <span class="p">}</span>
        <span class="p">});</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">callback</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_filterData</span><span class="p">(</span><span class="s1">&#39;after&#39;</span><span class="p">,</span> <span class="s1">&#39;readAll&#39;</span><span class="p">,</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">records</span><span class="p">,</span> <span class="nx">options</span><span class="p">));</span>
    <span class="p">};</span>
    <span class="nx">LocalStorage</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">after</span><span class="p">(</span><span class="s1">&#39;readAll&#39;</span><span class="p">,</span> <span class="nx">$passError</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">_arg</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">allAttributes</span><span class="p">,</span> <span class="nx">attributes</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">options</span><span class="p">;</span>
      <span class="nx">allAttributes</span> <span class="o">=</span> <span class="nx">_arg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">options</span> <span class="o">=</span> <span class="nx">_arg</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
      <span class="nx">allAttributes</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">,</span> <span class="nx">_name</span><span class="p">,</span> <span class="nx">_results</span><span class="p">;</span>
        <span class="nx">_results</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">allAttributes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">attributes</span> <span class="o">=</span> <span class="nx">allAttributes</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
          <span class="nx">data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
          <span class="nx">data</span><span class="p">[</span><span class="nx">_name</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">primaryKey</span><span class="p">]</span> <span class="o">||</span> <span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nx">_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="mi">10</span><span class="p">));</span>
          <span class="nx">_results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">_results</span><span class="p">;</span>
      <span class="p">}).</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="k">return</span> <span class="p">[</span><span class="nx">allAttributes</span><span class="p">,</span> <span class="nx">options</span><span class="p">];</span>
    <span class="p">}));</span>
    <span class="nx">LocalStorage</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">after</span><span class="p">(</span><span class="s1">&#39;readAll&#39;</span><span class="p">,</span> <span class="nx">$passError</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">_arg</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">allAttributes</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">matches</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">v</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">;</span>
      <span class="nx">allAttributes</span> <span class="o">=</span> <span class="nx">_arg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">options</span> <span class="o">=</span> <span class="nx">_arg</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
      <span class="nx">matches</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">allAttributes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">data</span> <span class="o">=</span> <span class="nx">allAttributes</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
        <span class="nx">match</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="k">in</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">v</span> <span class="o">=</span> <span class="nx">options</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">!==</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">match</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">matches</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="p">[</span><span class="nx">matches</span><span class="p">,</span> <span class="nx">options</span><span class="p">];</span>
    <span class="p">}));</span>
    <span class="nx">LocalStorage</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">after</span><span class="p">(</span><span class="s1">&#39;readAll&#39;</span><span class="p">,</span> <span class="nx">$passError</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">_arg</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">filteredAttributes</span><span class="p">,</span> <span class="nx">options</span><span class="p">;</span>
      <span class="nx">filteredAttributes</span> <span class="o">=</span> <span class="nx">_arg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">options</span> <span class="o">=</span> <span class="nx">_arg</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
      <span class="k">return</span> <span class="p">[</span>
        <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">,</span> <span class="nx">_results</span><span class="p">;</span>
          <span class="nx">_results</span> <span class="o">=</span> <span class="p">[];</span>
          <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">filteredAttributes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">data</span> <span class="o">=</span> <span class="nx">filteredAttributes</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
            <span class="nx">_results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getRecordFromData</span><span class="p">(</span><span class="nx">data</span><span class="p">));</span>
          <span class="p">}</span>
          <span class="k">return</span> <span class="nx">_results</span><span class="p">;</span>
        <span class="p">}).</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="nx">filteredAttributes</span><span class="p">,</span> <span class="nx">options</span>
      <span class="p">];</span>
    <span class="p">}));</span>
    <span class="nx">LocalStorage</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">destroy</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">record</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">;</span>
      <span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_filterData</span><span class="p">(</span><span class="s1">&#39;before&#39;</span><span class="p">,</span> <span class="s1">&#39;destroy&#39;</span><span class="p">,</span> <span class="k">void</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">record</span><span class="p">,</span> <span class="nx">options</span><span class="p">),</span> <span class="nx">err</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">record</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">id</span> <span class="o">=</span> <span class="nx">record</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">id</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">key</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">modelKey</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="o">+</span> <span class="nx">id</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">storage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="nx">key</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">storage</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">err</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Can&#39;t delete nonexistant record!&quot;</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">err</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Can&#39;t delete record without an primary key!&quot;</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">callback</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_filterData</span><span class="p">(</span><span class="s1">&#39;after&#39;</span><span class="p">,</span> <span class="s1">&#39;destroy&#39;</span><span class="p">,</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">record</span><span class="p">,</span> <span class="nx">options</span><span class="p">));</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">LocalStorage</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">RestStorage</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">RestStorage</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">StorageAdapter</span><span class="p">);</span>
    <span class="nx">RestStorage</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">defaultOptions</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;json&#39;</span>
    <span class="p">};</span>
    <span class="nx">RestStorage</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">recordJsonNamespace</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">RestStorage</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">collectionJsonNamespace</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">RestStorage</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">serializeAsForm</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="kd">function</span> <span class="nx">RestStorage</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">RestStorage</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">defaultOptions</span> <span class="o">=</span> <span class="nx">$mixin</span><span class="p">({},</span> <span class="k">this</span><span class="p">.</span><span class="nx">defaultOptions</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">RestStorage</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">recordJsonNamespace</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">helpers</span><span class="p">.</span><span class="nx">singularize</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">modelKey</span><span class="p">(</span><span class="nx">record</span><span class="p">));</span>
    <span class="p">};</span>
    <span class="nx">RestStorage</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">collectionJsonNamespace</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">proto</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">helpers</span><span class="p">.</span><span class="nx">pluralize</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">modelKey</span><span class="p">(</span><span class="nx">proto</span><span class="p">));</span>
    <span class="p">};</span>
    <span class="nx">RestStorage</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">before</span><span class="p">(</span><span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="nx">$passError</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">_arg</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">json</span><span class="p">,</span> <span class="nx">namespace</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">record</span><span class="p">,</span> <span class="nx">x</span><span class="p">;</span>
      <span class="nx">record</span> <span class="o">=</span> <span class="nx">_arg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">options</span> <span class="o">=</span> <span class="nx">_arg</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
      <span class="nx">json</span> <span class="o">=</span> <span class="nx">record</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">();</span>
      <span class="nx">record</span> <span class="o">=</span> <span class="p">(</span><span class="nx">namespace</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">recordJsonNamespace</span><span class="p">(</span><span class="nx">record</span><span class="p">))</span> <span class="o">?</span> <span class="p">(</span><span class="nx">x</span> <span class="o">=</span> <span class="p">{},</span> <span class="nx">x</span><span class="p">[</span><span class="nx">namespace</span><span class="p">]</span> <span class="o">=</span> <span class="nx">json</span><span class="p">,</span> <span class="nx">x</span><span class="p">)</span> <span class="o">:</span> <span class="nx">json</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">serializeAsForm</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">record</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">record</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="p">[</span><span class="nx">record</span><span class="p">,</span> <span class="nx">options</span><span class="p">];</span>
    <span class="p">}));</span>
    <span class="nx">RestStorage</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">after</span><span class="p">(</span><span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="s1">&#39;read&#39;</span><span class="p">,</span> <span class="s1">&#39;readAll&#39;</span><span class="p">,</span> <span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="s1">&#39;destroy&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">_arg</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">error</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">record</span><span class="p">;</span>
      <span class="nx">error</span> <span class="o">=</span> <span class="nx">_arg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">record</span> <span class="o">=</span> <span class="nx">_arg</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">_arg</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nx">options</span> <span class="o">=</span> <span class="nx">_arg</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">data</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">try</span> <span class="p">{</span>
            <span class="nx">data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
          <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">error</span> <span class="o">=</span> <span class="nx">e</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="p">[</span><span class="nx">error</span><span class="p">,</span> <span class="nx">record</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">options</span><span class="p">];</span>
    <span class="p">});</span>
    <span class="nx">RestStorage</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">after</span><span class="p">(</span><span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="s1">&#39;read&#39;</span><span class="p">,</span> <span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="nx">$passError</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">_arg</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">namespace</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">record</span><span class="p">;</span>
      <span class="nx">record</span> <span class="o">=</span> <span class="nx">_arg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">_arg</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">options</span> <span class="o">=</span> <span class="nx">_arg</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
      <span class="nx">namespace</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">recordJsonNamespace</span><span class="p">(</span><span class="nx">record</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">namespace</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nx">namespace</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">data</span> <span class="o">=</span> <span class="nx">data</span><span class="p">[</span><span class="nx">namespace</span><span class="p">];</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="p">[</span><span class="nx">record</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">options</span><span class="p">];</span>
    <span class="p">}));</span>
    <span class="nx">RestStorage</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">after</span><span class="p">(</span><span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="s1">&#39;read&#39;</span><span class="p">,</span> <span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="nx">$passError</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">_arg</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">record</span><span class="p">;</span>
      <span class="nx">record</span> <span class="o">=</span> <span class="nx">_arg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">_arg</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">options</span> <span class="o">=</span> <span class="nx">_arg</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
      <span class="nx">record</span><span class="p">.</span><span class="nx">fromJSON</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
      <span class="k">return</span> <span class="p">[</span><span class="nx">record</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">options</span><span class="p">];</span>
    <span class="p">}));</span>
    <span class="nx">RestStorage</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">optionsForRecord</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">record</span><span class="p">,</span> <span class="nx">recordOptions</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">url</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">record</span><span class="p">.</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">url</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">record</span><span class="p">.</span><span class="nx">url</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span> <span class="o">?</span> <span class="nx">record</span><span class="p">.</span><span class="nx">url</span><span class="p">(</span><span class="nx">recordOptions</span><span class="p">)</span> <span class="o">:</span> <span class="nx">record</span><span class="p">.</span><span class="nx">url</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">url</span> <span class="o">=</span> <span class="nx">record</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">url</span> <span class="o">?</span> <span class="k">typeof</span> <span class="nx">record</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">url</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span> <span class="o">?</span> <span class="nx">record</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">url</span><span class="p">(</span><span class="nx">recordOptions</span><span class="p">)</span> <span class="o">:</span> <span class="nx">record</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">url</span> <span class="o">:</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">modelKey</span><span class="p">(</span><span class="nx">record</span><span class="p">));</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">recordOptions</span><span class="p">.</span><span class="nx">idRequired</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">id</span> <span class="o">=</span> <span class="nx">record</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">);</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">id</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t get record primary key!&quot;</span><span class="p">));</span>
            <span class="k">return</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="nx">url</span> <span class="o">=</span> <span class="nx">url</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t get model url!&quot;</span><span class="p">));</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">void</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">$mixin</span><span class="p">({},</span> <span class="k">this</span><span class="p">.</span><span class="nx">defaultOptions</span><span class="p">,</span> <span class="p">{</span>
          <span class="nx">url</span><span class="o">:</span> <span class="nx">url</span>
        <span class="p">}));</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">RestStorage</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">optionsForCollection</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">model</span><span class="p">,</span> <span class="nx">recordsOptions</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">url</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">model</span><span class="p">.</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">url</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">model</span><span class="p">.</span><span class="nx">url</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span> <span class="o">?</span> <span class="nx">model</span><span class="p">.</span><span class="nx">url</span><span class="p">(</span><span class="nx">recordsOptions</span><span class="p">)</span> <span class="o">:</span> <span class="nx">model</span><span class="p">.</span><span class="nx">url</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">url</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">modelKey</span><span class="p">(</span><span class="nx">model</span><span class="p">.</span><span class="nx">prototype</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t get collection url!&quot;</span><span class="p">));</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">void</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">$mixin</span><span class="p">({},</span> <span class="k">this</span><span class="p">.</span><span class="nx">defaultOptions</span><span class="p">,</span> <span class="p">{</span>
          <span class="nx">url</span><span class="o">:</span> <span class="nx">url</span><span class="p">,</span>
          <span class="nx">data</span><span class="o">:</span> <span class="nx">$mixin</span><span class="p">({},</span> <span class="k">this</span><span class="p">.</span><span class="nx">defaultOptions</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="nx">recordsOptions</span><span class="p">)</span>
        <span class="p">}));</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">RestStorage</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">create</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">record</span><span class="p">,</span> <span class="nx">recordOptions</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">optionsForRecord</span><span class="p">(</span><span class="nx">record</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">idRequired</span><span class="o">:</span> <span class="kc">false</span>
      <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">;</span>
        <span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_filterData</span><span class="p">(</span><span class="s1">&#39;before&#39;</span><span class="p">,</span> <span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">record</span><span class="p">,</span> <span class="nx">recordOptions</span><span class="p">),</span> <span class="nx">err</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Request</span><span class="p">(</span><span class="nx">$mixin</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="p">{</span>
          <span class="nx">data</span><span class="o">:</span> <span class="nx">data</span><span class="p">,</span>
          <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
          <span class="nx">success</span><span class="o">:</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">callback</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_filterData</span><span class="p">(</span><span class="s1">&#39;after&#39;</span><span class="p">,</span> <span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="k">void</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">record</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">recordOptions</span><span class="p">));</span>
          <span class="p">},</span> <span class="k">this</span><span class="p">),</span>
          <span class="nx">error</span><span class="o">:</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">callback</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_filterData</span><span class="p">(</span><span class="s1">&#39;after&#39;</span><span class="p">,</span> <span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="nx">error</span><span class="p">,</span> <span class="nx">record</span><span class="p">,</span> <span class="nx">error</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;response&#39;</span><span class="p">),</span> <span class="nx">recordOptions</span><span class="p">));</span>
          <span class="p">},</span> <span class="k">this</span><span class="p">)</span>
        <span class="p">}));</span>
      <span class="p">});</span>
    <span class="p">};</span>
    <span class="nx">RestStorage</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">update</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">record</span><span class="p">,</span> <span class="nx">recordOptions</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">optionsForRecord</span><span class="p">(</span><span class="nx">record</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">idRequired</span><span class="o">:</span> <span class="kc">true</span>
      <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">;</span>
        <span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_filterData</span><span class="p">(</span><span class="s1">&#39;before&#39;</span><span class="p">,</span> <span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">record</span><span class="p">,</span> <span class="nx">recordOptions</span><span class="p">),</span> <span class="nx">err</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Request</span><span class="p">(</span><span class="nx">$mixin</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="p">{</span>
          <span class="nx">data</span><span class="o">:</span> <span class="nx">data</span><span class="p">,</span>
          <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;PUT&#39;</span><span class="p">,</span>
          <span class="nx">success</span><span class="o">:</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">callback</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_filterData</span><span class="p">(</span><span class="s1">&#39;after&#39;</span><span class="p">,</span> <span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="k">void</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">record</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">recordOptions</span><span class="p">));</span>
          <span class="p">},</span> <span class="k">this</span><span class="p">),</span>
          <span class="nx">error</span><span class="o">:</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">callback</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_filterData</span><span class="p">(</span><span class="s1">&#39;after&#39;</span><span class="p">,</span> <span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="nx">error</span><span class="p">,</span> <span class="nx">record</span><span class="p">,</span> <span class="nx">error</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;response&#39;</span><span class="p">),</span> <span class="nx">recordOptions</span><span class="p">));</span>
          <span class="p">},</span> <span class="k">this</span><span class="p">)</span>
        <span class="p">}));</span>
      <span class="p">});</span>
    <span class="p">};</span>
    <span class="nx">RestStorage</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">read</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">record</span><span class="p">,</span> <span class="nx">recordOptions</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">optionsForRecord</span><span class="p">(</span><span class="nx">record</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">idRequired</span><span class="o">:</span> <span class="kc">true</span>
      <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">_ref</span><span class="p">;</span>
        <span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_filterData</span><span class="p">(</span><span class="s1">&#39;before&#39;</span><span class="p">,</span> <span class="s1">&#39;read&#39;</span><span class="p">,</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">record</span><span class="p">,</span> <span class="nx">recordOptions</span><span class="p">),</span> <span class="nx">err</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">record</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">recordOptions</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Request</span><span class="p">(</span><span class="nx">$mixin</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="p">{</span>
          <span class="nx">data</span><span class="o">:</span> <span class="nx">recordOptions</span><span class="p">,</span>
          <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span>
          <span class="nx">success</span><span class="o">:</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">callback</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_filterData</span><span class="p">(</span><span class="s1">&#39;after&#39;</span><span class="p">,</span> <span class="s1">&#39;read&#39;</span><span class="p">,</span> <span class="k">void</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">record</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">recordOptions</span><span class="p">));</span>
          <span class="p">},</span> <span class="k">this</span><span class="p">),</span>
          <span class="nx">error</span><span class="o">:</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">callback</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_filterData</span><span class="p">(</span><span class="s1">&#39;after&#39;</span><span class="p">,</span> <span class="s1">&#39;read&#39;</span><span class="p">,</span> <span class="nx">error</span><span class="p">,</span> <span class="nx">record</span><span class="p">,</span> <span class="nx">error</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;response&#39;</span><span class="p">),</span> <span class="nx">recordOptions</span><span class="p">));</span>
          <span class="p">},</span> <span class="k">this</span><span class="p">)</span>
        <span class="p">}));</span>
      <span class="p">});</span>
    <span class="p">};</span>
    <span class="nx">RestStorage</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">readAll</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">proto</span><span class="p">,</span> <span class="nx">recordsOptions</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">optionsForCollection</span><span class="p">(</span><span class="nx">proto</span><span class="p">.</span><span class="nx">constructor</span><span class="p">,</span> <span class="nx">recordsOptions</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">_ref</span><span class="p">;</span>
        <span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_filterData</span><span class="p">(</span><span class="s1">&#39;before&#39;</span><span class="p">,</span> <span class="s1">&#39;readAll&#39;</span><span class="p">,</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">recordsOptions</span><span class="p">),</span> <span class="nx">err</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">recordsOptions</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">recordsOptions</span> <span class="o">&amp;&amp;</span> <span class="nx">recordsOptions</span><span class="p">.</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">options</span><span class="p">.</span><span class="nx">url</span> <span class="o">=</span> <span class="nx">recordsOptions</span><span class="p">.</span><span class="nx">url</span><span class="p">;</span>
          <span class="k">delete</span> <span class="nx">recordsOptions</span><span class="p">.</span><span class="nx">url</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Request</span><span class="p">(</span><span class="nx">$mixin</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="p">{</span>
          <span class="nx">data</span><span class="o">:</span> <span class="nx">recordsOptions</span><span class="p">,</span>
          <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span>
          <span class="nx">success</span><span class="o">:</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">callback</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_filterData</span><span class="p">(</span><span class="s1">&#39;after&#39;</span><span class="p">,</span> <span class="s1">&#39;readAll&#39;</span><span class="p">,</span> <span class="k">void</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">proto</span><span class="p">,</span> <span class="nx">recordsOptions</span><span class="p">));</span>
          <span class="p">},</span> <span class="k">this</span><span class="p">),</span>
          <span class="nx">error</span><span class="o">:</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">callback</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_filterData</span><span class="p">(</span><span class="s1">&#39;after&#39;</span><span class="p">,</span> <span class="s1">&#39;readAll&#39;</span><span class="p">,</span> <span class="nx">error</span><span class="p">,</span> <span class="nx">error</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;response&#39;</span><span class="p">),</span> <span class="nx">proto</span><span class="p">,</span> <span class="nx">recordsOptions</span><span class="p">));</span>
          <span class="p">},</span> <span class="k">this</span><span class="p">)</span>
        <span class="p">}));</span>
      <span class="p">});</span>
    <span class="p">};</span>
    <span class="nx">RestStorage</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">after</span><span class="p">(</span><span class="s1">&#39;readAll&#39;</span><span class="p">,</span> <span class="nx">$passError</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">_arg</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">namespace</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">proto</span><span class="p">,</span> <span class="nx">recordData</span><span class="p">;</span>
      <span class="nx">data</span> <span class="o">=</span> <span class="nx">_arg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">proto</span> <span class="o">=</span> <span class="nx">_arg</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">options</span> <span class="o">=</span> <span class="nx">_arg</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
      <span class="nx">namespace</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">collectionJsonNamespace</span><span class="p">(</span><span class="nx">proto</span><span class="p">);</span>
      <span class="nx">recordData</span> <span class="o">=</span> <span class="nx">namespace</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nx">namespace</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="o">?</span> <span class="nx">data</span><span class="p">[</span><span class="nx">namespace</span><span class="p">]</span> <span class="o">:</span> <span class="nx">data</span><span class="p">;</span>
      <span class="k">return</span> <span class="p">[</span><span class="nx">recordData</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">proto</span><span class="p">,</span> <span class="nx">options</span><span class="p">];</span>
    <span class="p">}));</span>
    <span class="nx">RestStorage</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">after</span><span class="p">(</span><span class="s1">&#39;readAll&#39;</span><span class="p">,</span> <span class="nx">$passError</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">_arg</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">attributes</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">proto</span><span class="p">,</span> <span class="nx">recordData</span><span class="p">,</span> <span class="nx">serverData</span><span class="p">;</span>
      <span class="nx">recordData</span> <span class="o">=</span> <span class="nx">_arg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">serverData</span> <span class="o">=</span> <span class="nx">_arg</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">proto</span> <span class="o">=</span> <span class="nx">_arg</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nx">options</span> <span class="o">=</span> <span class="nx">_arg</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
      <span class="k">return</span> <span class="p">[</span>
        <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">,</span> <span class="nx">_results</span><span class="p">;</span>
          <span class="nx">_results</span> <span class="o">=</span> <span class="p">[];</span>
          <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">recordData</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">attributes</span> <span class="o">=</span> <span class="nx">recordData</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
            <span class="nx">_results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getRecordFromData</span><span class="p">(</span><span class="nx">attributes</span><span class="p">));</span>
          <span class="p">}</span>
          <span class="k">return</span> <span class="nx">_results</span><span class="p">;</span>
        <span class="p">}).</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="nx">serverData</span><span class="p">,</span> <span class="nx">proto</span><span class="p">,</span> <span class="nx">options</span>
      <span class="p">];</span>
    <span class="p">}));</span>
    <span class="nx">RestStorage</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">destroy</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">record</span><span class="p">,</span> <span class="nx">recordOptions</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">optionsForRecord</span><span class="p">(</span><span class="nx">record</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">idRequired</span><span class="o">:</span> <span class="kc">true</span>
      <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">_ref</span><span class="p">;</span>
        <span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_filterData</span><span class="p">(</span><span class="s1">&#39;before&#39;</span><span class="p">,</span> <span class="s1">&#39;destroy&#39;</span><span class="p">,</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">record</span><span class="p">,</span> <span class="nx">recordOptions</span><span class="p">),</span> <span class="nx">err</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">record</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">recordOptions</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Request</span><span class="p">(</span><span class="nx">$mixin</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="p">{</span>
          <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;DELETE&#39;</span><span class="p">,</span>
          <span class="nx">success</span><span class="o">:</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">callback</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_filterData</span><span class="p">(</span><span class="s1">&#39;after&#39;</span><span class="p">,</span> <span class="s1">&#39;destroy&#39;</span><span class="p">,</span> <span class="k">void</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">record</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">recordOptions</span><span class="p">));</span>
          <span class="p">},</span> <span class="k">this</span><span class="p">),</span>
          <span class="nx">error</span><span class="o">:</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">callback</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_filterData</span><span class="p">(</span><span class="s1">&#39;after&#39;</span><span class="p">,</span> <span class="s1">&#39;destroy&#39;</span><span class="p">,</span> <span class="nx">error</span><span class="p">,</span> <span class="nx">record</span><span class="p">,</span> <span class="nx">error</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;response&#39;</span><span class="p">),</span> <span class="nx">recordOptions</span><span class="p">));</span>
          <span class="p">},</span> <span class="k">this</span><span class="p">)</span>
        <span class="p">}));</span>
      <span class="p">});</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">RestStorage</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">ViewSourceCache</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">ViewSourceCache</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nb">Object</span><span class="p">);</span>
    <span class="kd">function</span> <span class="nx">ViewSourceCache</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">ViewSourceCache</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">sources</span> <span class="o">=</span> <span class="p">{};</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">requests</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="p">}</span>
    <span class="nx">ViewSourceCache</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">propertyClass</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Property</span><span class="p">;</span>
    <span class="nx">ViewSourceCache</span><span class="p">.</span><span class="nx">accessor</span><span class="p">({</span>
      <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">path</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Navigator</span><span class="p">.</span><span class="nx">normalizePath</span><span class="p">(</span><span class="nx">path</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sources</span><span class="p">[</span><span class="nx">path</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">sources</span><span class="p">[</span><span class="nx">path</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">requests</span><span class="p">[</span><span class="nx">path</span><span class="p">]</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">requests</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Request</span><span class="p">({</span>
            <span class="nx">url</span><span class="o">:</span> <span class="nx">path</span> <span class="o">+</span> <span class="s1">&#39;.html&#39;</span><span class="p">,</span>
            <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;html&#39;</span><span class="p">,</span>
            <span class="nx">success</span><span class="o">:</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">response</span><span class="p">);</span>
            <span class="p">},</span> <span class="k">this</span><span class="p">),</span>
            <span class="nx">error</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Could not load view from &quot;</span> <span class="o">+</span> <span class="nx">path</span><span class="p">);</span>
            <span class="p">}</span>
          <span class="p">});</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="nx">set</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">sources</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">v</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">});</span>
    <span class="nx">ViewSourceCache</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">prefetch</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">path</span><span class="p">);</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">ViewSourceCache</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">View</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">View</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nb">Object</span><span class="p">);</span>
    <span class="kd">function</span> <span class="nx">View</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">node</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">contexts</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="nx">View</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">context</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;context&#39;</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">contexts</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">context</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">unset</span><span class="p">(</span><span class="s1">&#39;context&#39;</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">node</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;node&#39;</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">observe</span><span class="p">(</span><span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
        <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">View</span><span class="p">.</span><span class="nx">sourceCache</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">ViewSourceCache</span><span class="p">();</span>
    <span class="nx">View</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">source</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="nx">View</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">html</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="nx">View</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">node</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="nx">View</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">event</span><span class="p">(</span><span class="s1">&#39;ready&#39;</span><span class="p">).</span><span class="nx">oneShot</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nx">View</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">prefix</span> <span class="o">=</span> <span class="s1">&#39;views&#39;</span><span class="p">;</span>
    <span class="nx">View</span><span class="p">.</span><span class="nx">accessor</span><span class="p">(</span><span class="s1">&#39;html&#39;</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">source</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">html</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">html</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">html</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">source</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;source&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">source</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">path</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Navigator</span><span class="p">.</span><span class="nx">normalizePath</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">prefix</span><span class="p">,</span> <span class="nx">source</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">html</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">sourceCache</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">path</span><span class="p">);</span>
      <span class="p">},</span>
      <span class="nx">set</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">_</span><span class="p">,</span> <span class="nx">html</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">html</span> <span class="o">=</span> <span class="nx">html</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">});</span>
    <span class="nx">View</span><span class="p">.</span><span class="nx">accessor</span><span class="p">(</span><span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">html</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">html</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;html&#39;</span><span class="p">);</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">html</span> <span class="o">&amp;&amp;</span> <span class="nx">html</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">hasContainer</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">node</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">);</span>
          <span class="nx">$setInnerHTML</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">,</span> <span class="nx">html</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">set</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">_</span><span class="p">,</span> <span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">node</span> <span class="o">=</span> <span class="nx">node</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">});</span>
    <span class="nx">View</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">render</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">_ref</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">event</span><span class="p">(</span><span class="s1">&#39;ready&#39;</span><span class="p">).</span><span class="nx">resetOneShot</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">((</span><span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_renderer</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">_ref</span><span class="p">.</span><span class="nx">forgetAll</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_renderer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Renderer</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">contexts</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_renderer</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;rendered&#39;</span><span class="p">,</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="s1">&#39;ready&#39;</span><span class="p">,</span> <span class="nx">node</span><span class="p">);</span>
        <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">View</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">Renderer</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">bindingRegexp</span><span class="p">,</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">sortBindings</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">;</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">Renderer</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nb">Object</span><span class="p">);</span>
    <span class="nx">Renderer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">deferEvery</span> <span class="o">=</span> <span class="mi">50</span><span class="p">;</span>
    <span class="kd">function</span> <span class="nx">Renderer</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">contexts</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">_ref</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">node</span> <span class="o">=</span> <span class="nx">node</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">contexts</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">contexts</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">resume</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">resume</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">start</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">start</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
      <span class="nx">Renderer</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">callback</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;parsed&#39;</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">context</span> <span class="o">=</span> <span class="nx">contexts</span> <span class="k">instanceof</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">RenderContext</span> <span class="o">?</span> <span class="nx">contexts</span> <span class="o">:</span> <span class="p">(</span><span class="nx">_ref</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">RenderContext</span><span class="p">).</span><span class="nx">start</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">_ref</span><span class="p">,</span> <span class="nx">contexts</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">immediate</span> <span class="o">=</span> <span class="nx">$setImmediate</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">start</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">Renderer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">start</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">startTime</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">;</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">parseNode</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">Renderer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">resume</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">startTime</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">;</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">parseNode</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">resumeNode</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">Renderer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">finish</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">startTime</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">prevent</span><span class="p">(</span><span class="s1">&#39;stopped&#39;</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="s1">&#39;parsed&#39;</span><span class="p">);</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="s1">&#39;rendered&#39;</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">Renderer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">stop</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">$clearImmediate</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">immediate</span><span class="p">);</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="s1">&#39;stopped&#39;</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">Renderer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">forgetAll</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{};</span>
    <span class="nx">_ref</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;parsed&#39;</span><span class="p">,</span> <span class="s1">&#39;rendered&#39;</span><span class="p">,</span> <span class="s1">&#39;stopped&#39;</span><span class="p">];</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">k</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
      <span class="nx">Renderer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">event</span><span class="p">(</span><span class="nx">k</span><span class="p">).</span><span class="nx">oneShot</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">bindingRegexp</span> <span class="o">=</span> <span class="sr">/^data\-(.*)/</span><span class="p">;</span>
    <span class="nx">sortBindings</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;foreach&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;foreach&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;formfor&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;formfor&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;bind&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;bind&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">Renderer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">parseNode</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">attr</span><span class="p">,</span> <span class="nx">bindings</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">nextNode</span><span class="p">,</span> <span class="nx">oldContext</span><span class="p">,</span> <span class="nx">readerArgs</span><span class="p">,</span> <span class="nx">result</span><span class="p">,</span> <span class="nx">skipChildren</span><span class="p">,</span> <span class="nx">varIndex</span><span class="p">,</span> <span class="nx">_base</span><span class="p">,</span> <span class="nx">_base2</span><span class="p">,</span> <span class="nx">_j</span><span class="p">,</span> <span class="nx">_len2</span><span class="p">,</span> <span class="nx">_name</span><span class="p">,</span> <span class="nx">_name2</span><span class="p">,</span> <span class="nx">_ref2</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">deferEvery</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="k">new</span> <span class="nb">Date</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">startTime</span><span class="p">)</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">deferEvery</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">resumeNode</span> <span class="o">=</span> <span class="nx">node</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">timeout</span> <span class="o">=</span> <span class="nx">$setImmediate</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">resume</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">getAttribute</span> <span class="o">&amp;&amp;</span> <span class="nx">node</span><span class="p">.</span><span class="nx">attributes</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">bindings</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">_j</span><span class="p">,</span> <span class="nx">_len2</span><span class="p">,</span> <span class="nx">_ref2</span><span class="p">,</span> <span class="nx">_ref3</span><span class="p">,</span> <span class="nx">_results</span><span class="p">;</span>
          <span class="nx">_ref2</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">attributes</span><span class="p">;</span>
          <span class="nx">_results</span> <span class="o">=</span> <span class="p">[];</span>
          <span class="k">for</span> <span class="p">(</span><span class="nx">_j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len2</span> <span class="o">=</span> <span class="nx">_ref2</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_j</span> <span class="o">&lt;</span> <span class="nx">_len2</span><span class="p">;</span> <span class="nx">_j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">attr</span> <span class="o">=</span> <span class="nx">_ref2</span><span class="p">[</span><span class="nx">_j</span><span class="p">];</span>
            <span class="nx">name</span> <span class="o">=</span> <span class="p">(</span><span class="nx">_ref3</span> <span class="o">=</span> <span class="nx">attr</span><span class="p">.</span><span class="nx">nodeName</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">bindingRegexp</span><span class="p">))</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">_ref3</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">continue</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="nx">_results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="o">~</span><span class="p">(</span><span class="nx">varIndex</span> <span class="o">=</span> <span class="nx">name</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">))</span> <span class="o">?</span> <span class="p">[</span><span class="nx">name</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">varIndex</span><span class="p">),</span> <span class="nx">name</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">varIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="nx">attr</span><span class="p">.</span><span class="nx">value</span><span class="p">]</span> <span class="o">:</span> <span class="p">[</span><span class="nx">name</span><span class="p">,</span> <span class="nx">attr</span><span class="p">.</span><span class="nx">value</span><span class="p">]);</span>
          <span class="p">}</span>
          <span class="k">return</span> <span class="nx">_results</span><span class="p">;</span>
        <span class="p">})();</span>
        <span class="nx">_ref2</span> <span class="o">=</span> <span class="nx">bindings</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="nx">sortBindings</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">_j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len2</span> <span class="o">=</span> <span class="nx">_ref2</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_j</span> <span class="o">&lt;</span> <span class="nx">_len2</span><span class="p">;</span> <span class="nx">_j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">readerArgs</span> <span class="o">=</span> <span class="nx">_ref2</span><span class="p">[</span><span class="nx">_j</span><span class="p">];</span>
          <span class="nx">key</span> <span class="o">=</span> <span class="nx">readerArgs</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
          <span class="nx">result</span> <span class="o">=</span> <span class="nx">readerArgs</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">2</span> <span class="o">?</span> <span class="k">typeof</span> <span class="p">(</span><span class="nx">_base</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">readers</span><span class="p">)[</span><span class="nx">_name</span> <span class="o">=</span> <span class="nx">readerArgs</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span> <span class="o">?</span> <span class="nx">_base</span><span class="p">[</span><span class="nx">_name</span><span class="p">](</span><span class="nx">node</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">,</span> <span class="k">this</span><span class="p">)</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span> <span class="o">:</span> <span class="k">typeof</span> <span class="p">(</span><span class="nx">_base2</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">attrReaders</span><span class="p">)[</span><span class="nx">_name2</span> <span class="o">=</span> <span class="nx">readerArgs</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span> <span class="o">?</span> <span class="nx">_base2</span><span class="p">[</span><span class="nx">_name2</span><span class="p">](</span><span class="nx">node</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">readerArgs</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">,</span> <span class="k">this</span><span class="p">)</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">result</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">skipChildren</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">result</span> <span class="k">instanceof</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">RenderContext</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">oldContext</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">context</span> <span class="o">=</span> <span class="nx">result</span><span class="p">;</span>
            <span class="nx">$onParseExit</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
              <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">context</span> <span class="o">=</span> <span class="nx">oldContext</span><span class="p">;</span>
            <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">((</span><span class="nx">nextNode</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">nextNode</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">skipChildren</span><span class="p">)))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">parseNode</span><span class="p">(</span><span class="nx">nextNode</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">finish</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">Renderer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">nextNode</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">skipChildren</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">children</span><span class="p">,</span> <span class="nx">nextParent</span><span class="p">,</span> <span class="nx">parentSibling</span><span class="p">,</span> <span class="nx">sibling</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">skipChildren</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">children</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">children</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">children</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="nx">sibling</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">nextSibling</span><span class="p">;</span>
      <span class="nx">$onParseExit</span><span class="p">(</span><span class="nx">node</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">callback</span><span class="p">();</span>
      <span class="p">});</span>
      <span class="nx">$forgetParseExit</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">node</span> <span class="o">===</span> <span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">sibling</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">sibling</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">nextParent</span> <span class="o">=</span> <span class="nx">node</span><span class="p">;</span>
      <span class="k">while</span> <span class="p">(</span><span class="nx">nextParent</span> <span class="o">=</span> <span class="nx">nextParent</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$onParseExit</span><span class="p">(</span><span class="nx">nextParent</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">callback</span><span class="p">();</span>
        <span class="p">});</span>
        <span class="nx">$forgetParseExit</span><span class="p">(</span><span class="nx">nextParent</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">node</span> <span class="o">===</span> <span class="nx">nextParent</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">parentSibling</span> <span class="o">=</span> <span class="nx">nextParent</span><span class="p">.</span><span class="nx">nextSibling</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">parentSibling</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">parentSibling</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">Renderer</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">RenderContext</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">ContextProxy</span><span class="p">;</span>
    <span class="nx">RenderContext</span><span class="p">.</span><span class="nx">start</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">contexts</span><span class="p">,</span> <span class="nx">node</span><span class="p">;</span>
      <span class="nx">contexts</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="p">[];</span>
      <span class="nx">node</span> <span class="o">=</span> <span class="k">new</span> <span class="k">this</span><span class="p">(</span><span class="nb">window</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">Batman</span><span class="p">.</span><span class="nx">currentApp</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">contexts</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">Batman</span><span class="p">.</span><span class="nx">currentApp</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">while</span> <span class="p">(</span><span class="nx">context</span> <span class="o">=</span> <span class="nx">contexts</span><span class="p">.</span><span class="nx">pop</span><span class="p">())</span> <span class="p">{</span>
        <span class="nx">node</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">descend</span><span class="p">(</span><span class="nx">context</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">node</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="kd">function</span> <span class="nx">RenderContext</span><span class="p">(</span><span class="nx">object</span><span class="p">,</span> <span class="nx">parent</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">object</span> <span class="o">=</span> <span class="nx">object</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">parent</span> <span class="o">=</span> <span class="nx">parent</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">RenderContext</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">findKey</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">base</span><span class="p">,</span> <span class="nx">currentNode</span><span class="p">,</span> <span class="nx">val</span><span class="p">;</span>
      <span class="nx">base</span> <span class="o">=</span> <span class="nx">key</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">trim</span><span class="p">();</span>
      <span class="nx">currentNode</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="k">while</span> <span class="p">(</span><span class="nx">currentNode</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">currentNode</span><span class="p">.</span><span class="nx">object</span><span class="p">.</span><span class="nx">get</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">val</span> <span class="o">=</span> <span class="nx">currentNode</span><span class="p">.</span><span class="nx">object</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">base</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">val</span> <span class="o">=</span> <span class="nx">currentNode</span><span class="p">.</span><span class="nx">object</span><span class="p">[</span><span class="nx">base</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">val</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="p">[</span><span class="nx">$get</span><span class="p">(</span><span class="nx">currentNode</span><span class="p">.</span><span class="nx">object</span><span class="p">,</span> <span class="nx">key</span><span class="p">),</span> <span class="nx">currentNode</span><span class="p">.</span><span class="nx">object</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="nx">currentNode</span> <span class="o">=</span> <span class="nx">currentNode</span><span class="p">.</span><span class="nx">parent</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="p">[</span><span class="nx">container</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">key</span><span class="p">),</span> <span class="nx">container</span><span class="p">];</span>
    <span class="p">};</span>
    <span class="nx">RenderContext</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">descend</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">object</span><span class="p">,</span> <span class="nx">scopedKey</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">oldObject</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">scopedKey</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">oldObject</span> <span class="o">=</span> <span class="nx">object</span><span class="p">;</span>
        <span class="nx">object</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nb">Object</span><span class="p">();</span>
        <span class="nx">object</span><span class="p">[</span><span class="nx">scopedKey</span><span class="p">]</span> <span class="o">=</span> <span class="nx">oldObject</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">(</span><span class="nx">object</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">RenderContext</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">descendWithKey</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">scopedKey</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">proxy</span><span class="p">;</span>
      <span class="nx">proxy</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ContextProxy</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">key</span><span class="p">);</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">descend</span><span class="p">(</span><span class="nx">proxy</span><span class="p">,</span> <span class="nx">scopedKey</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">RenderContext</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">chain</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">parent</span><span class="p">,</span> <span class="nx">x</span><span class="p">;</span>
      <span class="nx">x</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="nx">parent</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="k">while</span> <span class="p">(</span><span class="nx">parent</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">x</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">parent</span><span class="p">.</span><span class="nx">object</span><span class="p">);</span>
        <span class="nx">parent</span> <span class="o">=</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">parent</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">x</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">RenderContext</span><span class="p">.</span><span class="nx">ContextProxy</span> <span class="o">=</span> <span class="nx">ContextProxy</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">__extends</span><span class="p">(</span><span class="nx">ContextProxy</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nb">Object</span><span class="p">);</span>
      <span class="nx">ContextProxy</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">isContextProxy</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">ContextProxy</span><span class="p">.</span><span class="nx">accessor</span><span class="p">(</span><span class="s1">&#39;proxiedObject&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">binding</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;filteredValue&#39;</span><span class="p">);</span>
      <span class="p">});</span>
      <span class="nx">ContextProxy</span><span class="p">.</span><span class="nx">accessor</span><span class="p">({</span>
        <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;proxiedObject.&quot;</span> <span class="o">+</span> <span class="nx">key</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">set</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;proxiedObject.&quot;</span> <span class="o">+</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">unset</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">unset</span><span class="p">(</span><span class="s2">&quot;proxiedObject.&quot;</span> <span class="o">+</span> <span class="nx">key</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">});</span>
      <span class="kd">function</span> <span class="nx">ContextProxy</span><span class="p">(</span><span class="nx">renderContext</span><span class="p">,</span> <span class="nx">keyPath</span><span class="p">,</span> <span class="nx">localKey</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">renderContext</span> <span class="o">=</span> <span class="nx">renderContext</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">keyPath</span> <span class="o">=</span> <span class="nx">keyPath</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">localKey</span> <span class="o">=</span> <span class="nx">localKey</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">binding</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">AbstractBinding</span><span class="p">(</span><span class="k">void</span> <span class="mi">0</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">keyPath</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">renderContext</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">ContextProxy</span><span class="p">;</span>
    <span class="p">})();</span>
    <span class="k">return</span> <span class="nx">RenderContext</span><span class="p">;</span>
  <span class="p">}).</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">readers</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">target</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">renderer</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">readers</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">renderer</span><span class="p">,</span> <span class="s1">&#39;nodeChange&#39;</span><span class="p">);</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">source</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">renderer</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">readers</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">renderer</span><span class="p">,</span> <span class="s1">&#39;dataChange&#39;</span><span class="p">);</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">bind</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">renderer</span><span class="p">,</span> <span class="nx">only</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">bindingClass</span><span class="p">;</span>
        <span class="nx">bindingClass</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="k">switch</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">nodeName</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">())</span> <span class="p">{</span>
          <span class="k">case</span> <span class="s1">&#39;input&#39;</span><span class="o">:</span>
            <span class="k">switch</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">))</span> <span class="p">{</span>
              <span class="k">case</span> <span class="s1">&#39;checkbox&#39;</span><span class="o">:</span>
                <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">attrReaders</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="s1">&#39;checked&#39;</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">renderer</span><span class="p">,</span> <span class="nx">only</span><span class="p">);</span>
                <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
              <span class="k">case</span> <span class="s1">&#39;radio&#39;</span><span class="o">:</span>
                <span class="nx">bindingClass</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">RadioBinding</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
              <span class="k">case</span> <span class="s1">&#39;file&#39;</span><span class="o">:</span>
                <span class="nx">bindingClass</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">FileBinding</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="s1">&#39;select&#39;</span><span class="o">:</span>
            <span class="nx">bindingClass</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">SelectBinding</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">bindingClass</span> <span class="o">||</span> <span class="p">(</span><span class="nx">bindingClass</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">Binding</span><span class="p">);</span>
        <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">func</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">ctor</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">ctor</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="nx">func</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
          <span class="kd">var</span> <span class="nx">child</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ctor</span><span class="p">,</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">func</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">child</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
          <span class="k">return</span> <span class="k">typeof</span> <span class="nx">result</span> <span class="o">===</span> <span class="s2">&quot;object&quot;</span> <span class="o">?</span> <span class="nx">result</span> <span class="o">:</span> <span class="nx">child</span><span class="p">;</span>
        <span class="p">})(</span><span class="nx">bindingClass</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{});</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">context</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">renderer</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">context</span><span class="p">.</span><span class="nx">descendWithKey</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
      <span class="p">},</span>
      <span class="nx">mixin</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">renderer</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">MixinBinding</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">context</span><span class="p">.</span><span class="nx">descend</span><span class="p">(</span><span class="nx">Batman</span><span class="p">.</span><span class="nx">mixins</span><span class="p">),</span> <span class="nx">renderer</span><span class="p">);</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">showif</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">parentRenderer</span><span class="p">,</span> <span class="nx">invert</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">ShowHideBinding</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">parentRenderer</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">invert</span><span class="p">);</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">hideif</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">_ref</span><span class="p">;</span>
        <span class="k">return</span> <span class="p">(</span><span class="nx">_ref</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">readers</span><span class="p">).</span><span class="nx">showif</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">_ref</span><span class="p">,</span> <span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">).</span><span class="nx">concat</span><span class="p">([</span><span class="kc">true</span><span class="p">]));</span>
      <span class="p">},</span>
      <span class="nx">route</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">action</span><span class="p">,</span> <span class="nx">app</span><span class="p">,</span> <span class="nx">container</span><span class="p">,</span> <span class="nx">dispatcher</span><span class="p">,</span> <span class="nx">isHash</span><span class="p">,</span> <span class="nx">model</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">,</span> <span class="nx">_ref2</span><span class="p">,</span> <span class="nx">_ref3</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">key</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">url</span> <span class="o">=</span> <span class="nx">key</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">isHash</span> <span class="o">=</span> <span class="nx">key</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">;</span>
          <span class="nx">_ref</span> <span class="o">=</span> <span class="nx">isHash</span> <span class="o">?</span> <span class="nx">key</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)</span> <span class="o">:</span> <span class="nx">key</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">),</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">action</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
          <span class="nx">_ref2</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">findKey</span><span class="p">(</span><span class="s1">&#39;dispatcher&#39;</span><span class="p">),</span> <span class="nx">dispatcher</span> <span class="o">=</span> <span class="nx">_ref2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">_ref2</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isHash</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">_ref3</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">findKey</span><span class="p">(</span><span class="nx">key</span><span class="p">),</span> <span class="nx">model</span> <span class="o">=</span> <span class="nx">_ref3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">container</span> <span class="o">=</span> <span class="nx">_ref3</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
          <span class="p">}</span>
          <span class="nx">dispatcher</span> <span class="o">||</span> <span class="p">(</span><span class="nx">dispatcher</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">currentApp</span><span class="p">.</span><span class="nx">dispatcher</span><span class="p">);</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">isHash</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">url</span> <span class="o">=</span> <span class="nx">dispatcher</span><span class="p">.</span><span class="nx">findUrl</span><span class="p">({</span>
              <span class="nx">controller</span><span class="o">:</span> <span class="nx">key</span><span class="p">,</span>
              <span class="nx">action</span><span class="o">:</span> <span class="nx">action</span>
            <span class="p">});</span>
          <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">model</span> <span class="k">instanceof</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Model</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">action</span> <span class="o">||</span> <span class="p">(</span><span class="nx">action</span> <span class="o">=</span> <span class="s1">&#39;show&#39;</span><span class="p">);</span>
            <span class="nx">name</span> <span class="o">=</span> <span class="nx">helpers</span><span class="p">.</span><span class="nx">underscore</span><span class="p">(</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">pluralize</span><span class="p">(</span><span class="nx">$functionName</span><span class="p">(</span><span class="nx">model</span><span class="p">.</span><span class="nx">constructor</span><span class="p">)));</span>
            <span class="nx">url</span> <span class="o">=</span> <span class="nx">dispatcher</span><span class="p">.</span><span class="nx">findUrl</span><span class="p">({</span>
              <span class="nx">resource</span><span class="o">:</span> <span class="nx">name</span><span class="p">,</span>
              <span class="nx">id</span><span class="o">:</span> <span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">),</span>
              <span class="nx">action</span><span class="o">:</span> <span class="nx">action</span>
            <span class="p">});</span>
          <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">model</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">model</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">action</span> <span class="o">||</span> <span class="p">(</span><span class="nx">action</span> <span class="o">=</span> <span class="s1">&#39;index&#39;</span><span class="p">);</span>
            <span class="nx">name</span> <span class="o">=</span> <span class="nx">helpers</span><span class="p">.</span><span class="nx">underscore</span><span class="p">(</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">pluralize</span><span class="p">(</span><span class="nx">$functionName</span><span class="p">(</span><span class="nx">model</span><span class="p">)));</span>
            <span class="nx">url</span> <span class="o">=</span> <span class="nx">dispatcher</span><span class="p">.</span><span class="nx">findUrl</span><span class="p">({</span>
              <span class="nx">resource</span><span class="o">:</span> <span class="nx">name</span><span class="p">,</span>
              <span class="nx">action</span><span class="o">:</span> <span class="nx">action</span>
            <span class="p">});</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">nodeName</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">()</span> <span class="o">===</span> <span class="s1">&#39;A&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">node</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Navigator</span><span class="p">.</span><span class="nx">defaultClass</span><span class="p">().</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">linkTo</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">$redirect</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>
        <span class="p">});</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">partial</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">renderer</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">partial</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">renderer</span><span class="p">);</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">defineview</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">renderer</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$onParseExit</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">$removeNode</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
        <span class="p">});</span>
        <span class="nx">Batman</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">sourceCache</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">Batman</span><span class="p">.</span><span class="nx">Navigator</span><span class="p">.</span><span class="nx">normalizePath</span><span class="p">(</span><span class="nx">Batman</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">prefix</span><span class="p">,</span> <span class="nx">name</span><span class="p">),</span> <span class="nx">node</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">);</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">yield</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$setImmediate</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">yield</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">node</span><span class="p">);</span>
        <span class="p">});</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">contentfor</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$setImmediate</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">contentFor</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">node</span><span class="p">);</span>
        <span class="p">});</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">replace</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$setImmediate</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">node</span><span class="p">);</span>
        <span class="p">});</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">_yieldContents</span><span class="o">:</span> <span class="p">{},</span>
    <span class="nx">_yields</span><span class="o">:</span> <span class="p">{},</span>
    <span class="nx">attrReaders</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">_parseAttribute</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">===</span> <span class="s1">&#39;false&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">value</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">===</span> <span class="s1">&#39;true&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">value</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">source</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">attr</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">renderer</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">attrReaders</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">attr</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">renderer</span><span class="p">,</span> <span class="s1">&#39;dataChange&#39;</span><span class="p">);</span>
      <span class="p">},</span>
      <span class="nx">bind</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">attr</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">renderer</span><span class="p">,</span> <span class="nx">only</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">bindingClass</span><span class="p">;</span>
        <span class="nx">bindingClass</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="k">switch</span> <span class="p">(</span><span class="nx">attr</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">case</span> <span class="s1">&#39;checked&#39;</span><span class="o">:</span>
            <span class="k">case</span> <span class="s1">&#39;disabled&#39;</span><span class="o">:</span>
            <span class="k">case</span> <span class="s1">&#39;selected&#39;</span><span class="o">:</span>
              <span class="k">return</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">CheckedBinding</span><span class="p">;</span>
            <span class="k">case</span> <span class="s1">&#39;value&#39;</span><span class="o">:</span>
            <span class="k">case</span> <span class="s1">&#39;href&#39;</span><span class="o">:</span>
            <span class="k">case</span> <span class="s1">&#39;src&#39;</span><span class="o">:</span>
            <span class="k">case</span> <span class="s1">&#39;size&#39;</span><span class="o">:</span>
              <span class="k">return</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">NodeAttributeBinding</span><span class="p">;</span>
            <span class="k">case</span> <span class="s1">&#39;class&#39;</span><span class="o">:</span>
              <span class="k">return</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">ClassBinding</span><span class="p">;</span>
            <span class="k">case</span> <span class="s1">&#39;style&#39;</span><span class="o">:</span>
              <span class="k">return</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">StyleBinding</span><span class="p">;</span>
            <span class="k">default</span><span class="o">:</span>
              <span class="k">return</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">AttributeBinding</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">})();</span>
        <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">func</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">ctor</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">ctor</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="nx">func</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
          <span class="kd">var</span> <span class="nx">child</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ctor</span><span class="p">,</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">func</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">child</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
          <span class="k">return</span> <span class="k">typeof</span> <span class="nx">result</span> <span class="o">===</span> <span class="s2">&quot;object&quot;</span> <span class="o">?</span> <span class="nx">result</span> <span class="o">:</span> <span class="nx">child</span><span class="p">;</span>
        <span class="p">})(</span><span class="nx">bindingClass</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{});</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">context</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">contextName</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">context</span><span class="p">.</span><span class="nx">descendWithKey</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">contextName</span><span class="p">);</span>
      <span class="p">},</span>
      <span class="nx">event</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">eventName</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">func</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">ctor</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">ctor</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="nx">func</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
          <span class="kd">var</span> <span class="nx">child</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ctor</span><span class="p">,</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">func</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">child</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
          <span class="k">return</span> <span class="k">typeof</span> <span class="nx">result</span> <span class="o">===</span> <span class="s2">&quot;object&quot;</span> <span class="o">?</span> <span class="nx">result</span> <span class="o">:</span> <span class="nx">child</span><span class="p">;</span>
        <span class="p">})(</span><span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">EventBinding</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{});</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">addclass</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">className</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">parentRenderer</span><span class="p">,</span> <span class="nx">invert</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">AddClassBinding</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">className</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">parentRenderer</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">invert</span><span class="p">);</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">removeclass</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">className</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">parentRenderer</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">attrReaders</span><span class="p">.</span><span class="nx">addclass</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">className</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">parentRenderer</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
      <span class="p">},</span>
      <span class="nx">foreach</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">iteratorName</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">parentRenderer</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">func</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">ctor</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">ctor</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="nx">func</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
          <span class="kd">var</span> <span class="nx">child</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ctor</span><span class="p">,</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">func</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">child</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
          <span class="k">return</span> <span class="k">typeof</span> <span class="nx">result</span> <span class="o">===</span> <span class="s2">&quot;object&quot;</span> <span class="o">?</span> <span class="nx">result</span> <span class="o">:</span> <span class="nx">child</span><span class="p">;</span>
        <span class="p">})(</span><span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">IteratorBinding</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{});</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">formfor</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">localName</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">submit</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">$preventDefault</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
        <span class="p">});</span>
        <span class="k">return</span> <span class="nx">context</span><span class="p">.</span><span class="nx">descendWithKey</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">localName</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">click</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">eventName</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">eventName</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">eventName</span> <span class="o">=</span> <span class="s1">&#39;click&#39;</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">$addEventListener</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">eventName</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">args</span><span class="p">;</span>
          <span class="nx">args</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="p">[];</span>
          <span class="nx">callback</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="p">[</span><span class="nx">node</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">args</span><span class="p">)));</span>
          <span class="k">return</span> <span class="nx">$preventDefault</span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="p">});</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">nodeName</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">()</span> <span class="o">===</span> <span class="s1">&#39;A&#39;</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">node</span><span class="p">.</span><span class="nx">href</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">node</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="s1">&#39;#&#39;</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">node</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">doubleclick</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="s1">&#39;dblclick&#39;</span><span class="p">);</span>
      <span class="p">},</span>
      <span class="nx">change</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">eventName</span><span class="p">,</span> <span class="nx">eventNames</span><span class="p">,</span> <span class="nx">oldCallback</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">,</span> <span class="nx">_results</span><span class="p">;</span>
        <span class="nx">eventNames</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="k">switch</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">nodeName</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">case</span> <span class="s1">&#39;TEXTAREA&#39;</span><span class="o">:</span>
              <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;keyup&#39;</span><span class="p">,</span> <span class="s1">&#39;change&#39;</span><span class="p">];</span>
            <span class="k">case</span> <span class="s1">&#39;INPUT&#39;</span><span class="o">:</span>
              <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">type</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">()</span> <span class="o">===</span> <span class="s1">&#39;TEXT&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">oldCallback</span> <span class="o">=</span> <span class="nx">callback</span><span class="p">;</span>
                <span class="nx">callback</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                  <span class="kd">var</span> <span class="nx">_ref</span><span class="p">;</span>
                  <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;keyup&#39;</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="mi">13</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="nx">_ref</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">keyCode</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">_ref</span> <span class="o">&lt;=</span> <span class="mi">14</span><span class="p">))</span> <span class="p">{</span>
                    <span class="k">return</span><span class="p">;</span>
                  <span class="p">}</span>
                  <span class="k">return</span> <span class="nx">oldCallback</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
                <span class="p">};</span>
                <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;keyup&#39;</span><span class="p">,</span> <span class="s1">&#39;change&#39;</span><span class="p">];</span>
              <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;change&#39;</span><span class="p">];</span>
              <span class="p">}</span>
              <span class="k">break</span><span class="p">;</span>
            <span class="k">default</span><span class="o">:</span>
              <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;change&#39;</span><span class="p">];</span>
          <span class="p">}</span>
        <span class="p">})();</span>
        <span class="nx">_results</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">eventNames</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">eventName</span> <span class="o">=</span> <span class="nx">eventNames</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
          <span class="nx">_results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">$addEventListener</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">eventName</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">args</span><span class="p">;</span>
            <span class="nx">args</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="p">[];</span>
            <span class="k">return</span> <span class="nx">callback</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="p">[</span><span class="nx">node</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">args</span><span class="p">)));</span>
          <span class="p">}));</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">_results</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">submit</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">nodeIsEditable</span><span class="p">(</span><span class="nx">node</span><span class="p">))</span> <span class="p">{</span>
          <span class="nx">$addEventListener</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="s1">&#39;keyup&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">args</span><span class="p">;</span>
            <span class="nx">args</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="p">[];</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">keyCode</span> <span class="o">===</span> <span class="mi">13</span> <span class="o">||</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">which</span> <span class="o">===</span> <span class="mi">13</span> <span class="o">||</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">keyIdentifier</span> <span class="o">===</span> <span class="s1">&#39;Enter&#39;</span> <span class="o">||</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">key</span> <span class="o">===</span> <span class="s1">&#39;Enter&#39;</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">$preventDefault</span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
              <span class="k">return</span> <span class="nx">callback</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="p">[</span><span class="nx">node</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">args</span><span class="p">)));</span>
            <span class="p">}</span>
          <span class="p">});</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">$addEventListener</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="s1">&#39;submit&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">args</span><span class="p">;</span>
            <span class="nx">args</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="p">[];</span>
            <span class="nx">$preventDefault</span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
            <span class="k">return</span> <span class="nx">callback</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="p">[</span><span class="nx">node</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">args</span><span class="p">)));</span>
          <span class="p">});</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">node</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">other</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">eventName</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$addEventListener</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">eventName</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">args</span><span class="p">;</span>
          <span class="nx">args</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="p">[];</span>
          <span class="k">return</span> <span class="nx">callback</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="p">[</span><span class="nx">node</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">args</span><span class="p">)));</span>
        <span class="p">});</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">yield</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">node</span><span class="p">,</span> <span class="nx">_replaceContent</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">content</span><span class="p">,</span> <span class="nx">contents</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">_replaceContent</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">_replaceContent</span> <span class="o">=</span> <span class="o">!</span><span class="nx">Batman</span><span class="p">.</span><span class="nx">_data</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="s1">&#39;yielded&#39;</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">_yields</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">node</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">contents</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">_yieldContents</span><span class="p">[</span><span class="nx">name</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">_replaceContent</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">$setInnerHTML</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">contents</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">content</span> <span class="o">=</span> <span class="nx">contents</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Batman</span><span class="p">.</span><span class="nx">_data</span><span class="p">(</span><span class="nx">content</span><span class="p">,</span> <span class="s1">&#39;yielded&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">$isChildOf</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">content</span><span class="p">))</span> <span class="p">{</span>
              <span class="nx">content</span> <span class="o">=</span> <span class="nx">content</span><span class="p">.</span><span class="nx">cloneNode</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="nx">$appendChild</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">content</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
            <span class="nx">Batman</span><span class="p">.</span><span class="nx">_data</span><span class="p">(</span><span class="nx">content</span><span class="p">,</span> <span class="s1">&#39;yielded&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">delete</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">_yieldContents</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
        <span class="k">return</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">_data</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="s1">&#39;yielded&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">contentFor</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">node</span><span class="p">,</span> <span class="nx">_replaceContent</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">contents</span><span class="p">,</span> <span class="nx">yieldingNode</span><span class="p">;</span>
      <span class="nx">contents</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">_yieldContents</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">contents</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">contents</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">_yieldContents</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nx">node</span><span class="p">];</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">yieldingNode</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">_yields</span><span class="p">[</span><span class="nx">name</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">yield</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">yieldingNode</span><span class="p">,</span> <span class="nx">_replaceContent</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">replace</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">contentFor</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">node</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">partial</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">container</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">renderer</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">view</span><span class="p">;</span>
      <span class="nx">renderer</span><span class="p">.</span><span class="nx">prevent</span><span class="p">(</span><span class="s1">&#39;rendered&#39;</span><span class="p">);</span>
      <span class="nx">view</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">View</span><span class="p">({</span>
        <span class="nx">source</span><span class="o">:</span> <span class="nx">path</span><span class="p">,</span>
        <span class="nx">contexts</span><span class="o">:</span> <span class="nx">context</span><span class="p">.</span><span class="nx">chain</span><span class="p">()</span>
      <span class="p">});</span>
      <span class="k">return</span> <span class="nx">view</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;ready&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">child</span><span class="p">,</span> <span class="nx">children</span><span class="p">,</span> <span class="nx">node</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">;</span>
        <span class="nx">$setInnerHTML</span><span class="p">(</span><span class="nx">container</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
        <span class="nx">children</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">,</span> <span class="nx">_results</span><span class="p">;</span>
          <span class="nx">_ref</span> <span class="o">=</span> <span class="nx">view</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;node&#39;</span><span class="p">).</span><span class="nx">childNodes</span><span class="p">;</span>
          <span class="nx">_results</span> <span class="o">=</span> <span class="p">[];</span>
          <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">node</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
            <span class="nx">_results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">return</span> <span class="nx">_results</span><span class="p">;</span>
        <span class="p">})();</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">children</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">child</span> <span class="o">=</span> <span class="nx">children</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
          <span class="nx">$appendChild</span><span class="p">(</span><span class="nx">container</span><span class="p">,</span> <span class="nx">child</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">renderer</span><span class="p">.</span><span class="nx">allowAndFire</span><span class="p">(</span><span class="s1">&#39;rendered&#39;</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">},</span>
    <span class="nx">trackBinding</span><span class="o">:</span> <span class="nx">$trackBinding</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">binding</span><span class="p">,</span> <span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">bindings</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">bindings</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">_data</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="s1">&#39;bindings&#39;</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">bindings</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">binding</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">_data</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="s1">&#39;bindings&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">SimpleSet</span><span class="p">(</span><span class="nx">binding</span><span class="p">));</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">unbindNode</span><span class="o">:</span> <span class="nx">$unbindNode</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">bindings</span><span class="p">,</span> <span class="nx">eventListeners</span><span class="p">,</span> <span class="nx">eventName</span><span class="p">,</span> <span class="nx">listeners</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">bindings</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">_data</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="s1">&#39;bindings&#39;</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">bindings</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">binding</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">binding</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span>
        <span class="p">});</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">listeners</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">_data</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="s1">&#39;listeners&#39;</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">eventName</span> <span class="k">in</span> <span class="nx">listeners</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">eventListeners</span> <span class="o">=</span> <span class="nx">listeners</span><span class="p">[</span><span class="nx">eventName</span><span class="p">];</span>
          <span class="nx">eventListeners</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">listener</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">$removeEventListener</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">eventName</span><span class="p">,</span> <span class="nx">listener</span><span class="p">);</span>
          <span class="p">});</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="nx">Batman</span><span class="p">.</span><span class="nx">removeData</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">removeData</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="k">void</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">unbindTree</span><span class="o">:</span> <span class="nx">$unbindTree</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">unbindRoot</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">child</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">,</span> <span class="nx">_results</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">unbindRoot</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">unbindRoot</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">unbindRoot</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$unbindNode</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">_ref</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">;</span>
      <span class="nx">_results</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">child</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
        <span class="nx">_results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">$unbindTree</span><span class="p">(</span><span class="nx">child</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">_results</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">setInnerHTML</span><span class="o">:</span> <span class="nx">$setInnerHTML</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">child</span><span class="p">,</span> <span class="nx">hide</span><span class="p">,</span> <span class="nx">html</span><span class="p">,</span> <span class="nx">node</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">;</span>
      <span class="nx">node</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">html</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">args</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">&lt;=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">:</span> <span class="p">[];</span>
      <span class="nx">_ref</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">child</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">hide</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">child</span><span class="p">,</span> <span class="s1">&#39;hide&#39;</span><span class="p">))</span> <span class="p">{</span>
          <span class="nx">hide</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">child</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="nx">$unbindTree</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">node</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">node</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">html</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">removeNode</span><span class="o">:</span> <span class="nx">$removeNode</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">_ref</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">((</span><span class="nx">_ref</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">_ref</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">didRemoveNode</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">appendChild</span><span class="o">:</span> <span class="nx">$appendChild</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">child</span><span class="p">,</span> <span class="nx">parent</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">;</span>
      <span class="nx">parent</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">child</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">args</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">&lt;=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">:</span> <span class="p">[];</span>
      <span class="k">if</span> <span class="p">((</span><span class="nx">_ref</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">child</span><span class="p">,</span> <span class="s1">&#39;show&#39;</span><span class="p">))</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">_ref</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">child</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">child</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">insertBefore</span><span class="o">:</span> <span class="nx">$insertBefore</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">parentNode</span><span class="p">,</span> <span class="nx">newNode</span><span class="p">,</span> <span class="nx">referenceNode</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">referenceNode</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">referenceNode</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">referenceNode</span> <span class="o">||</span> <span class="nx">parentNode</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$appendChild</span><span class="p">(</span><span class="nx">parentNode</span><span class="p">,</span> <span class="nx">newNode</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">newNode</span><span class="p">,</span> <span class="nx">referenceNode</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">valueForNode</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">isSetting</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">value</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">isSetting</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">;</span>
      <span class="k">switch</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">nodeName</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">case</span> <span class="s1">&#39;INPUT&#39;</span><span class="o">:</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">isSetting</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">node</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s1">&#39;TEXTAREA&#39;</span><span class="o">:</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">isSetting</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">node</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">node</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s1">&#39;SELECT&#39;</span><span class="o">:</span>
          <span class="k">return</span> <span class="nx">node</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
        <span class="k">default</span><span class="o">:</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">isSetting</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">$setInnerHTML</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">node</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">;</span>
          <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">nodeIsEditable</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">_ref</span><span class="p">;</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">_ref</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">nodeName</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">())</span> <span class="o">===</span> <span class="s1">&#39;INPUT&#39;</span> <span class="o">||</span> <span class="nx">_ref</span> <span class="o">===</span> <span class="s1">&#39;TEXTAREA&#39;</span> <span class="o">||</span> <span class="nx">_ref</span> <span class="o">===</span> <span class="s1">&#39;SELECT&#39;</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">addEventListener</span><span class="o">:</span> <span class="nx">$addEventListener</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">eventName</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">listeners</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">listeners</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">_data</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="s1">&#39;listeners&#39;</span><span class="p">)))</span> <span class="p">{</span>
        <span class="nx">listeners</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">_data</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="s1">&#39;listeners&#39;</span><span class="p">,</span> <span class="p">{});</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">listeners</span><span class="p">[</span><span class="nx">eventName</span><span class="p">])</span> <span class="p">{</span>
        <span class="nx">listeners</span><span class="p">[</span><span class="nx">eventName</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Set</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">listeners</span><span class="p">[</span><span class="nx">eventName</span><span class="p">].</span><span class="nx">add</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">$hasAddEventListener</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">node</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="nx">eventName</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">node</span><span class="p">.</span><span class="nx">attachEvent</span><span class="p">(</span><span class="s2">&quot;on&quot;</span> <span class="o">+</span> <span class="nx">eventName</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">removeEventListener</span><span class="o">:</span> <span class="nx">$removeEventListener</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">eventName</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">eventListeners</span><span class="p">,</span> <span class="nx">listeners</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">listeners</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">_data</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="s1">&#39;listeners&#39;</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">eventListeners</span> <span class="o">=</span> <span class="nx">listeners</span><span class="p">[</span><span class="nx">eventName</span><span class="p">])</span> <span class="p">{</span>
          <span class="nx">eventListeners</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">$hasAddEventListener</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">node</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="nx">eventName</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">node</span><span class="p">.</span><span class="nx">detachEvent</span><span class="p">(</span><span class="s1">&#39;on&#39;</span> <span class="o">+</span> <span class="nx">eventName</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">hasAddEventListener</span><span class="o">:</span> <span class="nx">$hasAddEventListener</span> <span class="o">=</span> <span class="o">!!</span><span class="p">(</span><span class="k">typeof</span> <span class="nb">window</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">window</span> <span class="o">!==</span> <span class="kc">null</span> <span class="o">?</span> <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">),</span>
    <span class="nx">didRemoveNode</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">$unbindTree</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">onParseExit</span><span class="o">:</span> <span class="nx">$onParseExit</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">set</span><span class="p">;</span>
      <span class="nx">set</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">_data</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="s1">&#39;onParseExit&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">_data</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="s1">&#39;onParseExit&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">SimpleSet</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">callback</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">set</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">set</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">forgetParseExit</span><span class="o">:</span> <span class="nx">$forgetParseExit</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">removeData</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="s1">&#39;onParseExit&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">AbstractBinding</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">deProxy</span><span class="p">,</span> <span class="nx">get_dot_rx</span><span class="p">,</span> <span class="nx">get_rx</span><span class="p">,</span> <span class="nx">keypath_rx</span><span class="p">;</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">AbstractBinding</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nb">Object</span><span class="p">);</span>
    <span class="nx">keypath_rx</span> <span class="o">=</span> <span class="sr">/(^|,)\s*(?!(?:true|false)\s*(?:$|,))([a-zA-Z][\w\.]*[\?\!]?)\s*(?=$|,)/g</span><span class="p">;</span>
    <span class="nx">get_dot_rx</span> <span class="o">=</span> <span class="sr">/(?:\]\.)(.+?)(?=[\[\.]|\s*\||$)/</span><span class="p">;</span>
    <span class="nx">get_rx</span> <span class="o">=</span> <span class="sr">/(?!^\s*)\[(.*?)\]/g</span><span class="p">;</span>
    <span class="nx">deProxy</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">object</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">object</span> <span class="k">instanceof</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">RenderContext</span><span class="p">.</span><span class="nx">ContextProxy</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">object</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;proxiedObject&#39;</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">object</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">AbstractBinding</span><span class="p">.</span><span class="nx">accessor</span><span class="p">(</span><span class="s1">&#39;filteredValue&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">result</span><span class="p">,</span> <span class="nx">unfilteredValue</span><span class="p">;</span>
      <span class="nx">unfilteredValue</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;unfilteredValue&#39;</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">filterFunctions</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">developer</span><span class="p">.</span><span class="nx">currentFilterStack</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">renderContext</span><span class="p">;</span>
        <span class="nx">result</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">filterFunctions</span><span class="p">.</span><span class="nx">reduce</span><span class="p">(</span><span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">args</span><span class="p">;</span>
          <span class="nx">args</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">filterArguments</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">argument</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">argument</span><span class="p">.</span><span class="nx">_keypath</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">return</span> <span class="nx">$get</span><span class="p">(</span><span class="nx">argument</span><span class="p">.</span><span class="nx">context</span><span class="p">,</span> <span class="nx">argument</span><span class="p">.</span><span class="nx">_keypath</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
              <span class="k">return</span> <span class="nx">argument</span><span class="p">;</span>
            <span class="p">}</span>
          <span class="p">});</span>
          <span class="nx">args</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
          <span class="nx">args</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">deProxy</span><span class="p">);</span>
          <span class="k">return</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">renderContext</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
        <span class="p">},</span> <span class="k">this</span><span class="p">),</span> <span class="nx">unfilteredValue</span><span class="p">);</span>
        <span class="nx">developer</span><span class="p">.</span><span class="nx">currentFilterStack</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">deProxy</span><span class="p">(</span><span class="nx">unfilteredValue</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
    <span class="nx">AbstractBinding</span><span class="p">.</span><span class="nx">accessor</span><span class="p">(</span><span class="s1">&#39;unfilteredValue&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">k</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">k</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;keyContext.&quot;</span> <span class="o">+</span> <span class="nx">k</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
    <span class="nx">AbstractBinding</span><span class="p">.</span><span class="nx">accessor</span><span class="p">(</span><span class="s1">&#39;keyContext&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">renderContext</span><span class="p">.</span><span class="nx">findKey</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">key</span><span class="p">)[</span><span class="mi">1</span><span class="p">];</span>
    <span class="p">});</span>
    <span class="nx">AbstractBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">bindImmediately</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="kd">function</span> <span class="nx">AbstractBinding</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">keyPath</span><span class="p">,</span> <span class="nx">renderContext</span><span class="p">,</span> <span class="nx">renderer</span><span class="p">,</span> <span class="nx">only</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">node</span> <span class="o">=</span> <span class="nx">node</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">keyPath</span> <span class="o">=</span> <span class="nx">keyPath</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">renderContext</span> <span class="o">=</span> <span class="nx">renderContext</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">renderer</span> <span class="o">=</span> <span class="nx">renderer</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">only</span> <span class="o">=</span> <span class="nx">only</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">only</span> <span class="o">:</span> <span class="kc">false</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">node</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">trackBinding</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">parseFilter</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">bindImmediately</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">AbstractBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">bind</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">shouldSet</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">,</span> <span class="nx">_ref2</span><span class="p">;</span>
      <span class="nx">shouldSet</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="nx">node</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">((</span><span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">only</span><span class="p">)</span> <span class="o">===</span> <span class="kc">false</span> <span class="o">||</span> <span class="nx">_ref</span> <span class="o">===</span> <span class="s1">&#39;nodeChange&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">nodeIsEditable</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">change</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">,</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="nx">shouldSet</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="k">this</span><span class="p">.</span><span class="nx">nodeChange</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">nodeChange</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;keyContext&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">return</span> <span class="nx">shouldSet</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">((</span><span class="nx">_ref2</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">only</span><span class="p">)</span> <span class="o">===</span> <span class="kc">false</span> <span class="o">||</span> <span class="nx">_ref2</span> <span class="o">===</span> <span class="s1">&#39;dataChange&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">observeAndFire</span><span class="p">(</span><span class="s1">&#39;filteredValue&#39;</span><span class="p">,</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">shouldSet</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">typeof</span> <span class="k">this</span><span class="p">.</span><span class="nx">dataChange</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">dataChange</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">)</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">AbstractBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">destroy</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">_ref</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">forget</span><span class="p">();</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_batman</span><span class="p">.</span><span class="nx">properties</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">property</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">property</span><span class="p">.</span><span class="nx">die</span><span class="p">();</span>
      <span class="p">})</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">AbstractBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">parseFilter</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">filter</span><span class="p">,</span> <span class="nx">filterName</span><span class="p">,</span> <span class="nx">filterString</span><span class="p">,</span> <span class="nx">filters</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">keyPath</span><span class="p">,</span> <span class="nx">orig</span><span class="p">,</span> <span class="nx">split</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">filterFunctions</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">filterArguments</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="nx">keyPath</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">keyPath</span><span class="p">;</span>
      <span class="k">while</span> <span class="p">(</span><span class="nx">get_dot_rx</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">keyPath</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">keyPath</span> <span class="o">=</span> <span class="nx">keyPath</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">get_dot_rx</span><span class="p">,</span> <span class="s2">&quot;][&#39;$1&#39;]&quot;</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">filters</span> <span class="o">=</span> <span class="nx">keyPath</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">get_rx</span><span class="p">,</span> <span class="s2">&quot; | get $1 &quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&#39;/g</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="sr">/(?!&quot;)\s+\|\s+(?!&quot;)/</span><span class="p">);</span>
      <span class="k">try</span> <span class="p">{</span>
        <span class="nx">key</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">parseSegment</span><span class="p">(</span><span class="nx">orig</span> <span class="o">=</span> <span class="nx">filters</span><span class="p">.</span><span class="nx">shift</span><span class="p">())[</span><span class="mi">0</span><span class="p">];</span>
      <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">developer</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
        <span class="nx">developer</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;Error! Couldn&#39;t parse keypath in \&quot;&quot;</span> <span class="o">+</span> <span class="nx">orig</span> <span class="o">+</span> <span class="s2">&quot;\&quot;. Parsing error above.&quot;</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">key</span> <span class="o">&amp;&amp;</span> <span class="nx">key</span><span class="p">.</span><span class="nx">_keypath</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">key</span> <span class="o">=</span> <span class="nx">key</span><span class="p">.</span><span class="nx">_keypath</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">key</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">filters</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">while</span> <span class="p">(</span><span class="nx">filterString</span> <span class="o">=</span> <span class="nx">filters</span><span class="p">.</span><span class="nx">shift</span><span class="p">())</span> <span class="p">{</span>
          <span class="nx">split</span> <span class="o">=</span> <span class="nx">filterString</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">);</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">~</span><span class="nx">split</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">filterName</span> <span class="o">=</span> <span class="nx">filterString</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">split</span><span class="p">);</span>
            <span class="nx">args</span> <span class="o">=</span> <span class="nx">filterString</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">split</span><span class="p">);</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">filterName</span> <span class="o">=</span> <span class="nx">filterString</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">filter</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Filters</span><span class="p">[</span><span class="nx">filterName</span><span class="p">])</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">filterFunctions</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">filter</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">try</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">filterArguments</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">parseSegment</span><span class="p">(</span><span class="nx">args</span><span class="p">));</span>
              <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">developer</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;Bad filter arguments \&quot;&quot;</span> <span class="o">+</span> <span class="nx">args</span> <span class="o">+</span> <span class="s2">&quot;\&quot;!&quot;</span><span class="p">);</span>
              <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
              <span class="k">this</span><span class="p">.</span><span class="nx">filterArguments</span><span class="p">.</span><span class="nx">push</span><span class="p">([]);</span>
            <span class="p">}</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">developer</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;Unrecognized filter &#39;&quot;</span> <span class="o">+</span> <span class="nx">filterName</span> <span class="o">+</span> <span class="s2">&quot;&#39; in key \&quot;&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">keyPath</span> <span class="o">+</span> <span class="s2">&quot;\&quot;!&quot;</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">filterArguments</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">filterArguments</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">argumentList</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">argumentList</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">argument</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">argument</span><span class="p">.</span><span class="nx">_keypath</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">renderContext</span><span class="p">.</span><span class="nx">findKey</span><span class="p">(</span><span class="nx">argument</span><span class="p">.</span><span class="nx">_keypath</span><span class="p">),</span> <span class="nx">_</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">argument</span><span class="p">.</span><span class="nx">context</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nx">argument</span><span class="p">;</span>
          <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
        <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">AbstractBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">parseSegment</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">segment</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="s2">&quot;[&quot;</span> <span class="o">+</span> <span class="nx">segment</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">keypath_rx</span><span class="p">,</span> <span class="s2">&quot;$1{\&quot;_keypath\&quot;: \&quot;$2\&quot;}&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;]&quot;</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">AbstractBinding</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">AbstractAttributeBinding</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">AbstractAttributeBinding</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">AbstractBinding</span><span class="p">);</span>
    <span class="kd">function</span> <span class="nx">AbstractAttributeBinding</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">attributeName</span><span class="p">,</span> <span class="nx">node</span><span class="p">;</span>
      <span class="nx">node</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">attributeName</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">args</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">&lt;=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">:</span> <span class="p">[];</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">attributeName</span> <span class="o">=</span> <span class="nx">attributeName</span><span class="p">;</span>
      <span class="nx">AbstractAttributeBinding</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="p">[</span><span class="nx">node</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">args</span><span class="p">)));</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">AbstractAttributeBinding</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">AbstractCollectionBinding</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">AbstractCollectionBinding</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">AbstractAttributeBinding</span><span class="p">);</span>
    <span class="kd">function</span> <span class="nx">AbstractCollectionBinding</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">AbstractCollectionBinding</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">AbstractCollectionBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">bindCollection</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">newCollection</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">newCollection</span> <span class="o">!==</span> <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">unbindCollection</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">collection</span> <span class="o">=</span> <span class="nx">newCollection</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">isObservable</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">toArray</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">observe</span><span class="p">(</span><span class="s1">&#39;toArray&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">handleArrayChanged</span><span class="p">);</span>
          <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">isEventEmitter</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;itemsWereAdded&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">handleItemsWereAdded</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;itemsWereRemoved&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">handleItemsWereRemoved</span><span class="p">);</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">AbstractCollectionBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">unbindCollection</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">isObservable</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">toArray</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">forget</span><span class="p">(</span><span class="s1">&#39;toArray&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">handleArrayChanged</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">isEventEmitter</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">event</span><span class="p">(</span><span class="s1">&#39;itemsWereAdded&#39;</span><span class="p">).</span><span class="nx">removeHandler</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">handleItemsWereAdded</span><span class="p">);</span>
          <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">event</span><span class="p">(</span><span class="s1">&#39;itemsWereRemoved&#39;</span><span class="p">).</span><span class="nx">removeHandler</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">handleItemsWereRemoved</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">AbstractCollectionBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">handleItemsWereAdded</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{};</span>
    <span class="nx">AbstractCollectionBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">handleItemsWereRemoved</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{};</span>
    <span class="nx">AbstractCollectionBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">handleArrayChanged</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{};</span>
    <span class="nx">AbstractCollectionBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">destroy</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">unbindCollection</span><span class="p">();</span>
      <span class="k">return</span> <span class="nx">AbstractCollectionBinding</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">destroy</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">AbstractCollectionBinding</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">Binding</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">Binding</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">AbstractBinding</span><span class="p">);</span>
    <span class="kd">function</span> <span class="nx">Binding</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">Binding</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">Binding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">nodeChange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">key</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">filterFunctions</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;keyContext&#39;</span><span class="p">).</span><span class="nx">set</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">key</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">Binding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">dataChange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">valueForNode</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">Binding</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">AttributeBinding</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">AttributeBinding</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">AbstractAttributeBinding</span><span class="p">);</span>
    <span class="kd">function</span> <span class="nx">AttributeBinding</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">AttributeBinding</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">AttributeBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">dataChange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">attributeName</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">AttributeBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">nodeChange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;keyContext&#39;</span><span class="p">).</span><span class="nx">set</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">key</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">attrReaders</span><span class="p">.</span><span class="nx">_parseAttribute</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">attributeName</span><span class="p">)));</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">AttributeBinding</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">NodeAttributeBinding</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">NodeAttributeBinding</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">AbstractAttributeBinding</span><span class="p">);</span>
    <span class="kd">function</span> <span class="nx">NodeAttributeBinding</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">NodeAttributeBinding</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">NodeAttributeBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">dataChange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">attributeName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">NodeAttributeBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">nodeChange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;keyContext&#39;</span><span class="p">).</span><span class="nx">set</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">key</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">attrReaders</span><span class="p">.</span><span class="nx">_parseAttribute</span><span class="p">(</span><span class="nx">node</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">attributeName</span><span class="p">]));</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">NodeAttributeBinding</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">ShowHideBinding</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">ShowHideBinding</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">AbstractBinding</span><span class="p">);</span>
    <span class="kd">function</span> <span class="nx">ShowHideBinding</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">className</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">parentRenderer</span><span class="p">,</span> <span class="nx">invert</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">invert</span> <span class="o">=</span> <span class="nx">invert</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">invert</span> <span class="o">:</span> <span class="kc">false</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">originalDisplay</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
      <span class="nx">ShowHideBinding</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">ShowHideBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">dataChange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">hide</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!!</span><span class="nx">value</span> <span class="o">===</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">invert</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">((</span><span class="nx">_ref</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">,</span> <span class="s1">&#39;show&#39;</span><span class="p">))</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">_ref</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">originalDisplay</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">hide</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">,</span> <span class="s1">&#39;hide&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">hide</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">hide</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">ShowHideBinding</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">CheckedBinding</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">CheckedBinding</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">NodeAttributeBinding</span><span class="p">);</span>
    <span class="nx">CheckedBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">dataChange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">_base</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">attributeName</span><span class="p">]</span> <span class="o">=</span> <span class="o">!!</span><span class="nx">value</span><span class="p">;</span>
      <span class="k">return</span> <span class="k">typeof</span> <span class="p">(</span><span class="nx">_base</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">_data</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">,</span> <span class="s1">&#39;updateBinding&#39;</span><span class="p">))</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span> <span class="o">?</span> <span class="nx">_base</span><span class="p">()</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="kd">function</span> <span class="nx">CheckedBinding</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">CheckedBinding</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
      <span class="nx">Batman</span><span class="p">.</span><span class="nx">_data</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">attributeName</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">CheckedBinding</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">ClassBinding</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">ClassBinding</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">AbstractCollectionBinding</span><span class="p">);</span>
    <span class="kd">function</span> <span class="nx">ClassBinding</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">handleItemsWereAdded</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">handleItemsWereAdded</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">handleItemsWereRemoved</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">handleItemsWereRemoved</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">handleArrayChanged</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">handleArrayChanged</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
      <span class="nx">ClassBinding</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">ClassBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">dataChange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">unbindCollection</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">value</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">bindCollection</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
          <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">updateFromCollection</span><span class="p">();</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">ClassBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">updateFromCollection</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">array</span><span class="p">,</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">array</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">map</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">x</span><span class="p">;</span>
        <span class="p">})</span> <span class="o">:</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">_ref</span><span class="p">,</span> <span class="nx">_results</span><span class="p">;</span>
          <span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">;</span>
          <span class="nx">_results</span> <span class="o">=</span> <span class="p">[];</span>
          <span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="k">in</span> <span class="nx">_ref</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">__hasProp</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">_ref</span><span class="p">,</span> <span class="nx">k</span><span class="p">))</span> <span class="k">continue</span><span class="p">;</span>
            <span class="nx">v</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>
            <span class="nx">_results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">k</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">return</span> <span class="nx">_results</span><span class="p">;</span>
        <span class="p">}).</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">array</span><span class="p">.</span><span class="nx">toArray</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">array</span> <span class="o">=</span> <span class="nx">array</span><span class="p">.</span><span class="nx">toArray</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="nx">array</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">ClassBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">handleArrayChanged</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">updateFromCollection</span><span class="p">();</span>
    <span class="p">};</span>
    <span class="nx">ClassBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">handleItemsWereRemoved</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">updateFromCollection</span><span class="p">();</span>
    <span class="p">};</span>
    <span class="nx">ClassBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">handleItemsWereAdded</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">updateFromCollection</span><span class="p">();</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">ClassBinding</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">AddClassBinding</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">AddClassBinding</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">AbstractAttributeBinding</span><span class="p">);</span>
    <span class="kd">function</span> <span class="nx">AddClassBinding</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">className</span><span class="p">,</span> <span class="nx">keyPath</span><span class="p">,</span> <span class="nx">renderContext</span><span class="p">,</span> <span class="nx">renderer</span><span class="p">,</span> <span class="nx">only</span><span class="p">,</span> <span class="nx">invert</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">invert</span> <span class="o">=</span> <span class="nx">invert</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">invert</span> <span class="o">:</span> <span class="kc">false</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="nx">className</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\|/g</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">);</span>
      <span class="nx">AddClassBinding</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
      <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">attributeName</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">AddClassBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">dataChange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">currentName</span><span class="p">,</span> <span class="nx">includesClassName</span><span class="p">;</span>
      <span class="nx">currentName</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">className</span><span class="p">;</span>
      <span class="nx">includesClassName</span> <span class="o">=</span> <span class="nx">currentName</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">className</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!!</span><span class="nx">value</span> <span class="o">===</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">invert</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">includesClassName</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="nx">currentName</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">className</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">includesClassName</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="nx">currentName</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">className</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">AddClassBinding</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">EventBinding</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">EventBinding</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">AbstractAttributeBinding</span><span class="p">);</span>
    <span class="nx">EventBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">bindImmediately</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="kd">function</span> <span class="nx">EventBinding</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">attacher</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">confirmText</span><span class="p">;</span>
      <span class="nx">EventBinding</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
      <span class="nx">confirmText</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;data-confirm&#39;</span><span class="p">);</span>
      <span class="nx">callback</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">_ref</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">confirmText</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">confirm</span><span class="p">(</span><span class="nx">confirmText</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="p">(</span><span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;filteredValue&#39;</span><span class="p">))</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;callbackContext&#39;</span><span class="p">),</span> <span class="nx">arguments</span><span class="p">)</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">},</span> <span class="k">this</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">attacher</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">events</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">attributeName</span><span class="p">])</span> <span class="p">{</span>
        <span class="nx">attacher</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">other</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">attributeName</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">EventBinding</span><span class="p">.</span><span class="nx">accessor</span><span class="p">(</span><span class="s1">&#39;callbackContext&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">contextKeySegments</span><span class="p">;</span>
      <span class="nx">contextKeySegments</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">key</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">);</span>
      <span class="nx">contextKeySegments</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
      <span class="k">return</span> <span class="nx">context</span> <span class="o">=</span> <span class="nx">contextKeySegments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;keyContext&#39;</span><span class="p">).</span><span class="nx">get</span><span class="p">(</span><span class="nx">contextKeySegments</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">))</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;keyContext&#39;</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="nx">EventBinding</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">RadioBinding</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">RadioBinding</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">AbstractBinding</span><span class="p">);</span>
    <span class="kd">function</span> <span class="nx">RadioBinding</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">RadioBinding</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">RadioBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">dataChange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">boundValue</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">((</span><span class="nx">boundValue</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;filteredValue&#39;</span><span class="p">))</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">checked</span> <span class="o">=</span> <span class="nx">boundValue</span> <span class="o">===</span> <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">checked</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;keyContext&#39;</span><span class="p">).</span><span class="nx">set</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">key</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">RadioBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">nodeChange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;keyContext&#39;</span><span class="p">).</span><span class="nx">set</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">key</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">attrReaders</span><span class="p">.</span><span class="nx">_parseAttribute</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">));</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">RadioBinding</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">FileBinding</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">FileBinding</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">AbstractBinding</span><span class="p">);</span>
    <span class="kd">function</span> <span class="nx">FileBinding</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">FileBinding</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">FileBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">nodeChange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">subContext</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">actualObject</span><span class="p">,</span> <span class="nx">adapter</span><span class="p">,</span> <span class="nx">keyContext</span><span class="p">,</span> <span class="nx">segments</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">;</span>
      <span class="nx">segments</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">key</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">segments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">keyContext</span> <span class="o">=</span> <span class="nx">subContext</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">segments</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">));</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">keyContext</span> <span class="o">=</span> <span class="nx">subContext</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">keyContext</span> <span class="k">instanceof</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">RenderContext</span><span class="p">.</span><span class="nx">ContextProxy</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">actualObject</span> <span class="o">=</span> <span class="nx">keyContext</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;proxiedObject&#39;</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">actualObject</span> <span class="o">=</span> <span class="nx">keyContext</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">actualObject</span><span class="p">.</span><span class="nx">hasStorage</span> <span class="o">&amp;&amp;</span> <span class="nx">actualObject</span><span class="p">.</span><span class="nx">hasStorage</span><span class="p">())</span> <span class="p">{</span>
        <span class="nx">_ref</span> <span class="o">=</span> <span class="nx">actualObject</span><span class="p">.</span><span class="nx">_batman</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;storage&#39;</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">adapter</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">adapter</span> <span class="k">instanceof</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">RestStorage</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">adapter</span><span class="p">.</span><span class="nx">defaultOptions</span><span class="p">.</span><span class="nx">formData</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">hasAttribute</span><span class="p">(</span><span class="s1">&#39;multiple&#39;</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">subContext</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">key</span><span class="p">,</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">files</span><span class="p">));</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">subContext</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">key</span><span class="p">,</span> <span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">FileBinding</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">MixinBinding</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">MixinBinding</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">AbstractBinding</span><span class="p">);</span>
    <span class="kd">function</span> <span class="nx">MixinBinding</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">MixinBinding</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">MixinBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">dataChange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$mixin</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">MixinBinding</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">SelectBinding</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">SelectBinding</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">AbstractBinding</span><span class="p">);</span>
    <span class="nx">SelectBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">bindImmediately</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="kd">function</span> <span class="nx">SelectBinding</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">updateOptionBindings</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">updateOptionBindings</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">updateSelectBinding</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">updateSelectBinding</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">nodeChange</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">nodeChange</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">dataChange</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">dataChange</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>      <span class="nx">SelectBinding</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">renderer</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;rendered&#39;</span><span class="p">,</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">node</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">Batman</span><span class="p">.</span><span class="nx">_data</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">,</span> <span class="s1">&#39;updateBinding&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">updateSelectBinding</span><span class="p">);</span>
          <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">();</span>
        <span class="p">}</span>
      <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="nx">SelectBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">dataChange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">newValue</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">child</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">matches</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">valueToChild</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_j</span><span class="p">,</span> <span class="nx">_k</span><span class="p">,</span> <span class="nx">_len</span><span class="p">,</span> <span class="nx">_len2</span><span class="p">,</span> <span class="nx">_len3</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">,</span> <span class="nx">_ref2</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">newValue</span> <span class="k">instanceof</span> <span class="nb">Array</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">valueToChild</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">children</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">child</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
          <span class="nx">child</span><span class="p">.</span><span class="nx">selected</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
          <span class="nx">matches</span> <span class="o">=</span> <span class="nx">valueToChild</span><span class="p">[</span><span class="nx">child</span><span class="p">.</span><span class="nx">value</span><span class="p">];</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">matches</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">matches</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">child</span><span class="p">);</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">matches</span> <span class="o">=</span> <span class="p">[</span><span class="nx">child</span><span class="p">];</span>
          <span class="p">}</span>
          <span class="nx">valueToChild</span><span class="p">[</span><span class="nx">child</span><span class="p">.</span><span class="nx">value</span><span class="p">]</span> <span class="o">=</span> <span class="nx">matches</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">_j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len2</span> <span class="o">=</span> <span class="nx">newValue</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_j</span> <span class="o">&lt;</span> <span class="nx">_len2</span><span class="p">;</span> <span class="nx">_j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">value</span> <span class="o">=</span> <span class="nx">newValue</span><span class="p">[</span><span class="nx">_j</span><span class="p">];</span>
          <span class="nx">_ref2</span> <span class="o">=</span> <span class="nx">valueToChild</span><span class="p">[</span><span class="nx">value</span><span class="p">];</span>
          <span class="k">for</span> <span class="p">(</span><span class="nx">_k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len3</span> <span class="o">=</span> <span class="nx">_ref2</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_k</span> <span class="o">&lt;</span> <span class="nx">_len3</span><span class="p">;</span> <span class="nx">_k</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">match</span> <span class="o">=</span> <span class="nx">_ref2</span><span class="p">[</span><span class="nx">_k</span><span class="p">];</span>
            <span class="nx">match</span><span class="p">.</span><span class="nx">selected</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">valueForNode</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">,</span> <span class="nx">newValue</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">updateOptionBindings</span><span class="p">();</span>
    <span class="p">};</span>
    <span class="nx">SelectBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">nodeChange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">updateSelectBinding</span><span class="p">();</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">updateOptionBindings</span><span class="p">();</span>
    <span class="p">};</span>
    <span class="nx">SelectBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">updateSelectBinding</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">c</span><span class="p">,</span> <span class="nx">selections</span><span class="p">;</span>
      <span class="nx">selections</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">multiple</span> <span class="o">?</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">,</span> <span class="nx">_results</span><span class="p">;</span>
        <span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">children</span><span class="p">;</span>
        <span class="nx">_results</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">c</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">selected</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">_results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">_results</span><span class="p">;</span>
      <span class="p">}).</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">selections</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">selections</span> <span class="o">=</span> <span class="nx">selections</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;keyContext&#39;</span><span class="p">).</span><span class="nx">set</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">key</span><span class="p">,</span> <span class="nx">selections</span><span class="p">);</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">SelectBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">updateOptionBindings</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">child</span><span class="p">,</span> <span class="nx">selectedBinding</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">;</span>
      <span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">children</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">child</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">selectedBinding</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">_data</span><span class="p">(</span><span class="nx">child</span><span class="p">,</span> <span class="s1">&#39;selected&#39;</span><span class="p">))</span> <span class="p">{</span>
          <span class="nx">selectedBinding</span><span class="p">.</span><span class="nx">nodeChange</span><span class="p">(</span><span class="nx">selectedBinding</span><span class="p">.</span><span class="nx">node</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">SelectBinding</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">StyleBinding</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">StyleBinding</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">AbstractCollectionBinding</span><span class="p">);</span>
    <span class="nx">StyleBinding</span><span class="p">.</span><span class="nx">SingleStyleBinding</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">__extends</span><span class="p">(</span><span class="nx">SingleStyleBinding</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">AbstractAttributeBinding</span><span class="p">);</span>
      <span class="kd">function</span> <span class="nx">SingleStyleBinding</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">parent</span><span class="p">,</span> <span class="nx">_i</span><span class="p">;</span>
        <span class="nx">args</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">&lt;=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_i</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">:</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[]),</span> <span class="nx">parent</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="nx">_i</span><span class="o">++</span><span class="p">];</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">parent</span> <span class="o">=</span> <span class="nx">parent</span><span class="p">;</span>
        <span class="nx">SingleStyleBinding</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">SingleStyleBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">dataChange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">setStyle</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">attributeName</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
      <span class="p">};</span>
      <span class="k">return</span> <span class="nx">SingleStyleBinding</span><span class="p">;</span>
    <span class="p">})();</span>
    <span class="kd">function</span> <span class="nx">StyleBinding</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">setStyle</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">setStyle</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">handleItemsWereRemoved</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">handleItemsWereRemoved</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">handleItemsWereAdded</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">handleItemsWereAdded</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>      <span class="k">this</span><span class="p">.</span><span class="nx">oldStyles</span> <span class="o">=</span> <span class="p">{};</span>
      <span class="nx">StyleBinding</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">StyleBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">dataChange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">colonSplitCSSValues</span><span class="p">,</span> <span class="nx">cssName</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">keyValue</span><span class="p">,</span> <span class="nx">keypathContext</span><span class="p">,</span> <span class="nx">keypathValue</span><span class="p">,</span> <span class="nx">style</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">,</span> <span class="nx">_ref2</span><span class="p">,</span> <span class="nx">_ref3</span><span class="p">,</span> <span class="nx">_results</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">reapplyOldStyles</span><span class="p">();</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">unbindCollection</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">value</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">reapplyOldStyles</span><span class="p">();</span>
        <span class="nx">_ref</span> <span class="o">=</span> <span class="nx">value</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">style</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
          <span class="nx">_ref2</span> <span class="o">=</span> <span class="nx">style</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">),</span> <span class="nx">cssName</span> <span class="o">=</span> <span class="nx">_ref2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">colonSplitCSSValues</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">&lt;=</span> <span class="nx">_ref2</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">_ref2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">:</span> <span class="p">[];</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">setStyle</span><span class="p">(</span><span class="nx">cssName</span><span class="p">,</span> <span class="nx">colonSplitCSSValues</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="k">instanceof</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Hash</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">bindCollection</span><span class="p">(</span><span class="nx">value</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">value</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">setStyle</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
          <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
        <span class="p">}</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="k">instanceof</span> <span class="nb">Object</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">reapplyOldStyles</span><span class="p">();</span>
        <span class="nx">_results</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">key</span> <span class="k">in</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">__hasProp</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">key</span><span class="p">))</span> <span class="k">continue</span><span class="p">;</span>
          <span class="nx">keyValue</span> <span class="o">=</span> <span class="nx">value</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
          <span class="nx">_ref3</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">renderContext</span><span class="p">.</span><span class="nx">findKey</span><span class="p">(</span><span class="nx">keyValue</span><span class="p">),</span> <span class="nx">keypathValue</span> <span class="o">=</span> <span class="nx">_ref3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">keypathContext</span> <span class="o">=</span> <span class="nx">_ref3</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
          <span class="nx">_results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">keypathValue</span> <span class="o">?</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">bindSingleAttribute</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">keyValue</span><span class="p">),</span> <span class="k">this</span><span class="p">.</span><span class="nx">setStyle</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">keypathValue</span><span class="p">))</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">setStyle</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">keyValue</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">_results</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">StyleBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">handleItemsWereAdded</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">newKey</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">setStyle</span><span class="p">(</span><span class="nx">newKey</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">newKey</span><span class="p">));</span>
    <span class="p">};</span>
    <span class="nx">StyleBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">handleItemsWereRemoved</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">oldKey</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">setStyle</span><span class="p">(</span><span class="nx">oldKey</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">StyleBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">bindSingleAttribute</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">attr</span><span class="p">,</span> <span class="nx">keyPath</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">SingleStyleBinding</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">,</span> <span class="nx">attr</span><span class="p">,</span> <span class="nx">keyPath</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">renderContext</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">renderer</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">only</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">StyleBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setStyle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">key</span> <span class="o">=</span> <span class="nx">helpers</span><span class="p">.</span><span class="nx">camelize</span><span class="p">(</span><span class="nx">key</span><span class="p">.</span><span class="nx">trim</span><span class="p">(),</span> <span class="kc">true</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">oldStyles</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">style</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">style</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span> <span class="o">?</span> <span class="nx">value</span><span class="p">.</span><span class="nx">trim</span><span class="p">()</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">StyleBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">reapplyOldStyles</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">cssName</span><span class="p">,</span> <span class="nx">cssValue</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">,</span> <span class="nx">_results</span><span class="p">;</span>
      <span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">oldStyles</span><span class="p">;</span>
      <span class="nx">_results</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">cssName</span> <span class="k">in</span> <span class="nx">_ref</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">__hasProp</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">_ref</span><span class="p">,</span> <span class="nx">cssName</span><span class="p">))</span> <span class="k">continue</span><span class="p">;</span>
        <span class="nx">cssValue</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="nx">cssName</span><span class="p">];</span>
        <span class="nx">_results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">setStyle</span><span class="p">(</span><span class="nx">cssName</span><span class="p">,</span> <span class="nx">cssValue</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">_results</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">StyleBinding</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">IteratorBinding</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">IteratorBinding</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">AbstractCollectionBinding</span><span class="p">);</span>
    <span class="nx">IteratorBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">deferEvery</span> <span class="o">=</span> <span class="mi">50</span><span class="p">;</span>
    <span class="nx">IteratorBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">currentActionNumber</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">IteratorBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">queuedActionNumber</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">IteratorBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">bindImmediately</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="kd">function</span> <span class="nx">IteratorBinding</span><span class="p">(</span><span class="nx">sourceNode</span><span class="p">,</span> <span class="nx">iteratorName</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">parentRenderer</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">previousSiblingNode</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">iteratorName</span> <span class="o">=</span> <span class="nx">iteratorName</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">key</span> <span class="o">=</span> <span class="nx">key</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">context</span> <span class="o">=</span> <span class="nx">context</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">parentRenderer</span> <span class="o">=</span> <span class="nx">parentRenderer</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">handleArrayChanged</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">handleArrayChanged</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">handleItemsWereRemoved</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">handleItemsWereRemoved</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">handleItemsWereAdded</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">handleItemsWereAdded</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">nodeMap</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">SimpleHash</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">actionMap</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">SimpleHash</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">rendererMap</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">SimpleHash</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">actions</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">prototypeNode</span> <span class="o">=</span> <span class="nx">sourceNode</span><span class="p">.</span><span class="nx">cloneNode</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">prototypeNode</span><span class="p">.</span><span class="nx">removeAttribute</span><span class="p">(</span><span class="s2">&quot;data-foreach-&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">iteratorName</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">parentNode</span> <span class="o">=</span> <span class="nx">sourceNode</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">;</span>
      <span class="nx">previousSiblingNode</span> <span class="o">=</span> <span class="nx">sourceNode</span><span class="p">.</span><span class="nx">nextSibling</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">siblingNode</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createComment</span><span class="p">(</span><span class="s2">&quot;end &quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">iteratorName</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">siblingNode</span><span class="p">[</span><span class="nx">Batman</span><span class="p">.</span><span class="nx">expando</span><span class="p">]</span> <span class="o">=</span> <span class="nx">sourceNode</span><span class="p">[</span><span class="nx">Batman</span><span class="p">.</span><span class="nx">expando</span><span class="p">];</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">Batman</span><span class="p">.</span><span class="nx">canDeleteExpando</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">delete</span> <span class="nx">sourceNode</span><span class="p">[</span><span class="nx">Batman</span><span class="p">.</span><span class="nx">expando</span><span class="p">];</span>
      <span class="p">}</span>
      <span class="nx">$insertBefore</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">siblingNode</span><span class="p">,</span> <span class="nx">previousSiblingNode</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">parentRenderer</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;parsed&#39;</span><span class="p">,</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">$removeNode</span><span class="p">(</span><span class="nx">sourceNode</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">();</span>
      <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">parentRenderer</span><span class="p">.</span><span class="nx">prevent</span><span class="p">(</span><span class="s1">&#39;rendered&#39;</span><span class="p">);</span>
      <span class="nx">IteratorBinding</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">siblingNode</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">iteratorName</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">key</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">parentRenderer</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">fragment</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createDocumentFragment</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="nx">IteratorBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">destroy</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">IteratorBinding</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">destroy</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">destroyed</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">IteratorBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">unbindCollection</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">nodeMap</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">cancelExistingItem</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
        <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
        <span class="k">return</span> <span class="nx">IteratorBinding</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">unbindCollection</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">IteratorBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">dataChange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">newCollection</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">collection</span> <span class="o">!==</span> <span class="nx">newCollection</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">removeAll</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">bindCollection</span><span class="p">(</span><span class="nx">newCollection</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">toArray</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">handleArrayChanged</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">forEach</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">addOrInsertItem</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
          <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">;</span>
          <span class="k">for</span> <span class="p">(</span><span class="nx">key</span> <span class="k">in</span> <span class="nx">_ref</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">__hasProp</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">_ref</span><span class="p">,</span> <span class="nx">key</span><span class="p">))</span> <span class="k">continue</span><span class="p">;</span>
            <span class="nx">value</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">addOrInsertItem</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">developer</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s2">&quot;Warning! data-foreach-&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">iteratorName</span> <span class="o">+</span> <span class="s2">&quot; called with an undefined binding. Key was: &quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">key</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">processActionQueue</span><span class="p">();</span>
    <span class="p">};</span>
    <span class="nx">IteratorBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">handleItemsWereAdded</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">item</span><span class="p">,</span> <span class="nx">items</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">;</span>
      <span class="nx">items</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="p">[];</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">items</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">item</span> <span class="o">=</span> <span class="nx">items</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">addOrInsertItem</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="p">{</span>
          <span class="nx">fragment</span><span class="o">:</span> <span class="kc">false</span>
        <span class="p">});</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">IteratorBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">handleItemsWereRemoved</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">item</span><span class="p">,</span> <span class="nx">items</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">;</span>
      <span class="nx">items</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">__slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="p">[];</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">items</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">item</span> <span class="o">=</span> <span class="nx">items</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">IteratorBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">handleArrayChanged</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">item</span><span class="p">,</span> <span class="nx">newItemsInOrder</span><span class="p">,</span> <span class="nx">nodesToRemove</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">;</span>
      <span class="nx">newItemsInOrder</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">toArray</span><span class="p">();</span>
      <span class="nx">nodesToRemove</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">SimpleHash</span><span class="p">).</span><span class="nx">merge</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">nodeMap</span><span class="p">);</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">newItemsInOrder</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">item</span> <span class="o">=</span> <span class="nx">newItemsInOrder</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">addOrInsertItem</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="p">{</span>
          <span class="nx">fragment</span><span class="o">:</span> <span class="kc">false</span>
        <span class="p">});</span>
        <span class="nx">nodesToRemove</span><span class="p">.</span><span class="nx">unset</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">nodesToRemove</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
      <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
    <span class="p">};</span>
    <span class="nx">IteratorBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addOrInsertItem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">existingNode</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">options</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">options</span> <span class="o">=</span> <span class="p">{};</span>
      <span class="p">}</span>
      <span class="nx">existingNode</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">nodeMap</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">existingNode</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">insertItem</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">existingNode</span><span class="p">,</span> <span class="nx">$mixin</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="p">{</span>
          <span class="nx">actionNumber</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">queuedActionNumber</span><span class="o">++</span>
        <span class="p">}));</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">addItem</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">IteratorBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addItem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">childRenderer</span><span class="p">,</span> <span class="nx">finish</span><span class="p">,</span> <span class="nx">self</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">options</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
          <span class="nx">fragment</span><span class="o">:</span> <span class="kc">true</span>
        <span class="p">};</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">parentRenderer</span><span class="p">.</span><span class="nx">prevent</span><span class="p">(</span><span class="s1">&#39;rendered&#39;</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">actionMap</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">cancelExistingItemActions</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="nx">options</span><span class="p">.</span><span class="nx">actionNumber</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">queuedActionNumber</span><span class="o">++</span><span class="p">;</span>
      <span class="nx">childRenderer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Renderer</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_nodeForItem</span><span class="p">(</span><span class="nx">item</span><span class="p">),</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">rendererMap</span><span class="p">.</span><span class="nx">unset</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">insertItem</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
      <span class="p">}),</span> <span class="k">this</span><span class="p">.</span><span class="nx">renderContext</span><span class="p">.</span><span class="nx">descend</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">iteratorName</span><span class="p">));</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">rendererMap</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">childRenderer</span><span class="p">);</span>
      <span class="nx">finish</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">destroyed</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">parentRenderer</span><span class="p">.</span><span class="nx">allowAndFire</span><span class="p">(</span><span class="s1">&#39;rendered&#39;</span><span class="p">);</span>
      <span class="p">},</span> <span class="k">this</span><span class="p">);</span>
      <span class="nx">childRenderer</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;rendered&#39;</span><span class="p">,</span> <span class="nx">finish</span><span class="p">);</span>
      <span class="nx">childRenderer</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;stopped&#39;</span><span class="p">,</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">destroyed</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">actions</span><span class="p">[</span><span class="nx">options</span><span class="p">.</span><span class="nx">actionNumber</span><span class="p">]</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="nx">finish</span><span class="p">();</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">processActionQueue</span><span class="p">();</span>
      <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
      <span class="k">return</span> <span class="nx">item</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">IteratorBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">removeItem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">hideFunction</span><span class="p">,</span> <span class="nx">oldNode</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">destroyed</span> <span class="o">||</span> <span class="o">!</span><span class="p">(</span><span class="nx">item</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">oldNode</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">nodeMap</span><span class="p">.</span><span class="nx">unset</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">cancelExistingItem</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">oldNode</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">hideFunction</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">oldNode</span><span class="p">,</span> <span class="s1">&#39;hide&#39;</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">hideFunction</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">oldNode</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">$removeNode</span><span class="p">(</span><span class="nx">oldNode</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">IteratorBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">removeAll</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">nodeMap</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
      <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
    <span class="p">};</span>
    <span class="nx">IteratorBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">insertItem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">node</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">existingActionNumber</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">options</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">options</span> <span class="o">=</span> <span class="p">{};</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">destroyed</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">existingActionNumber</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">actionMap</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">existingActionNumber</span> <span class="o">&gt;</span> <span class="nx">options</span><span class="p">.</span><span class="nx">actionNumber</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">actions</span><span class="p">[</span><span class="nx">options</span><span class="p">.</span><span class="nx">actionNumber</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{};</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">existingActionNumber</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">cancelExistingItemActions</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">actionMap</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">options</span><span class="p">.</span><span class="nx">actionNumber</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">actions</span><span class="p">[</span><span class="nx">options</span><span class="p">.</span><span class="nx">actionNumber</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">show</span><span class="p">;</span>
          <span class="nx">show</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="s1">&#39;show&#39;</span><span class="p">);</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">show</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">show</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="p">{</span>
              <span class="nx">before</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">siblingNode</span>
            <span class="p">});</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">fragment</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">fragment</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
              <span class="k">return</span> <span class="nx">$insertBefore</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">,</span> <span class="nx">node</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">siblingNode</span><span class="p">);</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">};</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">actions</span><span class="p">[</span><span class="nx">options</span><span class="p">.</span><span class="nx">actionNumber</span><span class="p">].</span><span class="nx">item</span> <span class="o">=</span> <span class="nx">item</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">processActionQueue</span><span class="p">();</span>
    <span class="p">};</span>
    <span class="nx">IteratorBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">cancelExistingItem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">cancelExistingItemActions</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">cancelExistingItemRender</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">IteratorBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">cancelExistingItemActions</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">oldActionNumber</span><span class="p">;</span>
      <span class="nx">oldActionNumber</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">actionMap</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">((</span><span class="nx">oldActionNumber</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">oldActionNumber</span> <span class="o">&gt;=</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentActionNumber</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">actionMap</span><span class="p">.</span><span class="nx">unset</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">actions</span><span class="p">[</span><span class="nx">oldActionNumber</span><span class="p">]</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">actionMap</span><span class="p">.</span><span class="nx">unset</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">IteratorBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">cancelExistingItemRender</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">oldRenderer</span><span class="p">;</span>
      <span class="nx">oldRenderer</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">rendererMap</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">oldRenderer</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">oldRenderer</span><span class="p">.</span><span class="nx">stop</span><span class="p">();</span>
        <span class="nx">$removeNode</span><span class="p">(</span><span class="nx">oldRenderer</span><span class="p">.</span><span class="nx">node</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">rendererMap</span><span class="p">.</span><span class="nx">unset</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">IteratorBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">processActionQueue</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">destroyed</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">actionQueueTimeout</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">actionQueueTimeout</span> <span class="o">=</span> <span class="nx">$setImmediate</span><span class="p">(</span><span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">f</span><span class="p">,</span> <span class="nx">startTime</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">destroyed</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">actionQueueTimeout</span><span class="p">;</span>
          <span class="nx">startTime</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">;</span>
          <span class="k">while</span> <span class="p">((</span><span class="nx">f</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">actions</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">currentActionNumber</span><span class="p">])</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">actions</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">currentActionNumber</span><span class="p">];</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">actionMap</span><span class="p">.</span><span class="nx">unset</span><span class="p">(</span><span class="nx">f</span><span class="p">.</span><span class="nx">item</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">f</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">currentActionNumber</span><span class="o">++</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">deferEvery</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="k">new</span> <span class="nb">Date</span> <span class="o">-</span> <span class="nx">startTime</span><span class="p">)</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">deferEvery</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">processActionQueue</span><span class="p">();</span>
            <span class="p">}</span>
          <span class="p">}</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">fragment</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">rendererMap</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">fragment</span><span class="p">.</span><span class="nx">hasChildNodes</span><span class="p">())</span> <span class="p">{</span>
            <span class="nx">$insertBefore</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">fragment</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">siblingNode</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">fragment</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createDocumentFragment</span><span class="p">();</span>
          <span class="p">}</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">currentActionNumber</span> <span class="o">===</span> <span class="k">this</span><span class="p">.</span><span class="nx">queuedActionNumber</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">parentRenderer</span><span class="p">.</span><span class="nx">allowAndFire</span><span class="p">(</span><span class="s1">&#39;rendered&#39;</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">IteratorBinding</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_nodeForItem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">newNode</span><span class="p">;</span>
      <span class="nx">newNode</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">prototypeNode</span><span class="p">.</span><span class="nx">cloneNode</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">nodeMap</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">newNode</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">newNode</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">IteratorBinding</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">buntUndefined</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">value</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">f</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">};</span>
  <span class="p">};</span>
  <span class="nx">filters</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Filters</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">get</span><span class="o">:</span> <span class="nx">buntUndefined</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">value</span><span class="p">.</span><span class="nx">get</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">value</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">value</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
      <span class="p">}</span>
    <span class="p">}),</span>
    <span class="nx">equals</span><span class="o">:</span> <span class="nx">buntUndefined</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">lhs</span><span class="p">,</span> <span class="nx">rhs</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">lhs</span> <span class="o">===</span> <span class="nx">rhs</span><span class="p">;</span>
    <span class="p">}),</span>
    <span class="nx">not</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="o">!!!</span><span class="nx">value</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">truncate</span><span class="o">:</span> <span class="nx">buntUndefined</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">length</span><span class="p">,</span> <span class="nx">end</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">end</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">end</span> <span class="o">=</span> <span class="s2">&quot;...&quot;</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">value</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">value</span> <span class="o">=</span> <span class="nx">value</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">length</span> <span class="o">-</span> <span class="nx">end</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="o">+</span> <span class="nx">end</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
    <span class="p">}),</span>
    <span class="s2">&quot;default&quot;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">string</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">value</span> <span class="o">||</span> <span class="nx">string</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">prepend</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">string</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">string</span> <span class="o">+</span> <span class="nx">value</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">append</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">string</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">value</span> <span class="o">+</span> <span class="nx">string</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">downcase</span><span class="o">:</span> <span class="nx">buntUndefined</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">value</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">();</span>
    <span class="p">}),</span>
    <span class="nx">upcase</span><span class="o">:</span> <span class="nx">buntUndefined</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">value</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">();</span>
    <span class="p">}),</span>
    <span class="nx">pluralize</span><span class="o">:</span> <span class="nx">buntUndefined</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">string</span><span class="p">,</span> <span class="nx">count</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">helpers</span><span class="p">.</span><span class="nx">pluralize</span><span class="p">(</span><span class="nx">count</span><span class="p">,</span> <span class="nx">string</span><span class="p">);</span>
    <span class="p">}),</span>
    <span class="nx">join</span><span class="o">:</span> <span class="nx">buntUndefined</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">byWhat</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">byWhat</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">byWhat</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">value</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">byWhat</span><span class="p">);</span>
    <span class="p">}),</span>
    <span class="nx">sort</span><span class="o">:</span> <span class="nx">buntUndefined</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">value</span><span class="p">.</span><span class="nx">sort</span><span class="p">();</span>
    <span class="p">}),</span>
    <span class="nx">map</span><span class="o">:</span> <span class="nx">buntUndefined</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">value</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">x</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
      <span class="p">});</span>
    <span class="p">}),</span>
    <span class="nx">first</span><span class="o">:</span> <span class="nx">buntUndefined</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">value</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="p">}),</span>
    <span class="nx">meta</span><span class="o">:</span> <span class="nx">buntUndefined</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">keypath</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">developer</span><span class="p">.</span><span class="nx">assert</span><span class="p">(</span><span class="nx">value</span><span class="p">.</span><span class="nx">meta</span><span class="p">,</span> <span class="s2">&quot;Error, value doesn&#39;t have a meta to filter on!&quot;</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">value</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">keypath</span><span class="p">);</span>
    <span class="p">}),</span>
    <span class="nx">interpolate</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">string</span><span class="p">,</span> <span class="nx">interpolationKeypaths</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span><span class="p">,</span> <span class="nx">values</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">string</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">values</span> <span class="o">=</span> <span class="p">{};</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="k">in</span> <span class="nx">interpolationKeypaths</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">v</span> <span class="o">=</span> <span class="nx">interpolationKeypaths</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>
        <span class="nx">values</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">findKey</span><span class="p">(</span><span class="nx">v</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">values</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">))</span> <span class="p">{</span>
          <span class="nx">Batman</span><span class="p">.</span><span class="nx">developer</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s2">&quot;Warning! Undefined interpolation key &quot;</span> <span class="o">+</span> <span class="nx">k</span> <span class="o">+</span> <span class="s2">&quot; for interpolation&quot;</span><span class="p">,</span> <span class="nx">string</span><span class="p">);</span>
          <span class="nx">values</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">interpolate</span><span class="p">(</span><span class="nx">string</span><span class="p">,</span> <span class="nx">values</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="nx">_ref</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;capitalize&#39;</span><span class="p">,</span> <span class="s1">&#39;singularize&#39;</span><span class="p">,</span> <span class="s1">&#39;underscore&#39;</span><span class="p">,</span> <span class="s1">&#39;camelize&#39;</span><span class="p">];</span>
  <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">k</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
    <span class="nx">filters</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">buntUndefined</span><span class="p">(</span><span class="nx">helpers</span><span class="p">[</span><span class="nx">k</span><span class="p">]);</span>
  <span class="p">}</span>
  <span class="nx">developer</span><span class="p">.</span><span class="nx">addFilters</span><span class="p">();</span>
  <span class="nx">$mixin</span><span class="p">(</span><span class="nx">Batman</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">cache</span><span class="o">:</span> <span class="p">{},</span>
    <span class="nx">uuid</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nx">expando</span><span class="o">:</span> <span class="s2">&quot;batman&quot;</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">().</span><span class="nx">toString</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\D/g</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
    <span class="nx">canDeleteExpando</span><span class="o">:</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">try</span> <span class="p">{</span>
        <span class="nx">div</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">delete</span> <span class="nx">div</span><span class="p">.</span><span class="nx">test</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">canDeleteExpando</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">})(),</span>
    <span class="nx">noData</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;embed&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="s2">&quot;object&quot;</span><span class="o">:</span> <span class="s2">&quot;clsid:D27CDB6E-AE6D-11cf-96B8-444553540000&quot;</span><span class="p">,</span>
      <span class="s2">&quot;applet&quot;</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">},</span>
    <span class="nx">hasData</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">elem</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">elem</span> <span class="o">=</span> <span class="p">(</span><span class="nx">elem</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">?</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">elem</span><span class="p">[</span><span class="nx">Batman</span><span class="p">.</span><span class="nx">expando</span><span class="p">]]</span> <span class="o">:</span> <span class="nx">elem</span><span class="p">[</span><span class="nx">Batman</span><span class="p">.</span><span class="nx">expando</span><span class="p">]);</span>
      <span class="k">return</span> <span class="o">!!</span><span class="nx">elem</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">isEmptyDataObject</span><span class="p">(</span><span class="nx">elem</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">data</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">elem</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">pvt</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">cache</span><span class="p">,</span> <span class="nx">getByName</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">internalKey</span><span class="p">,</span> <span class="nx">ret</span><span class="p">,</span> <span class="nx">thisCache</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Batman</span><span class="p">.</span><span class="nx">acceptData</span><span class="p">(</span><span class="nx">elem</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">internalKey</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">expando</span><span class="p">;</span>
      <span class="nx">getByName</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">name</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span><span class="p">;</span>
      <span class="nx">cache</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">cache</span><span class="p">;</span>
      <span class="nx">id</span> <span class="o">=</span> <span class="nx">elem</span><span class="p">[</span><span class="nx">Batman</span><span class="p">.</span><span class="nx">expando</span><span class="p">];</span>
      <span class="k">if</span> <span class="p">((</span><span class="o">!</span><span class="nx">id</span> <span class="o">||</span> <span class="p">(</span><span class="nx">pvt</span> <span class="o">&amp;&amp;</span> <span class="nx">id</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">cache</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">cache</span><span class="p">[</span><span class="nx">id</span><span class="p">][</span><span class="nx">internalKey</span><span class="p">])))</span> <span class="o">&amp;&amp;</span> <span class="nx">getByName</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span> <span class="o">===</span> <span class="k">void</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">elem</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">!==</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">elem</span><span class="p">[</span><span class="nx">Batman</span><span class="p">.</span><span class="nx">expando</span><span class="p">]</span> <span class="o">=</span> <span class="nx">id</span> <span class="o">=</span> <span class="o">++</span><span class="nx">Batman</span><span class="p">.</span><span class="nx">uuid</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">id</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">expando</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">cache</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span>
        <span class="nx">cache</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">name</span> <span class="o">===</span> <span class="s2">&quot;object&quot;</span> <span class="o">||</span> <span class="k">typeof</span> <span class="nx">name</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">pvt</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">cache</span><span class="p">[</span><span class="nx">id</span><span class="p">][</span><span class="nx">internalKey</span><span class="p">]</span> <span class="o">=</span> <span class="nx">$mixin</span><span class="p">(</span><span class="nx">cache</span><span class="p">[</span><span class="nx">id</span><span class="p">][</span><span class="nx">internalKey</span><span class="p">],</span> <span class="nx">name</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">cache</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">$mixin</span><span class="p">(</span><span class="nx">cache</span><span class="p">[</span><span class="nx">id</span><span class="p">],</span> <span class="nx">name</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="nx">thisCache</span> <span class="o">=</span> <span class="nx">cache</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">pvt</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">thisCache</span><span class="p">[</span><span class="nx">internalKey</span><span class="p">]</span> <span class="o">||</span> <span class="p">(</span><span class="nx">thisCache</span><span class="p">[</span><span class="nx">internalKey</span><span class="p">]</span> <span class="o">=</span> <span class="p">{});</span>
        <span class="nx">thisCache</span> <span class="o">=</span> <span class="nx">thisCache</span><span class="p">[</span><span class="nx">internalKey</span><span class="p">];</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">data</span> <span class="o">!==</span> <span class="k">void</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">thisCache</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">getByName</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">ret</span> <span class="o">=</span> <span class="nx">thisCache</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">ret</span> <span class="o">=</span> <span class="nx">thisCache</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">removeData</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">elem</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">pvt</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">cache</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">internalCache</span><span class="p">,</span> <span class="nx">internalKey</span><span class="p">,</span> <span class="nx">isNode</span><span class="p">,</span> <span class="nx">thisCache</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Batman</span><span class="p">.</span><span class="nx">acceptData</span><span class="p">(</span><span class="nx">elem</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">internalKey</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">expando</span><span class="p">;</span>
      <span class="nx">isNode</span> <span class="o">=</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">nodeType</span><span class="p">;</span>
      <span class="nx">cache</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">cache</span><span class="p">;</span>
      <span class="nx">id</span> <span class="o">=</span> <span class="nx">elem</span><span class="p">[</span><span class="nx">Batman</span><span class="p">.</span><span class="nx">expando</span><span class="p">];</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">cache</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">thisCache</span> <span class="o">=</span> <span class="nx">pvt</span> <span class="o">?</span> <span class="nx">cache</span><span class="p">[</span><span class="nx">id</span><span class="p">][</span><span class="nx">internalKey</span><span class="p">]</span> <span class="o">:</span> <span class="nx">cache</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">thisCache</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">delete</span> <span class="nx">thisCache</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isEmptyDataObject</span><span class="p">(</span><span class="nx">thisCache</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">pvt</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">delete</span> <span class="nx">cache</span><span class="p">[</span><span class="nx">id</span><span class="p">][</span><span class="nx">internalKey</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isEmptyDataObject</span><span class="p">(</span><span class="nx">cache</span><span class="p">[</span><span class="nx">id</span><span class="p">]))</span> <span class="p">{</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="nx">internalCache</span> <span class="o">=</span> <span class="nx">cache</span><span class="p">[</span><span class="nx">id</span><span class="p">][</span><span class="nx">internalKey</span><span class="p">];</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">Batman</span><span class="p">.</span><span class="nx">canDeleteExpando</span> <span class="o">||</span> <span class="o">!</span><span class="nx">cache</span><span class="p">.</span><span class="nx">setInterval</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">delete</span> <span class="nx">cache</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">cache</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">internalCache</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">cache</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="k">return</span> <span class="nx">cache</span><span class="p">[</span><span class="nx">id</span><span class="p">][</span><span class="nx">internalKey</span><span class="p">]</span> <span class="o">=</span> <span class="nx">internalCache</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">Batman</span><span class="p">.</span><span class="nx">canDeleteExpando</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="k">delete</span> <span class="nx">elem</span><span class="p">[</span><span class="nx">Batman</span><span class="p">.</span><span class="nx">expando</span><span class="p">];</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">elem</span><span class="p">.</span><span class="nx">removeAttribute</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">removeAttribute</span><span class="p">(</span><span class="nx">Batman</span><span class="p">.</span><span class="nx">expando</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">elem</span><span class="p">[</span><span class="nx">Batman</span><span class="p">.</span><span class="nx">expando</span><span class="p">]</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">_data</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">elem</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">elem</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">acceptData</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">elem</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">match</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">elem</span><span class="p">.</span><span class="nx">nodeName</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">match</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">noData</span><span class="p">[</span><span class="nx">elem</span><span class="p">.</span><span class="nx">nodeName</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="o">!</span><span class="p">(</span><span class="nx">match</span> <span class="o">===</span> <span class="kc">true</span> <span class="o">||</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s2">&quot;classid&quot;</span><span class="p">)</span> <span class="o">!==</span> <span class="nx">match</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">});</span>
  <span class="nx">isEmptyDataObject</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">name</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">name</span> <span class="k">in</span> <span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">};</span>
  <span class="nx">mixins</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">mixins</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nb">Object</span><span class="p">();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">Encoders</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">Paginator</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">Paginator</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nb">Object</span><span class="p">);</span>
    <span class="kd">function</span> <span class="nx">Paginator</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">Paginator</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">Paginator</span><span class="p">.</span><span class="nx">Cache</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">function</span> <span class="nx">Cache</span><span class="p">(</span><span class="nx">offset</span><span class="p">,</span> <span class="nx">limit</span><span class="p">,</span> <span class="nx">items</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">offset</span> <span class="o">=</span> <span class="nx">offset</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">limit</span> <span class="o">=</span> <span class="nx">limit</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">items</span> <span class="o">=</span> <span class="nx">items</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="nx">items</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">reach</span> <span class="o">=</span> <span class="nx">offset</span> <span class="o">+</span> <span class="nx">limit</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">Cache</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">containsItemsForOffsetAndLimit</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">offset</span><span class="p">,</span> <span class="nx">limit</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">offset</span> <span class="o">&gt;=</span> <span class="k">this</span><span class="p">.</span><span class="nx">offset</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">offset</span> <span class="o">+</span> <span class="nx">limit</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="k">this</span><span class="p">.</span><span class="nx">reach</span><span class="p">;</span>
      <span class="p">};</span>
      <span class="nx">Cache</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">itemsForOffsetAndLimit</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">offset</span><span class="p">,</span> <span class="nx">limit</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">begin</span><span class="p">,</span> <span class="nx">end</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">containsItemsForOffsetAndLimit</span><span class="p">(</span><span class="nx">offset</span><span class="p">,</span> <span class="nx">limit</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">begin</span> <span class="o">=</span> <span class="nx">offset</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">offset</span><span class="p">;</span>
        <span class="nx">end</span> <span class="o">=</span> <span class="nx">begin</span> <span class="o">+</span> <span class="nx">limit</span><span class="p">;</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">items</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">begin</span><span class="p">,</span> <span class="nx">end</span><span class="p">);</span>
      <span class="p">};</span>
      <span class="k">return</span> <span class="nx">Cache</span><span class="p">;</span>
    <span class="p">})();</span>
    <span class="nx">Paginator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">Paginator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">limit</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="nx">Paginator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">totalCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">Paginator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">offsetFromPageAndLimit</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">page</span><span class="p">,</span> <span class="nx">limit</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">((</span><span class="o">+</span><span class="nx">page</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="nx">limit</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">Paginator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">pageFromOffsetAndLimit</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">offset</span><span class="p">,</span> <span class="nx">limit</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">offset</span> <span class="o">/</span> <span class="nx">limit</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">Paginator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toArray</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">cache</span><span class="p">,</span> <span class="nx">items</span><span class="p">,</span> <span class="nx">limit</span><span class="p">,</span> <span class="nx">offset</span><span class="p">;</span>
      <span class="nx">cache</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;cache&#39;</span><span class="p">);</span>
      <span class="nx">offset</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;offset&#39;</span><span class="p">);</span>
      <span class="nx">limit</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;limit&#39;</span><span class="p">);</span>
      <span class="nx">items</span> <span class="o">=</span> <span class="nx">cache</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">cache</span><span class="p">.</span><span class="nx">itemsForOffsetAndLimit</span><span class="p">(</span><span class="nx">offset</span><span class="p">,</span> <span class="nx">limit</span><span class="p">)</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">items</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">loadItemsForOffsetAndLimit</span><span class="p">(</span><span class="nx">offset</span><span class="p">,</span> <span class="nx">limit</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">items</span> <span class="o">||</span> <span class="p">[];</span>
    <span class="p">};</span>
    <span class="nx">Paginator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">page</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">pageFromOffsetAndLimit</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;offset&#39;</span><span class="p">),</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;limit&#39;</span><span class="p">));</span>
    <span class="p">};</span>
    <span class="nx">Paginator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">pageCount</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;totalCount&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;limit&#39;</span><span class="p">));</span>
    <span class="p">};</span>
    <span class="nx">Paginator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">previousPage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;page&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;page&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">Paginator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">nextPage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;page&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;page&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">Paginator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">loadItemsForOffsetAndLimit</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">offset</span><span class="p">,</span> <span class="nx">limit</span><span class="p">)</span> <span class="p">{};</span>
    <span class="nx">Paginator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">updateCache</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">offset</span><span class="p">,</span> <span class="nx">limit</span><span class="p">,</span> <span class="nx">items</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;cache&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Paginator</span><span class="p">.</span><span class="nx">Cache</span><span class="p">(</span><span class="nx">offset</span><span class="p">,</span> <span class="nx">limit</span><span class="p">,</span> <span class="nx">items</span><span class="p">));</span>
    <span class="p">};</span>
    <span class="nx">Paginator</span><span class="p">.</span><span class="nx">accessor</span><span class="p">(</span><span class="s1">&#39;toArray&#39;</span><span class="p">,</span> <span class="nx">Paginator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toArray</span><span class="p">);</span>
    <span class="nx">Paginator</span><span class="p">.</span><span class="nx">accessor</span><span class="p">(</span><span class="s1">&#39;offset&#39;</span><span class="p">,</span> <span class="s1">&#39;limit&#39;</span><span class="p">,</span> <span class="s1">&#39;totalCount&#39;</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">get</span><span class="o">:</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Property</span><span class="p">.</span><span class="nx">defaultAccessor</span><span class="p">.</span><span class="nx">get</span><span class="p">,</span>
      <span class="nx">set</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Property</span><span class="p">.</span><span class="nx">defaultAccessor</span><span class="p">.</span><span class="nx">set</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="o">+</span><span class="nx">value</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
    <span class="nx">Paginator</span><span class="p">.</span><span class="nx">accessor</span><span class="p">(</span><span class="s1">&#39;page&#39;</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">get</span><span class="o">:</span> <span class="nx">Paginator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">page</span><span class="p">,</span>
      <span class="nx">set</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">_</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">value</span> <span class="o">=</span> <span class="o">+</span><span class="nx">value</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;offset&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">offsetFromPageAndLimit</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;limit&#39;</span><span class="p">)));</span>
        <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">});</span>
    <span class="nx">Paginator</span><span class="p">.</span><span class="nx">accessor</span><span class="p">(</span><span class="s1">&#39;pageCount&#39;</span><span class="p">,</span> <span class="nx">Paginator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">pageCount</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">Paginator</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">ModelPaginator</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">__extends</span><span class="p">(</span><span class="nx">ModelPaginator</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Paginator</span><span class="p">);</span>
    <span class="kd">function</span> <span class="nx">ModelPaginator</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">ModelPaginator</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">ModelPaginator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">cachePadding</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">ModelPaginator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">paddedOffset</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">offset</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">offset</span> <span class="o">-=</span> <span class="k">this</span><span class="p">.</span><span class="nx">cachePadding</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">offset</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">offset</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">ModelPaginator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">paddedLimit</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">limit</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">limit</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">cachePadding</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">ModelPaginator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">loadItemsForOffsetAndLimit</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">offset</span><span class="p">,</span> <span class="nx">limit</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">params</span><span class="p">,</span> <span class="nx">v</span><span class="p">,</span> <span class="nx">_ref2</span><span class="p">;</span>
      <span class="nx">params</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">paramsForOffsetAndLimit</span><span class="p">(</span><span class="nx">offset</span><span class="p">,</span> <span class="nx">limit</span><span class="p">);</span>
      <span class="nx">_ref2</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">params</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="k">in</span> <span class="nx">_ref2</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">v</span> <span class="o">=</span> <span class="nx">_ref2</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>
        <span class="nx">params</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">v</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="nx">__bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">records</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">updateCache</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">offsetFromParams</span><span class="p">(</span><span class="nx">params</span><span class="p">),</span> <span class="k">this</span><span class="p">.</span><span class="nx">limitFromParams</span><span class="p">(</span><span class="nx">params</span><span class="p">),</span> <span class="nx">records</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
    <span class="p">};</span>
    <span class="nx">ModelPaginator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">paramsForOffsetAndLimit</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">offset</span><span class="p">,</span> <span class="nx">limit</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">{</span>
        <span class="nx">offset</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">paddedOffset</span><span class="p">(</span><span class="nx">offset</span><span class="p">),</span>
        <span class="nx">limit</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">paddedLimit</span><span class="p">(</span><span class="nx">limit</span><span class="p">)</span>
      <span class="p">};</span>
    <span class="p">};</span>
    <span class="nx">ModelPaginator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">offsetFromParams</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">params</span><span class="p">.</span><span class="nx">offset</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">ModelPaginator</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">limitFromParams</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">params</span><span class="p">.</span><span class="nx">limit</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">ModelPaginator</span><span class="p">;</span>
  <span class="p">})();</span>
  <span class="nx">container</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">exports</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">exports</span> <span class="o">!==</span> <span class="kc">null</span> <span class="o">?</span> <span class="p">(</span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">,</span> <span class="nx">global</span><span class="p">)</span> <span class="o">:</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">Batman</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">,</span> <span class="nb">window</span><span class="p">);</span>
  <span class="nx">$mixin</span><span class="p">(</span><span class="nx">container</span><span class="p">,</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">Observable</span><span class="p">);</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">exportHelpers</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">onto</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">_j</span><span class="p">,</span> <span class="nx">_len2</span><span class="p">,</span> <span class="nx">_ref2</span><span class="p">;</span>
    <span class="nx">_ref2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mixin&#39;</span><span class="p">,</span> <span class="s1">&#39;unmixin&#39;</span><span class="p">,</span> <span class="s1">&#39;route&#39;</span><span class="p">,</span> <span class="s1">&#39;redirect&#39;</span><span class="p">,</span> <span class="s1">&#39;typeOf&#39;</span><span class="p">,</span> <span class="s1">&#39;redirect&#39;</span><span class="p">,</span> <span class="s1">&#39;setImmediate&#39;</span><span class="p">];</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">_j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len2</span> <span class="o">=</span> <span class="nx">_ref2</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_j</span> <span class="o">&lt;</span> <span class="nx">_len2</span><span class="p">;</span> <span class="nx">_j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">k</span> <span class="o">=</span> <span class="nx">_ref2</span><span class="p">[</span><span class="nx">_j</span><span class="p">];</span>
      <span class="nx">onto</span><span class="p">[</span><span class="s2">&quot;$&quot;</span> <span class="o">+</span> <span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">Batman</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">onto</span><span class="p">;</span>
  <span class="p">};</span>
  <span class="nx">Batman</span><span class="p">.</span><span class="nx">exportGlobals</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">Batman</span><span class="p">.</span><span class="nx">exportHelpers</span><span class="p">(</span><span class="nx">container</span><span class="p">);</span>
  <span class="p">};</span>
<span class="p">}).</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

</pre></div>             </td>           </tr>                </tbody>     </table>          <div id="projectname">batman.js</div>        </div> </body> </html>  