 <!DOCTYPE html>  <html> <head>   <title>batman.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="../../docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">             <a class="source" href="../../readme.html">               <span class="file_name">README</span>             </a>                                           <a class="source " href="../../src/batman.html">                 <span class="base_path">src / </span><span class="file_name">batman.coffee</span>               </a>                                           <a class="source " href="../../src/batman.jquery.html">                 <span class="base_path">src / </span><span class="file_name">batman.jquery.coffee</span>               </a>                                           <a class="source " href="../../src/batman.node.html">                 <span class="base_path">src / </span><span class="file_name">batman.node.coffee</span>               </a>                                           <a class="source " href="../../src/batman.solo.html">                 <span class="base_path">src / </span><span class="file_name">batman.solo.coffee</span>               </a>                                           <a class="source " href="../../src/extras/batman.i18n.html">                 <span class="base_path">src / extras / </span><span class="file_name">batman.i18n.coffee</span>               </a>                                           <a class="source " href="../../src/extras/batman.rails.html">                 <span class="base_path">src / extras / </span><span class="file_name">batman.rails.coffee</span>               </a>                                           <a class="source selected" href="../../src/tools/batman.html">                 <span class="base_path">src / tools / </span><span class="file_name">batman.coffee</span>               </a>                                           <a class="source " href="../../src/tools/build/remove_development_transform.html">                 <span class="base_path">src / tools / build / </span><span class="file_name">remove_development_transform.coffee</span>               </a>                                           <a class="source " href="../../src/tools/generator.html">                 <span class="base_path">src / tools / </span><span class="file_name">generator.coffee</span>               </a>                                           <a class="source " href="../../src/tools/server.html">                 <span class="base_path">src / tools / </span><span class="file_name">server.coffee</span>               </a>                                           <a class="source " href="../../src/tools/utils.html">                 <span class="base_path">src / tools / </span><span class="file_name">utils.coffee</span>               </a>                                           <a class="source " href="../../tools/build/remove_development_transform.html">                 <span class="base_path">tools / build / </span><span class="file_name">remove_development_transform.js</span>               </a>                                           <a class="source " href="../../tools/cli.html">                 <span class="base_path">tools / </span><span class="file_name">cli.js</span>               </a>                                           <a class="source " href="../../tools/framework.html">                 <span class="base_path">tools / </span><span class="file_name">framework.js</span>               </a>                                           <a class="source " href="../../tools/generator.html">                 <span class="base_path">tools / </span><span class="file_name">generator.js</span>               </a>                                           <a class="source " href="../../tools/server.html">                 <span class="base_path">tools / </span><span class="file_name">server.js</span>               </a>                                           <a class="source " href="../../tools/server_utils.html">                 <span class="base_path">tools / </span><span class="file_name">server_utils.js</span>               </a>                                           <a class="source " href="../../tools/templates/app/$app$.html">                 <span class="base_path">tools / templates / app / </span><span class="file_name">$app$.coffee</span>               </a>                                           <a class="source " href="../../tools/templates/app/controllers/app_controller.html">                 <span class="base_path">tools / templates / app / controllers / </span><span class="file_name">app_controller.coffee</span>               </a>                                           <a class="source " href="../../tools/templates/controller/controllers/$name$_controller.html">                 <span class="base_path">tools / templates / controller / controllers / </span><span class="file_name">$name$_controller.coffee</span>               </a>                                           <a class="source " href="../../tools/templates/model/models/$name$.html">                 <span class="base_path">tools / templates / model / models / </span><span class="file_name">$name$.coffee</span>               </a>                                           <a class="source " href="../../tools/utils.html">                 <span class="base_path">tools / </span><span class="file_name">utils.js</span>               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               batman.coffee             </h1>             <div class="filepath">src/tools/</div>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="o">`</span><span class="c1">#!/usr/bin/env node</span>

<span class="o">`</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>batman.coffee
batman.js</p>

<p>Created by Nick Small
Copyright 2011, Shopify</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="o">-&gt;</span>
  <span class="nv">cli = </span><span class="nx">require</span> <span class="s1">&#39;./cli&#39;</span>
  <span class="nv">Batman = </span><span class="nx">require</span> <span class="s1">&#39;../lib/batman.js&#39;</span>
  <span class="nv">global.RUNNING_IN_BATMAN = </span><span class="kc">true</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>List of commands for use in the multiple <code>cli.parse</code> calls below.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">Commands = </span><span class="p">[</span><span class="s1">&#39;server&#39;</span><span class="p">,</span> <span class="s1">&#39;generate&#39;</span><span class="p">,</span> <span class="s1">&#39;new&#39;</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Yeah, this is happening. Sorry everyone.
cli needs to be headlocked into not fatal erroring if no command is given when
help is disabled. We need to disable help so the second parse (the one
in the command file) can spit out its own command specific usage stuff if the
help flag is given with a command. So, we disable the help module here, and
catch the <code>process.exit</code> call by overriding <code>cli.fatal</code>. The effect is this:
when run with just '--help', the new <code>cli.fatal</code> implementation will spit out
the global usage. When run with 'generate --help' for example, the usage from
the generate file will be shown. Nice.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Disable the help and grab a pointer to the old <code>fatal</code> function.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">cli</span><span class="p">.</span><span class="nx">disable</span> <span class="s1">&#39;help&#39;</span>
  <span class="nv">oldFatal = </span><span class="nx">cli</span><span class="p">.</span><span class="nx">fatal</span>
  <span class="nv">noCommandGiven = </span><span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Provide a <code>fatal</code> which behaves.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">cli.fatal = </span><span class="nf">(str) -&gt;</span>
    <span class="k">if</span> <span class="nx">str</span><span class="p">.</span><span class="nx">match</span> <span class="s1">&#39;command is required&#39;</span>
      <span class="nv">noCommandGiven = </span><span class="kc">true</span>
      <span class="nx">cli</span><span class="p">.</span><span class="nx">enable</span><span class="p">(</span><span class="s1">&#39;help&#39;</span><span class="p">).</span><span class="nx">parse</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">Commands</span><span class="p">)</span>
      <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">()</span>
    <span class="k">else</span>
      <span class="nx">oldFatal</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Run the parse and then revert this dirty, dirty hack.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">cli</span><span class="p">.</span><span class="nx">parse</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">Commands</span>
  <span class="nv">cli.fatal = </span><span class="nx">oldFatal</span>
  <span class="nx">cli</span><span class="p">.</span><span class="nx">enable</span> <span class="s1">&#39;help&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <h2>File Breakout</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Effectively reset cli's parsing.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">cli</span><span class="p">.</span><span class="nx">setArgv</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">argv</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Finally, we can actually start doing some work.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">switch</span> <span class="nx">cli</span><span class="p">.</span><span class="nx">command</span>
    <span class="k">when</span> <span class="s1">&#39;serve&#39;</span><span class="p">,</span> <span class="s1">&#39;server&#39;</span>
      <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./server&#39;</span><span class="p">)</span>
    <span class="k">when</span> <span class="s1">&#39;generate&#39;</span><span class="p">,</span> <span class="s1">&#39;new&#39;</span>
      <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./generator&#39;</span><span class="p">)</span>
<span class="p">)()</span>

</pre></div>             </td>           </tr>                </tbody>     </table>          <div id="projectname"><a href="../../readme.html">batman.js</a></div>        </div> </body> </html>  